<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Documentation for Mozilla l10n Drivers</title>
        
        <meta name="robots" content="noindex" />
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="index.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="products/android-l10n/index.html"><strong aria-hidden="true">2.</strong> Android-l10n</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="products/android-l10n/adding_new_locales.html"><strong aria-hidden="true">2.1.</strong> Adding new locales</a></li></ol></li><li class="chapter-item expanded "><a href="products/firefox_desktop/index.html"><strong aria-hidden="true">3.</strong> Firefox Desktop</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="products/firefox_desktop/adding_pontoon.html"><strong aria-hidden="true">3.1.</strong> Add to Pontoon</a></li><li class="chapter-item expanded "><a href="products/firefox_desktop/adding_nightly.html"><strong aria-hidden="true">3.2.</strong> Nightly builds</a></li><li class="chapter-item expanded "><a href="products/firefox_desktop/adding_release.html"><strong aria-hidden="true">3.3.</strong> Beta/Release builds</a></li><li class="chapter-item expanded "><a href="products/firefox_desktop/removing_locales.html"><strong aria-hidden="true">3.4.</strong> Removing locales</a></li><li class="chapter-item expanded "><a href="products/firefox_desktop/fluent_migrations.html"><strong aria-hidden="true">3.5.</strong> Fluent migrations</a></li><li class="chapter-item expanded "><a href="products/firefox_desktop/firefox_l10n_faqs.html"><strong aria-hidden="true">3.6.</strong> L10N FAQs</a></li></ol></li><li class="chapter-item expanded "><a href="products/review/index.html"><strong aria-hidden="true">4.</strong> Review</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="products/review/signoffs.html"><strong aria-hidden="true">4.1.</strong> Sign-offs</a></li><li class="chapter-item expanded "><a href="products/review/review.html"><strong aria-hidden="true">4.2.</strong> Review strings</a></li></ol></li><li class="chapter-item expanded "><a href="products/firefox_iOS/index.html"><strong aria-hidden="true">5.</strong> Firefox for iOS</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="products/firefox_iOS/review_iOSstrings.html"><strong aria-hidden="true">5.1.</strong> Reviewing new strings</a></li></ol></li><li class="chapter-item expanded "><a href="products/mozilla_org/index.html"><strong aria-hidden="true">6.</strong> Mozilla.org</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="products/mozilla_org/extract_strings.html"><strong aria-hidden="true">6.1.</strong> Process overview</a></li><li class="chapter-item expanded "><a href="products/mozilla_org/working_bedrock.html"><strong aria-hidden="true">6.2.</strong> Working with Bedrock</a></li><li class="chapter-item expanded "><a href="tools/webdashboards/import_translations.html"><strong aria-hidden="true">6.3.</strong> Importing translations</a></li><li class="chapter-item expanded "><a href="products/mozilla_org/updating_mozillaorg_production.html"><strong aria-hidden="true">6.4.</strong> Updating production</a></li><li class="chapter-item expanded "><a href="products/mozilla_org/enable_production.html"><strong aria-hidden="true">6.5.</strong> New locales</a></li></ol></li><li class="chapter-item expanded "><a href="products/other/index.html"><strong aria-hidden="true">7.</strong> Other Projects</a></li><li class="chapter-item expanded "><a href="products/searchplugins/setup_searchplugins.html"><strong aria-hidden="true">8.</strong> Searchplugins</a></li><li class="chapter-item expanded "><a href="tools/pontoon/index.html"><strong aria-hidden="true">9.</strong> Pontoon</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="tools/pontoon/adding_new_project.html"><strong aria-hidden="true">9.1.</strong> New project</a></li><li class="chapter-item expanded "><a href="tools/pontoon/adding_new_short_term_project.html"><strong aria-hidden="true">9.2.</strong> New short-term project</a></li><li class="chapter-item expanded "><a href="tools/pontoon/adding_new_locale.html"><strong aria-hidden="true">9.3.</strong> New locale</a></li><li class="chapter-item expanded "><a href="tools/pontoon/sending_notifications.html"><strong aria-hidden="true">9.4.</strong> Notifications</a></li><li class="chapter-item expanded "><a href="tools/pontoon/renaming_a_file.html"><strong aria-hidden="true">9.5.</strong> Renaming a localization file</a></li><li class="chapter-item expanded "><a href="tools/pontoon/deactivating_users.html"><strong aria-hidden="true">9.6.</strong> Deactivating users</a></li></ol></li><li class="chapter-item expanded "><a href="tools/webdashboards/index.html"><strong aria-hidden="true">10.</strong> Web dashboards</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="tools/webdashboards/langchecker.html"><strong aria-hidden="true">10.1.</strong> Langchecker</a></li><li class="chapter-item expanded "><a href="tools/webdashboards/bootstrap_new_locale.html"><strong aria-hidden="true">10.2.</strong> Bootstrap a new locale</a></li><li class="chapter-item expanded "><a href="tools/webdashboards/add_locales.html"><strong aria-hidden="true">10.3.</strong> Add locales to an existing file</a></li><li class="chapter-item expanded "><a href="tools/webdashboards/update_existing_file.html"><strong aria-hidden="true">10.4.</strong> Update an existing file</a></li><li class="chapter-item expanded "><a href="tools/webdashboards/remove_obsolete_files.html"><strong aria-hidden="true">10.5.</strong> Remove obsolete files</a></li><li class="chapter-item expanded "><a href="tools/webdashboards/add_new_file.html"><strong aria-hidden="true">10.6.</strong> Add a new file to an existing project</a></li></ol></li><li class="chapter-item expanded "><a href="tools/mercurial/index.html"><strong aria-hidden="true">11.</strong> Mercurial</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="tools/mercurial/setting_mercurial_environment.html"><strong aria-hidden="true">11.1.</strong> Set up the environment</a></li><li class="chapter-item expanded "><a href="tools/mercurial/creating_mercurial_patch.html"><strong aria-hidden="true">11.2.</strong> Create a patch</a></li><li class="chapter-item expanded "><a href="tools/mercurial/useful_mercurial_commands.html"><strong aria-hidden="true">11.3.</strong> Useful Mercurial commands</a></li></ol></li><li class="chapter-item expanded "><a href="misc/index.html"><strong aria-hidden="true">12.</strong> Other docs</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="misc/creating_new_repository.html"><strong aria-hidden="true">12.1.</strong> New l10n repository</a></li><li class="chapter-item expanded "><a href="misc/working_w_l10n_agency.html"><strong aria-hidden="true">12.2.</strong> How to work with a Localization Agency</a></li><li class="chapter-item expanded "><a href="misc/documentation_styleguide.html"><strong aria-hidden="true">12.3.</strong> Documentation styleguide</a></li><li class="chapter-item expanded "><a href="misc/stock_emails.html"><strong aria-hidden="true">12.4.</strong> Stock emails</a></li><li class="chapter-item expanded "><a href="config/setup_l10ndrivers_vm.html"><strong aria-hidden="true">12.5.</strong> L10n-drivers VM setup</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">Documentation for Mozilla l10n Drivers</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#documentation" id="documentation">Documentation</a></h1>
<p>This repository includes several documents describing how to perform internal tasks within the <a href="https://wiki.mozilla.org/L10n:Mozilla_Team">l10n-drivers team</a> at Mozilla.</p>
<p>Topics covered:</p>
<ul>
<li>How to <a href="products/review/review.html">review strings</a> and <a href="products/review/signoffs.html">perform sign-offs</a> for Firefox desktop.</li>
<li>Manage <a href="products/mozilla_org/">mozilla.org</a> localization.</li>
<li>Manage <a href="products/other/">other projects</a> (Firefox Monitor, Firefox Send).</li>
<li>Technical documentation and common tasks for our <a href="tools/webdashboards/">webdashboards</a>.</li>
<li>Perform common and advanced tasks on <a href="tools/pontoon/">Pontoon</a> like adding new locale, and creating a new project.</li>
<li>Other <a href="misc/">miscellaneous documents</a> related to localization tasks.</li>
</ul>
<h2><a class="header" href="#how-to-read-these-documents" id="how-to-read-these-documents">How to read these documents</a></h2>
<p>You will need a Unix-like environment (Linux, macOS) to run most of the tools. Across the entire documentation, commands to run in a terminal are described like this:</p>
<pre><code class="language-BASH">$ composer update
</code></pre>
<p><code>$</code> is not part of the command, it just indicates the terminal prompt. The command to type or copy and paste is simply <code>composer update</code>.</p>
<p>In several occasions documents use aliases instead of the complete path to commands: for example <code>lang_update</code> instead of <code>path_to_langchecker_clone/app/scripts/lang_update</code>. Check <a href="config/setup_l10ndrivers_vm.html">Setting up a Linux Virtual Machine for Webdashboards</a> for instructions on how to setup a virtual machine running on Linux Ubuntu with all the necessary packages and aliases.</p>
<h2><a class="header" href="#updating-the-documentation" id="updating-the-documentation">Updating the documentation</a></h2>
<p>Please see the <a href="https://github.com/mozilla-l10n/documentation/blob/master/README.md">README file in our GitHub repository</a>.</p>
<h1><a class="header" href="#l10n-and-android-l10n" id="l10n-and-android-l10n">L10n and android-l10n</a></h1>
<p>Some documentation specific for common tasks regarding android-l10n and l10n:</p>
<ul>
<li><a href="products/android-l10n/adding_new_locales.html">Adding new locales</a>.</li>
</ul>
<h1><a class="header" href="#adding-new-locales-to-specific-projects" id="adding-new-locales-to-specific-projects">Adding new locales to specific projects</a></h1>
<p>These are instructions in order to add new locales to Android mobile products living within the <a href="https://github.com/mozilla-l10n/android-l10n/">android-l10n project</a>.</p>
<h2><a class="header" href="#edit-the-l10ntoml-files" id="edit-the-l10ntoml-files">Edit the l10n.toml file(s)</a></h2>
<p>All android-l10n products live within the <a href="https://github.com/mozilla-l10n/android-l10n/">android-l10n project</a>. Depending on the product that requires a new locale to be added, the corresponding l10n.toml file will have to be edited by adding the new locale code in it.</p>
<p>The l10n.toml files live in their corresponding project folder, located here for:</p>
<ul>
<li><a href="https://github.com/mozilla-l10n/android-l10n/blob/master/mozilla-mobile/fenix/l10n.toml">Fenix</a></li>
<li><a href="https://github.com/mozilla-l10n/android-l10n/blob/master/mozilla-mobile/android-components/l10n.toml">Android-Components</a></li>
<li><a href="https://github.com/mozilla-l10n/android-l10n/blob/master/mozilla-mobile/firefox-tv/l10n.toml">Firefox for Fire TV</a></li>
<li><a href="https://github.com/mozilla-l10n/android-l10n/blob/master/MozillaReality/FirefoxReality/l10n.toml">Firefox Reality</a></li>
<li><a href="https://github.com/mozilla-l10n/android-l10n/blob/master/mozilla-lockwise/lockwise-android/l10n.toml">Lockwise for Android</a></li>
</ul>
<p>Each l10n.toml file typically looks like this:</p>
<pre><code>basepath = &quot;.&quot;

locales = [
    &quot;ab-CD&quot;,
    &quot;an&quot;,
    &quot;ar&quot;,
    &quot;as&quot;,
    &quot;ast&quot;,
    &quot;az&quot;,
...
]

# Expose the following branches to localization
# Changes to this list should be announced to the l10n team ahead of time.
branches = [
    &quot;master&quot;,
]

[env]

[[paths]]
  reference = &quot;app/src/main/res/values/strings.xml&quot;
  l10n = &quot;app/src/main/res/values-{android_locale}/strings.xml&quot;
</code></pre>
<p>Identify the <code>locales</code> section, add the desired new locale code in this  list. With Atom and the Sort Lines package installed, you can press <code>F5</code> to make sure that the list is in <strong>alphabetical order</strong>.</p>
<p>Save your edited file, then commit and push from your branch to the android-l10n repository.</p>
<p>Note that all products except Firefox for Fire TV share strings with Android Components, so you will also have to edit the Android Components l10n.toml file and add the new locale there.</p>
<h2><a class="header" href="#add-new-locales-to-pontoon" id="add-new-locales-to-pontoon">Add new locales to Pontoon</a></h2>
<p>Once the patch has landed, the new locale has to be added in Pontoon as well. The steps to follow can be found in the existing <a href="products/android-l10n/../../tools/pontoon/adding_new_locale.html">Pontoon documentation here</a>.</p>
<h1><a class="header" href="#l10n-and-firefox-desktop" id="l10n-and-firefox-desktop">L10n and Firefox desktop</a></h1>
<p>Some documentation specific for common tasks regarding Firefox desktop and l10n:</p>
<ul>
<li><a href="products/firefox_desktop/../../tools/mercurial/setting_mercurial_environment.html">Set up the environment</a>.</li>
<li><a href="products/firefox_desktop/adding_pontoon.html">Adding a locale to Pontoon</a>.</li>
<li><a href="products/firefox_desktop/adding_nightly.html">Adding a locale to Nightly builds</a>.</li>
<li><a href="products/firefox_desktop/adding_release.html">Adding a locale to Beta and Release builds</a>.</li>
<li><a href="products/firefox_desktop/../searchplugins/setup_searchplugins.html">Set up searchplugins</a>.</li>
<li><a href="products/firefox_desktop/removing_locales.html">Removing a locale</a>.</li>
<li><a href="products/firefox_desktop/fluent_migrations.html">Running Fluent migrations</a>.</li>
<li><a href="products/firefox_desktop/firefox_l10n_faqs.html">FAQs for Firefox and L10N</a>.</li>
</ul>
<h1><a class="header" href="#adding-a-new-locale-to-pontoon" id="adding-a-new-locale-to-pontoon">Adding a new locale to Pontoon</a></h1>
<ul>
<li>If the locale is not <a href="https://pontoon.mozilla.org/teams/">available</a> in Pontoon yet, <a href="products/firefox_desktop/../../tools/pontoon/adding_new_locale.html">consult this document</a> for instructions on how to add it.</li>
<li>File a bug to create a new Mercurial repository in <a href="https://hg.mozilla.org/l10n-central/">l10n-central</a>. Several bug templates, including one to request a new repository, are available in <a href="https://l10n.mozilla.org/bugs/new-locale">this page</a>. For more information about these templates, <a href="products/firefox_desktop/adding_nightly.html">refer to this document</a>.</li>
<li>Push at least one change to the repository, otherwise Pontoon will not pick it up during sync. The safest change is to initialize the <code>toolkit/chrome/global/intl.properties</code> file with the correct values (<a href="https://hg.mozilla.org/l10n-central/ppl/rev/b3fd0faf59b0b45b2cf30c01d85157beee2a0bd0">example</a>).</li>
</ul>
<p>Once the repository is available and contains at least one commit, the locale can be added to the Firefox project in Pontoon.</p>
<h1><a class="header" href="#adding-a-new-locale-to-nightly-builds" id="adding-a-new-locale-to-nightly-builds">Adding a new locale to Nightly builds</a></h1>
<ul>
<li><a href="products/firefox_desktop/adding_nightly.html#file-a-tracking-bug-and-dependencies-to-add-the-new-locale">File a tracking bug and dependencies to add the new locale</a></li>
<li><a href="products/firefox_desktop/adding_nightly.html#verify-content-in-l10n-repository">Verify content in l10n repository</a></li>
<li><a href="products/firefox_desktop/adding_nightly.html#set-up-searchplugins">Set up searchplugins</a></li>
<li><a href="products/firefox_desktop/adding_nightly.html#add-new-locale-to-build-configuration">Add new locale to build configuration</a></li>
<li><a href="products/firefox_desktop/adding_nightly.html#verify-product-details-configuration">Verify product-details configuration</a></li>
</ul>
<h2><a class="header" href="#file-a-tracking-bug-and-dependencies-to-add-the-new-locale" id="file-a-tracking-bug-and-dependencies-to-add-the-new-locale">File a tracking bug and dependencies to add the new locale</a></h2>
<p>The first step is to create <a href="https://l10n.mozilla.org/bugs/new-locale">all the bugs</a> you need for this new locale. Let’s consider <code>Lao (lo)</code> as an example:</p>
<ul>
<li>Locale: <code>lo</code>.</li>
<li>Language: <code>Lao</code>.</li>
<li>Component: leave <code>Other</code> if there’s no component on Bugzilla yet, otherwise type in the component name in the <code>Mozilla Localizations</code> product (in this case <code>lo / Lao</code>).</li>
<li>Name: first name of the locale leader. It will be used as part of the bug messages.</li>
<li>Bugzilla ID: Bugzilla ID (email address) of the locale leader. It will be used to CC them to all these bugs.</li>
<li>Application: leave Firefox.</li>
<li>Version: leave the default.</li>
</ul>
<p>Click the <em>Create Buglinks</em> button, and a set of links will appear at the bottom of the page. Not all of them might be needed, for example LDAP is required only for Tableau access, repositories might already exist, etc. Make sure to always start with the <code>shipping</code> link, since that’s going to be the tracker bug, with an alias used in other bugs to set dependencies (<code>fx-l10n-LOCALECODE</code>, <code>fx-l10n-lo</code> in this example).</p>
<p>Always double check the content of the bugs for errors or outdated content. If the information is obsolete, you can update the templates in this <a href="https://wiki.mozilla.org/L10n:Bugogram">Wiki page</a> (it will require a new deployment of Elmo to production to update the code generating the links).</p>
<h2><a class="header" href="#verify-content-in-l10n-repository" id="verify-content-in-l10n-repository">Verify content in l10n repository</a></h2>
<p>Before enabling the build, it’s a good idea to perform some basic checks:</p>
<ul>
<li>Check <code>toolkit/global/intl.properties</code> (<a href="https://hg.mozilla.org/mozilla-central/file/default/toolkit/locales/en-US/chrome/global/intl.properties">en-US version</a>) for evident mistakes.</li>
<li>Check if there’s a <code>region.properties</code> file in <code>browser/chrome/browser-region/region.properties</code>, if needed replace it with the <a href="products/firefox_desktop/../searchplugins/files/desktop_region.properties">stock version</a>.</li>
</ul>
<h2><a class="header" href="#set-up-searchplugins" id="set-up-searchplugins">Set up searchplugins</a></h2>
<p>Check the <a href="products/firefox_desktop/../searchplugins/setup_searchplugins.html">Set up searchplugins</a> document for detailed instructions on how to set up searchplugins for new locales. This has become an optional step for setting up Nightly builds, but it remains mandatory before allowing the locale to ride the trains to Beta and Release.</p>
<h2><a class="header" href="#add-new-locale-to-build-configuration" id="add-new-locale-to-build-configuration">Add new locale to build configuration</a></h2>
<p>First of all make sure that your environment is <a href="products/firefox_desktop/../../tools/mercurial/setting_mercurial_environment.html">correctly set up</a>, update your local mozilla-unified clone and make sure it’s on the <code>central</code> bookmark:</p>
<pre><code class="language-BASH">$ cd ~/mozilla/mercurial/mozilla-unified
$ hg pull -u
$ hg up central
</code></pre>
<p>The first file to modify is <code>browser/locales/all-locales</code>, open it with your text editor of choice.</p>
<pre><code class="language-BASH">$ atom browser/locales/all-locales
</code></pre>
<p>And add the new locale to the list. With Atom and the Sort Lines package installed, you can press <code>F5</code> to make sure that the list is in <strong>alphabetical order</strong>.</p>
<p>The second file to modify is <code>browser/locales/l10n.toml</code>. This is the beginning of the file:</p>
<pre><code># This Source Code Form is subject to the terms of the Mozilla Public
# License, v. 2.0. If a copy of the MPL was not distributed with this
# file, You can obtain one at http://mozilla.org/MPL/2.0/.

basepath = &quot;../..&quot;

locales = [
    &quot;ach&quot;,
    &quot;af&quot;,
    &quot;an&quot;,
    &quot;ar&quot;,
    &quot;as&quot;,
...
</code></pre>
<p>Identify the <code>locales</code> section, and add the new locale code between double quotes, followed by a comma. As before, you can use Atom to make sure the list is in alphabetical order (make sure to select only the lines with actual locale codes before pressing <code>F5</code>).</p>
<p>After you’ve finished editing the files, check the status of the repository, and the diff.</p>
<pre><code class="language-BASH">$ hg status
M browser/locales/all-locales
M browser/locales/l10n.toml

$ hg diff
diff --git a/browser/locales/all-locales b/browser/locales/all-locales
--- a/browser/locales/all-locales
+++ b/browser/locales/all-locales
@@ -51,17 +51,16 @@ ja
 kn
 ko
 lij
+lo
 lt
 ltg
 lv

 diff --git a/browser/locales/l10n.toml b/browser/locales/l10n.toml
 --- a/browser/locales/l10n.toml
 +++ b/browser/locales/l10n.toml
 @@ -59,17 +59,16 @@ locales = [
      &quot;kn&quot;,
      &quot;ko&quot;,
      &quot;lij&quot;,
 +    &quot;lo&quot;,
      &quot;lt&quot;,
      &quot;ltg&quot;,
      &quot;lv&quot;,
</code></pre>
<p><code>M</code> in <code>hg status</code> indicates that the file has been modified, <code>+</code> in <code>hg diff</code> that the line has been added. Follow the instructions available in <a href="products/firefox_desktop/../../tools/mercurial/creating_mercurial_patch.html">this document</a> to create a patch, submit it for review, and land it.</p>
<h2><a class="header" href="#verify-product-details-configuration" id="verify-product-details-configuration">Verify product-details configuration</a></h2>
<p>Once a locale is added to Nightly builds, <code>product-details</code> will pick up automatically the new build. In order for the new build to be listed on <a href="https://www.mozilla.org/firefox/nightly/all/">mozilla.org</a>, the language name needs to be available in <a href="https://github.com/mozilla-releng/product-details/blob/production/public/1.0/languages.json">languages.json</a>. If missing:</p>
<ul>
<li>Open a pull request against the <code>production</code> branch of <a href="https://github.com/mozilla-releng/product-details">product-details</a> (<a href="https://github.com/mozilla-releng/product-details/pull/4">example</a>).</li>
<li>The language name needs to use Unicode code points in the format <code>\uXXXX</code> for non ASCII characters.</li>
</ul>
<p>The easiest way to convert the language name from UTF-8 is to use Python's JSON module. For example, to convert Tibetan (<code>བོད་སྐད་</code>):</p>
<pre><code>$ python -c 'import json; print(json.dumps(&quot;བོད་སྐད་&quot;))'
&quot;\u0f56\u0f7c\u0f51\u0f0b\u0f66\u0f90\u0f51\u0f0b&quot;
</code></pre>
<p>The final entry in <code>product-details</code> would look like this (<code>bo</code> is the locale code for Tibetan):</p>
<pre><code>&quot;bo&quot;: {
    &quot;English&quot;: &quot;Tibetan&quot;,
    &quot;native&quot;: &quot;\u0f56\u0f7c\u0f51\u0f0b\u0f66\u0f90\u0f51\u0f0b&quot;
},
</code></pre>
<p>Updates to <code>product-details</code> are pushed to production every time a new Beta or Release build is released. In case of urgency, updates can be triggered manually by Release Engineering.</p>
<h1><a class="header" href="#adding-a-new-locale-to-beta-and-release-builds" id="adding-a-new-locale-to-beta-and-release-builds">Adding a new locale to Beta and Release builds</a></h1>
<p>The majority of the work has already been completed when setting up <a href="products/firefox_desktop/adding_nightly.html">Nightly builds</a>. There are a few prerequisites before adding a new locale to Beta and Release:</p>
<ul>
<li>Localization should have reached a good level of completion, especially for user facing parts of the UI.</li>
<li>Localization team has demonstrated a consistent effort, being able to keep up for at least a couple of cycles with the incoming flow of new strings.</li>
<li>L10n-drivers have performed testing of the builds on different operative systems without identifying critical issues.</li>
<li>There is a relevant number of users on the Nightly channel. This number varies based on the language, for minority languages 10-20 users is a good result. Also, a trend showing growth is important as well.</li>
<li><a href="products/firefox_desktop/../searchplugins/setup_searchplugins.html">Set up searchplugins</a>, if configuration was not completed before enabling Nightly builds.</li>
<li>Make sure that <code>MOZ_LANG_TITLE</code> in <code>toolkit/defines.inc</code> has the correct value, since it’s used to set up the language pack on AMO.</li>
</ul>
<p>To track this work, you need to file a bug in Firefox::Build Config (like <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1359321">this example</a>), blocking the original tracking bug for the locale (<code>fx-l10n-LOCALE</code>).</p>
<h2><a class="header" href="#verify-language-name" id="verify-language-name">Verify language name</a></h2>
<p>The language name associated to the locale code is displayed in a few places in Firefox interface (language settings for web content, contextual menu for dictionaries). The language name needs to be defined in:</p>
<ul>
<li><a href="https://searchfox.org/mozilla-central/source/toolkit/locales/en-US/toolkit/intl/languageNames.ftl">languageNames.ftl</a>.</li>
<li><a href="https://searchfox.org/mozilla-central/source/toolkit/components/mozintl/mozIntl.jsm">mozIntl.jsm</a> (in the <code>availableLocaleDisplayNames</code> constant, <code>language</code> <a href="https://searchfox.org/mozilla-central/rev/131338e5017bc0283d86fb73844407b9a2155c98/toolkit/components/mozintl/mozIntl.jsm#451">set</a>).</li>
</ul>
<h2><a class="header" href="#add-locale-to-build-configuration" id="add-locale-to-build-configuration">Add locale to build configuration</a></h2>
<p>First of all make sure that your environment is <a href="products/firefox_desktop/../../tools/mercurial/setting_mercurial_environment.html">correctly set up</a>, update your local mozilla-unified clone and make sure it’s on the <code>central</code> bookmark:</p>
<pre><code class="language-BASH">$ cd ~/mozilla/mercurial/mozilla-unified
$ hg pull -u
$ hg up central
</code></pre>
<p>The file to modify is in <code>browser/locales/shipped-locales</code>, open it with your text editor of choice.</p>
<pre><code class="language-BASH">$ atom browser/locales/shipped-locales
</code></pre>
<p>And add the new locale to the list. With Atom and the Sort Lines package installed, you can press <code>F5</code> to make sure that the list is in <strong>alphabetical order</strong>.</p>
<p>After you’ve finished editing the file, check the status of the repository, and the diff. Let’s consider for example the task of adding Urdu (ur).</p>
<pre><code class="language-BASH">$ hg status
M browser/locales/shipped-locales

$ hg diff
--- a/browser/locales/shipped-locales
+++ b/browser/locales/shipped-locales
@@ -83,14 +84,13 @@ son
 te
 th
 tr
 uk
+ur
 uz
 vi
 xh
 zh-CN
</code></pre>
<p><code>M</code> in <code>hg status</code> indicates that the file has been modified, <code>+</code> in <code>hg diff</code> that the line has been added. Follow the instructions available in <a href="products/firefox_desktop/../../tools/mercurial/creating_mercurial_patch.html">this document</a> to create a patch, submit it for review, and land it.</p>
<p>You also need to set the <code>relnote-firefox</code> flag to <code>?</code> in the bug, the suggested comment is <code>Suggested for release notes: &quot;Locale added: LANGUAGE_NAME (LOCALE_CODE)&quot;</code>.</p>
<p>In order to have builds when the Beta cycle starts, make sure to sign-off the locale on <a href="https://l10n.mozilla.org/">the dashboard</a> (elmo) for central before next merge day, and verify that a sign-off is correctly available on beta before beta1.</p>
<h2><a class="header" href="#update-language-pack-settings-on-amo" id="update-language-pack-settings-on-amo">Update language pack settings on AMO</a></h2>
<p>The language pack for the new locale will be uploaded automatically by release automation on <em>addons.mozilla.org</em> (starting with the Beta version). A few follow-up manual steps are needed:</p>
<ul>
<li>The <code>Mozilla</code> account needs to be added as author for the language pack.</li>
<li>The <code>target_locale</code> field needs to be set for the language pack (via Django admin UI).</li>
<li>The locale needs to be defined in <a href="https://github.com/mozilla/addons-frontend/blob/master/src/core/languages.js">this JavaScript file</a>.</li>
</ul>
<p>For the first two steps, an email needs to be sent to AMO administrators (amo-admins(at)mozilla.com).</p>
<p>These steps will make the language pack available in both the <a href="https://addons.mozilla.org/firefox/language-tools/">Language Tools</a> page and the API used by Firefox to add new languages from preferences.</p>
<h1><a class="header" href="#removing-a-locale-from-firefox-desktop" id="removing-a-locale-from-firefox-desktop">Removing a locale from Firefox desktop</a></h1>
<p>Removing a locale from Firefox builds should be the last step in a long series of passages. A locale is removed when:</p>
<ul>
<li>There’s no visible activity in Pontoon for a year.</li>
<li>The translation level of Firefox is dropping, causing a good portion of the user interface to appear in English.</li>
<li>Outreach to existing community and locale leaders doesn’t produce results.</li>
<li>Attempts to find new localizers, via social networks and other tools (e.g. snippets), doesn’t find any potential contributors.</li>
</ul>
<h2><a class="header" href="#removing-a-locale-from-nightly" id="removing-a-locale-from-nightly">Removing a locale from Nightly</a></h2>
<p>If a locale is only shipping in Nightly, it’s enough to remove the locale from build configuration.</p>
<p>The process is identical to the one use to <a href="products/firefox_desktop/adding_nightly.html#add-new-locale-to-build-configuration">add a new locale</a>, just removing the locale code from <code>browser/locales/all-locales</code>.</p>
<p>Locale also needs to be removed from <a href="https://github.com/mozilla-releng/ship-it/blob/master/README-l10n.md">Ship It</a>.</p>
<h2><a class="header" href="#removing-a-locale-from-beta-and-release" id="removing-a-locale-from-beta-and-release">Removing a locale from Beta and Release</a></h2>
<p>Removing a locale already shipping in official builds (Beta, Release) is a much more complex process. These are the steps:</p>
<ul>
<li><a href="products/firefox_desktop/removing_locales.html#check-usage-statistics">Check usage statistics</a>.</li>
<li><a href="products/firefox_desktop/removing_locales.html#redirect-existing-users-to-another-locale">Redirect existing users to another locale</a>.</li>
<li><a href="products/firefox_desktop/removing_locales.html#remove-locale-from-beta-builds">Remove locale from Beta builds</a>.</li>
</ul>
<p>Mercurial repositories and Bugzilla components are not removed when dropping a locale.</p>
<p>Given the number of teams and processes involved, a <strong>tracking bug should be filed</strong> (<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1304743">example</a>).</p>
<h3><a class="header" href="#check-usage-statistics" id="check-usage-statistics">Check usage statistics</a></h3>
<p>Existing users for this locale need to be moved to another language, otherwise they would remain forever on an obsolete build. The first step is to determine the current usage statistics:</p>
<ul>
<li>Check the number of ADIs for this locale on <a href="https://dataviz.mozilla.org/#/views/LocalizedFirefoxDesktopADI/LocalizedFirefoxDesktopADI">Tableau</a>.</li>
<li>Check usage on Telemetry using a <a href="https://sql.telemetry.mozilla.org/queries/4237">query similar to this one</a>.</li>
</ul>
<p>If the locale has a significant userbase (in the hundreds of users), you need to determine the best locale to fall back to. Possible sources of information are:</p>
<ul>
<li>Wikipedia page for the language to determine where it’s spoken, and if there are other languages commonly spoken in the area.</li>
<li><a href="https://dataviz.mozilla.org/#/views/LocalizedFirefoxDesktopADI/LocalizedFirefoxDesktopADI">Tableau</a> for the language distribution in these countries.</li>
</ul>
<p>You also need to verify with Business Development if there are <strong>contractual obligations regarding search engines</strong>.</p>
<p>For example, Belarusian was recently removed from builds:</p>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Belarusian_language">Belarusian</a> is the official language of Belarus. The Wikipedia page also has information about the number of people speaking both Russian and Belarusian in the region.</li>
<li>Russian is an official language of Belarus.</li>
<li>Russia has a low percentage of <a href="https://en.wikipedia.org/wiki/List_of_countries_by_English-speaking_population">population speaking English</a>.</li>
</ul>
<p>For these reasons, Russian was selected as the best fall back language for Belarusian. Unfortunately, sources might not always point into the same direction, in some cases en-US might be the only viable option.</p>
<h3><a class="header" href="#redirect-existing-users-to-another-locale" id="redirect-existing-users-to-another-locale">Redirect existing users to another locale</a></h3>
<p>Once identified the language to fall back to, a bug needs to be <a href="https://bugzilla.mozilla.org/enter_bug.cgi?product=Release%20Engineering&amp;component=Releases">filed in Release Engineering::Releases</a> to redirect users via update snippets. An example of such bug is <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1304747">available here</a>.</p>
<h3><a class="header" href="#remove-locale-from-beta-builds" id="remove-locale-from-beta-builds">Remove locale from Beta builds</a></h3>
<p>The process is identical to the one use to <a href="products/firefox_desktop/adding_release.html#add-locale-to-build-configuration">add a new locale</a>, just removing the locale code from <code>browser/locales/shipped-locales</code> in Beta. The change will ride the train to Release at the end of the cycle.</p>
<h1><a class="header" href="#fluent-migrations" id="fluent-migrations">Fluent migrations</a></h1>
<p><a href="https://firefox-source-docs.mozilla.org/l10n/migrations/index.html">Fluent migrations</a> are used to migrate existing translations from legacy formats (DTD, properties) to Fluent, or existing Fluent messages to new messages or different FTL files.</p>
<p>At the core of each migration there is a Python file, called <strong>migration recipe</strong>, that instructs the system on how to port existing translations to Fluent. Typically, a patch migrating content to Fluent will:</p>
<ul>
<li>Add new Fluent strings or files.</li>
<li>Remove obsolete strings.</li>
<li>Include a migration recipe.</li>
</ul>
<p>Once such patch lands in <code>mozilla-central</code>, it will be converted as part of the cross-channel generation, and pushed to a quarantine repository (<code>gecko-strings-quarantine</code>). At this point, this new content is not visible yet in <a href="https://pontoon.mozilla.org/">Pontoon</a>.</p>
<p>The goal of migrations is to port existing translations to the new format without forcing community to retranslate them. For that to happen, migrations need to be performed before the new strings are pushed to the official <code>gecko-strings</code> repository, and become available in Pontoon.</p>
<p>This means that patches including migrations should only be pushed from the quarantine repository to <code>gecko-strings</code> following the steps described in this document.</p>
<h2><a class="header" href="#running-fluent-migrations" id="running-fluent-migrations">Running Fluent migrations</a></h2>
<p>This section of the document describes in detail which operations need to be performed in order to run migrations on over 150 Mercurial repositories for Firefox.</p>
<h3><a class="header" href="#prerequisites" id="prerequisites">Prerequisites</a></h3>
<p>Several access rights are required:</p>
<ul>
<li>Write access to <a href="https://hg.mozilla.org/l10n-central">l10n-central</a>, i.e. SSH access with <code>active_scm_l10n</code> rights. It’s possible to check your <em>Access Groups</em> in <a href="https://people.mozilla.org/e#nav-access-groups">your profile on people.mozilla.org</a>.</li>
<li>Sign-off rights in <a href="https://l10n.mozilla.org/">Elmo</a>.</li>
<li>Admin access to <a href="https://pontoon.mozilla.org/">Pontoon</a>.</li>
<li>An account on Heroku with access to <a href="https://dashboard.heroku.com/apps/mozilla-pontoon/resources">Pontoon apps</a>.</li>
</ul>
<p>In order to run migrations:</p>
<ul>
<li>Install the <a href="https://pypi.org/project/fluent.migrate/">fluent.migrate</a> Python package.</li>
<li>Clone all <a href="https://hg.mozilla.org/l10n-central">l10n-central</a> repositories.</li>
<li>Clone <a href="https://hg.mozilla.org/users/axel_mozilla.com/gecko-strings-quarantine/">gecko-strings-quarantine</a> and <a href="https://hg.mozilla.org/l10n/gecko-strings">gecko-strings</a>.</li>
</ul>
<p>A set of scripts to automate cloning and updating of the l10n-central repositories is <a href="https://github.com/flodolo/scripts/tree/master/mozilla_l10n/clone_hgmo">available here</a>.</p>
<h3><a class="header" href="#ensure-there-are-no-blocking-issues-in-gecko-strings-quarantine" id="ensure-there-are-no-blocking-issues-in-gecko-strings-quarantine">Ensure there are no blocking issues in gecko-strings-quarantine</a></h3>
<p>As part of migrations, content needs to be pushed from the quarantine repository to <code>gecko-strings</code>. Since content can’t be pushed selectively, any pending issue needs to be solved before starting the process. For more information about the review process, see <a href="products/firefox_desktop/../review/review.html">this document</a>.</p>
<h3><a class="header" href="#clean-up-existing-sign-offs" id="clean-up-existing-sign-offs">Clean up existing sign-offs</a></h3>
<p>Migrations will create new changesets in each of the repositories, resulting in new sign-offs to review for the PM in charge of Firefox or l10n-drivers.</p>
<p>Before starting, sign off in Elmo all available changesets for the current Firefox Beta in the <em>Bulk Sign-offs</em> view. More details about the sign-off process are available in <a href="products/firefox_desktop/../review/signoffs.html#bulk-sign-offs">this document</a>.</p>
<p>In case of issues with one or more locales, the best solution is to either fix or unapprove the problematic strings in Pontoon, and wait for the changes to land in the next scheduled sync, in order to completely empty the queue of sign-offs.</p>
<h3><a class="header" href="#stop-sync-in-pontoon" id="stop-sync-in-pontoon">Stop sync in Pontoon</a></h3>
<p>Before starting the migration process, sync needs to be suspended for all projects relying on the l10n-central repositories. The list of affected projects is:</p>
<ul>
<li>Firefox</li>
<li>Thunderbird</li>
<li>Seamonkey</li>
<li>Lightning</li>
</ul>
<p>In order to disable sync, access each project from the <a href="https://pontoon.mozilla.org/admin/">admin panel</a>, and select the checkbox <code>SYNC DISABLED</code> at the bottom of the page, then <code>SAVE PROJECT</code>.</p>
<p>This is needed for several reasons:</p>
<ul>
<li>It removes the chance of conflicts in the l10n repository between the running migration and Pontoon committing changes for other projects.</li>
<li>The migrated strings need to be added in the same cycle as the new strings for the source language (<code>en-US</code>). If they’re added before, Pontoon will ignore them, creating a misalignment between internal database and l10n repositories. If they’re added after, these strings will be displayed as missing in Pontoon, and some locales might try to translate them while it’s not needed.</li>
</ul>
<p>The last step here is to make sure that the current sync process has completed, then increase the resources assigned to the Heroku worker:</p>
<ul>
<li>Check the <a href="https://pontoon.mozilla.org/sync/log/">Sync Logs</a> page, click on the last one, and make sure that there are no projects with <code>---</code> in the <code>DURATION</code> field.</li>
<li>In <a href="https://dashboard.heroku.com/apps/mozilla-pontoon/resources">Heroku</a>, switch the <em>worker</em> from <code>PM</code> (Performance-M dynos) to <code>PL</code> (Performance-L dynos).</li>
</ul>
<p>It’s important to make sure that there is no sync in progress when upgrading the worker, because that will kill any pending process.</p>
<h3><a class="header" href="#test-the-migrations-locally" id="test-the-migrations-locally">Test the migrations locally</a></h3>
<p>A series of tools and helpers to run migrations is available in <a href="https://github.com/flodolo/fluent-migrations">this repository</a>:</p>
<ul>
<li>Clone the repository locally and follow the instructions available in the <a href="https://github.com/flodolo/fluent-migrations/blob/master/README.md">README</a> to set the configuration file.</li>
<li>Add the new migration recipes in the <code>recipes</code> folder. The script will look for any Python file starting with <code>bug_</code> in that folder, so it’s possible to run multiple migrations in one pass. More information about the folder’s structure are available in the repository’s README.</li>
</ul>
<p>At this point, while each migration has been tested as part of the review before landing, it’s always good to run the migration against one locale, e.g. <code>it</code>:</p>
<ul>
<li>Update the locale’s repository, check the results of <code>compare-locales</code>. Assuming l10n repositories are cloned in <code>~/migrations/locales</code>, and the quarantine repository in <code>~/migrations/gecko-strings-quarantine</code>, the command to run is <code>compare-locales ~/migrations/gecko-strings-quarantine/_configs/browser.toml ~/migrations/locales it</code>. Save the output in order to compare it with the results after the migration.</li>
<li>Run the migration, without pushing, only for <code>it</code>: <code>./scripts/migrate it wet-run</code>. Then run compare-locales again, and check if the results are as expected: migrated strings should not appear as missing anymore, and there should be no errors.</li>
<li>If everything looks as expected, re-run the script adding the push option <code>./scripts/migrate it wet-run push</code>.</li>
</ul>
<h3><a class="header" href="#push-updates-to-gecko-strings" id="push-updates-to-gecko-strings">Push updates to gecko-strings</a></h3>
<p>Before <a href="products/firefox_desktop/../review/review.html#push-reviewed-strings-to-gecko-strings">pushing updates</a> to the official <a href="https://hg.mozilla.org/l10n/gecko-strings">gecko-strings repository</a>, make sure that:</p>
<ul>
<li>The new strings and migrations are available in the <a href="https://hg.mozilla.org/users/axel_mozilla.com/gecko-strings-quarantine">quarantine repository</a>.</li>
<li>There are <a href="products/firefox_desktop/fluent_migrations.html#ensure-there-are-no-blocking-issues-in-gecko-strings-quarantine">no pending issues</a> that prevent the current content to be exposed in Pontoon.</li>
<li>The migration has been tested locally and works as expected.</li>
</ul>
<p>Once the new strings are pushed to <code>gecko-strings</code>, there’s no easy way to roll back, and the procedure needs to be completed before re-enabling sync in Pontoon. The alternative is forcing all locales to retranslate this content, and losing the entire benefit of migrations.</p>
<p>Pontoon relies on a <a href="https://hg.mozilla.org/users/m_owca.info/firefox-central/">different repository</a>, that is generated every 20 minutes based on the content of <code>gecko-strings</code>. That’s why it’s useful to run this update before starting the actual migrations.</p>
<h3><a class="header" href="#run-migrations" id="run-migrations">Run migrations</a></h3>
<p>To run the migration on all repositories, use <code>./scripts/migrate wet-run push</code> in the same environment used for testing. For each repository, this will:</p>
<ul>
<li>Pull changes.</li>
<li>Run the migration and commit changes.</li>
<li>Push changes to the remote.</li>
</ul>
<p>The duration of this step depends on the number of migrations and the speed of the Internet connection, but it should take about 20-30 minutes.</p>
<p>While migrations run, it’s important to look out for errors in the console, even if the standard output is quite noisy:</p>
<ul>
<li>Python errors with a stack trace are unlikely at this stage of the development, since it means that the code encountered a scenario that it’s unable to manage. If something is broken in the <code>fluent.migrate</code> package, or there are issues with Python dependencies, the migration should stop at the very beginning.</li>
<li>For Mercurial, one potential error scenario is a push that would create a new head in the remote repository (<code>abort: push creates new remote head</code>, followed by a changeset ID). The script automatically pulls from the remote repository before running migrations, and Pontoon’s sync is disabled, so that shouldn’t happen, unless a previous migration failed to push to remote and left unsynced local commits. In this case, the easiest solution is to clone the repository for this locale from scratch, and run the migration only for that specific locale.</li>
</ul>
<h3><a class="header" href="#re-enable-sync-in-pontoon" id="re-enable-sync-in-pontoon">Re-enable Sync in Pontoon</a></h3>
<p>Once the actual migration is complete, the next step is to re-enable sync in Pontoon. This needs to be done one project at a time, since Pontoon takes a lot of time processing this amount of changes, creating a bottleneck in the sync for all projects.</p>
<p>Before starting, make sure that the <a href="https://hg.mozilla.org/users/m_owca.info/firefox-central/">Pontoon repository</a> has the commit with the new strings.</p>
<ul>
<li>Access the <a href="https://pontoon.mozilla.org/admin/projects/firefox/">admin panel for Firefox</a>, click the <code>SYNC</code> button at the bottom, then deselect <code>SYNC DISABLED</code> and click <code>SAVE PROJECT</code>.</li>
<li>Clicking the <code>SYNC</code> button will spawn a new sync process just for Firefox. Check the <a href="https://pontoon.mozilla.org/sync/log/">Sync Logs</a> page to see when it’s finished. Depending on the amount of changes, this can require from 15 to over 30 minutes. It’s also possible to monitor the status in Papertrail, accessible from the <a href="https://dashboard.heroku.com/apps/mozilla-pontoon/resources">Resources</a> page in Heroku, and filter the log using the string <code>app/worker</code>.</li>
</ul>
<p>Once the sync is completed, repeat the process for each of the other projects (Thunderbird, Seamonkey, Lightning).</p>
<p>When sync is re-enabled for all projects, switch back the <em>worker</em> to <code>PM</code> in <a href="https://dashboard.heroku.com/apps/mozilla-pontoon/resources">Heroku</a>. Once again, make sure that there are no running sync processes before doing it.</p>
<h3><a class="header" href="#update-sign-offs" id="update-sign-offs">Update sign-offs</a></h3>
<p>At this point all locales with migrated strings will have a new changeset available for sign off. Given that the changes are relatively safe, <a href="products/firefox_desktop/../review/signoffs.html#bulk-sign-offs">bulk sign-offs</a> can be used, monitoring only a few locales to double check the output (the only diff will be from the migration).</p>
<p>This can be done concurrently with the previous step.</p>
<h1><a class="header" href="#firefox-l10n-faqs" id="firefox-l10n-faqs">Firefox L10N FAQs</a></h1>
<p>This document includes a series of frequently asked questions regarding Firefox and localization, mostly targeted at developers, but useful for product managers and engineering program managers as well.</p>
<ul>
<li><a href="products/firefox_desktop/firefox_l10n_faqs.html#general">General</a>
<ul>
<li><a href="products/firefox_desktop/firefox_l10n_faqs.html#who-can-i-contact-if-i-have-more-questions">Who can I contact if I have more questions?</a></li>
<li><a href="products/firefox_desktop/firefox_l10n_faqs.html#should-i-enable-my-feature-only-for-english-or-ship-it-in-english-for-everyone">Should I enable my feature only for English, or ship it in English for everyone?</a></li>
</ul>
</li>
<li><a href="products/firefox_desktop/firefox_l10n_faqs.html#schedule-and-release-cycle">Schedule and release cycle</a>
<ul>
<li><a href="products/firefox_desktop/firefox_l10n_faqs.html#i-landed-strings-in-mozilla-central-when-are-they-going-to-be-localized">I landed strings in mozilla-central, when are they going to be localized?</a></li>
<li><a href="products/firefox_desktop/firefox_l10n_faqs.html#can-i-uplift-a-patch-to-beta-or-release">Can I uplift a patch to Beta or Release?</a></li>
<li><a href="products/firefox_desktop/firefox_l10n_faqs.html#i-need-to-add-new-strings-for-version-x-do-i-still-have-time">I need to add new strings for version X, do I still have time?</a></li>
</ul>
</li>
<li><a href="products/firefox_desktop/firefox_l10n_faqs.html#development">Development</a>
<ul>
<li><a href="products/firefox_desktop/firefox_l10n_faqs.html#where-can-i-find-guidelines-for-developers">Where can I find guidelines for developers?</a></li>
<li><a href="products/firefox_desktop/firefox_l10n_faqs.html#how-can-i-get-my-strings-localized">How can I get my strings localized?</a></li>
<li><a href="products/firefox_desktop/firefox_l10n_faqs.html#where-can-i-find-the-localized-strings">Where can I find the localized strings?</a></li>
<li><a href="products/firefox_desktop/firefox_l10n_faqs.html#can-i-land-content-without-exposing-it-for-localization">Can I land content without exposing it for localization?</a></li>
<li><a href="products/firefox_desktop/firefox_l10n_faqs.html#how-can-i-test-a-different-locale">How can I test a different locale?</a></li>
</ul>
</li>
<li><a href="products/firefox_desktop/firefox_l10n_faqs.html#translation-completion-and-community">Translation completion and community</a>
<ul>
<li><a href="products/firefox_desktop/firefox_l10n_faqs.html#is-my-feature-going-to-be-localized-in-language-x-before-launch">Is my feature going to be localized in language X before launch?</a></li>
<li><a href="products/firefox_desktop/firefox_l10n_faqs.html#how-do-i-communicate-with-localizers-about-my-feature-or-patch">How do I communicate with localizers about my feature or patch?</a></li>
<li><a href="products/firefox_desktop/firefox_l10n_faqs.html#i-see-pending-suggestions-in-pontoon-how-can-i-get-them-approved">I see pending suggestions in Pontoon, how can I get them approved?</a></li>
<li><a href="products/firefox_desktop/firefox_l10n_faqs.html#how-can-i-check-if-my-feature-is-localized">How can I check if my feature is localized?</a></li>
<li><a href="products/firefox_desktop/firefox_l10n_faqs.html#how-can-i-see-all-translations-available-for-a-specific-string">How can I see all translations available for a specific string?</a></li>
</ul>
</li>
</ul>
<h2><a class="header" href="#general" id="general">General</a></h2>
<h3><a class="header" href="#who-can-i-contact-if-i-have-more-questions" id="who-can-i-contact-if-i-have-more-questions">Who can I contact if I have more questions?</a></h3>
<p>A Program Manager (L10N PM) is assigned to any Mozilla project that is localized through community. You can find this information in <a href="https://pontoon.mozilla.org/projects/firefox/">Pontoon</a> for any project in the header section, and more information about the localization team is available in the Mana page dedicated to <a href="https://mana.mozilla.org/wiki/pages/viewpage.action?pageId=66651657">Localization</a> (available to staff/NDA only).</p>
<h3><a class="header" href="#should-i-enable-my-feature-only-for-english-or-ship-it-in-english-for-everyone" id="should-i-enable-my-feature-only-for-english-or-ship-it-in-english-for-everyone">Should I enable my feature only for English, or ship it in English for everyone?</a></h3>
<p>Shipping a feature only for en-US is not great, since it creates confusion for users: features are described in SUMO articles or publicized in blog posts, but not available for more than 60% of Firefox user base.</p>
<p>Shipping a feature in English for everyone is not a good option either: as an English speaker, imagine starting your browser and finding a window in Chinese.</p>
<p>In the end, both options are a product decision, and the localization team can help assess the impact on users and community. How to ship a feature only to en-US users depends on several factors (technology, information available at the time the feature is loaded, etc.), and the best approach is to get in touch with the <a href="https://mana.mozilla.org/wiki/pages/viewpage.action?pageId=66651657">engineering part of the Localization team</a> (aka “tech team”).</p>
<h2><a class="header" href="#schedule-and-release-cycle" id="schedule-and-release-cycle">Schedule and release cycle</a></h2>
<h3><a class="header" href="#i-landed-strings-in-mozilla-central-when-are-they-going-to-be-localized" id="i-landed-strings-in-mozilla-central-when-are-they-going-to-be-localized">I landed strings in mozilla-central, when are they going to be localized?</a></h3>
<p>New string changes are periodically exported from mozilla-central into a repository called <code>gecko-strings-quarantine</code>, a unified repository that includes strings for all shipping versions of Firefox (nightly, beta, release). This repository is used as a buffer to avoid exposing potential issues to all locales working on Firefox.</p>
<p>Typically once or twice a week, the content of the quarantine repository is pushed to the official repository, called <code>gecko-strings</code>, used by <a href="https://pontoon.mozilla.org/projects/firefox/">Pontoon</a> as source reference. At this point, strings can be localized by community.</p>
<h3><a class="header" href="#can-i-uplift-a-patch-to-beta-or-release" id="can-i-uplift-a-patch-to-beta-or-release">Can I uplift a patch to Beta or Release?</a></h3>
<p>While Nightly is always open for new strings, Beta and Release are string frozen, meaning that patches with new strings are normally not allowed to land.</p>
<p>Uplifts need to be evaluated case by case, but in general they should be avoided in the context of a 4-weeks release cycle. Possible alternatives are uplifting ad-hoc patches without string changes, or exposing the feature/change only to English users.</p>
<p>One more thing to consider is the timing of the uplift. The second part of the Beta cycle is completely frozen, meaning that we can’t take any updates to localization and ship it in that version. Anything uplifted close to the deadline, or after, will ship untranslated. For more details about the Beta timeline for l10n, see the <a href="products/firefox_desktop/../review/signoffs.html#timeline-and-deadlines">Sign-offs document</a>.</p>
<h3><a class="header" href="#i-need-to-add-new-strings-for-version-x-do-i-still-have-time" id="i-need-to-add-new-strings-for-version-x-do-i-still-have-time">I need to add new strings for version X, do I still have time?</a></h3>
<p>If version X is in Nightly, i.e. currently developed in mozilla-central, there is time to land until merge day, when the code moves from mozilla-central to mozilla-beta.</p>
<p>The sooner you land content in mozilla-central, the higher will be the chances that the content will be localized in several languages before reaching release.</p>
<h2><a class="header" href="#development" id="development">Development</a></h2>
<h3><a class="header" href="#where-can-i-find-guidelines-for-developers" id="where-can-i-find-guidelines-for-developers">Where can I find guidelines for developers?</a></h3>
<p>A document including plenty of best practices is <a href="https://developer.mozilla.org/en-US/docs/Mozilla/Localization/Localization_content_best_practices">available on MDN</a>, while specific information around Fluent is available <a href="https://firefox-source-docs.mozilla.org/l10n/fluent/review.html">in this document</a>. In case of doubts, reach out to the Firefox L10N PM or localization team for clarifications.</p>
<h3><a class="header" href="#how-can-i-get-my-strings-localized" id="how-can-i-get-my-strings-localized">How can I get my strings localized?</a></h3>
<p>Strings need to be added to localization files in known locations within the mozilla-central tree. For all the technical details about these paths and the supported formats, see <a href="https://firefox-source-docs.mozilla.org/build/buildsystem/locales.html#exposing-strings">this document</a>.</p>
<p>Once strings land in mozilla-central, they will be exposed for localization in Pontoon within a few days.</p>
<h3><a class="header" href="#where-can-i-find-the-localized-strings" id="where-can-i-find-the-localized-strings">Where can I find the localized strings?</a></h3>
<p>All shipping versions of Firefox are built from a single Mercurial repository for each locale (<code>l10n-central</code>). Repositories are available <a href="https://hg.mozilla.org/l10n-central/">here</a>.</p>
<h3><a class="header" href="#can-i-land-content-without-exposing-it-for-localization" id="can-i-land-content-without-exposing-it-for-localization">Can I land content without exposing it for localization?</a></h3>
<p>If your content is not stable, or you want to iterate quickly over it before exposing it for localization, it’s possible to land a string file outside of the known paths, and access it from the code.</p>
<p>For Fluent, you can follow examples like <a href="https://hg.mozilla.org/mozilla-central/rev/e3bc9f1bde6e">this patch</a>, where the FTL file is stored outside of the localizable paths, and loaded as “preview”.</p>
<h3><a class="header" href="#how-can-i-test-a-different-locale" id="how-can-i-test-a-different-locale">How can I test a different locale?</a></h3>
<p>The answer depends on the version you want to test.</p>
<p>Official builds:</p>
<ul>
<li>On Beta and Release, you can switch the UI language directly from Firefox settings. You can also download localized builds <a href="http://www.mozilla.org/firefox/all">from mozilla.org</a>.</li>
<li>On Nightly and Developer Edition this feature is disabled, since language packs are not reliable. You can still manually install language packs for the version you’re using directly from FTP (<a href="http://ftp.mozilla.org/pub/firefox/nightly/latest-mozilla-central-l10n/linux-x86_64/xpi/">Nightly</a>, <a href="http://archive.mozilla.org/pub/devedition/releases/77.0b2/win64/xpi/">DevEdition</a> changing the build in the URL), then enable the language switcher by setting <code>intl.multilingual.enabled</code> to <code>True</code> in about:config.</li>
</ul>
<p>Local builds:</p>
<ul>
<li>If you’re using Fluent, you can test your feature for localizability issues, like layout constraints or hardcoded content, using <a href="https://firefox-source-docs.mozilla.org/l10n/fluent/tutorial.html#pseudolocalization">pseudolocales</a>.</li>
<li>If you’re building locally, you can try installing the latest language pack for Nightly (it might not work as expected if you’re adding new strings, or break after an update). Language packs are stored on FTP inside the <code>linux-x86_64/xpi/</code> folder for daily builds, or <a href="http://archive.mozilla.org/pub/firefox/nightly/latest-mozilla-central-l10n/linux-x86_64/xpi/">latest-mozilla-central-l10n</a>.</li>
<li>You can <a href="https://firefox-source-docs.mozilla.org/build/buildsystem/locales.html#instructions-for-single-locale-repacks-for-developers">build directly in a different locale</a> (no support for artifact builds).</li>
<li>It’s possible to add specific l10n repacks to a <a href="https://wiki.mozilla.org/ReleaseEngineering/TryServer#Scheduling_jobs_with_Treeherder">Try Server</a> push. For example, to add French: select <em>Add new Jobs</em>, then select the <code>fr</code> locale in <code>L10n-Rpk</code>. Once the job is completed, builds will be available as artifacts under <code>L10n (BsX)</code>, where <code>X</code> changes depending on the locale.</li>
</ul>
<h2><a class="header" href="#translation-completion-and-community" id="translation-completion-and-community">Translation completion and community</a></h2>
<h3><a class="header" href="#is-my-feature-going-to-be-localized-in-language-x-before-launch" id="is-my-feature-going-to-be-localized-in-language-x-before-launch">Is my feature going to be localized in language X before launch?</a></h3>
<p>Each community will localize new content at different times: some locales will have a complete localization within hours, while others might take weeks or months. Our continuous localization infrastructure allows us to release Firefox with incomplete translations falling back on a backup locale in case of missing strings or errors.</p>
<p>Given that localization is managed by community volunteers, there is no SLA or guarantee that a product will be completely localized before launch. For more information, see <a href="https://mana.mozilla.org/wiki/pages/viewpage.action?pageId=66651657">this page on Mana</a> (available to staff/NDA only).</p>
<h3><a class="header" href="#how-do-i-communicate-with-localizers-about-my-feature-or-patch" id="how-do-i-communicate-with-localizers-about-my-feature-or-patch">How do I communicate with localizers about my feature or patch?</a></h3>
<p>If there is some specific information that you want to convey to localizers, like testing instructions or particular issues to look out for, get in touch with the <a href="products/firefox_desktop/firefox_l10n_faqs.html#who-can-i-contact-if-i-have-more-questions">L10N PM for Firefox</a>. They will help you identify the best channel and way to relay this information.</p>
<h3><a class="header" href="#i-see-pending-suggestions-in-pontoon-how-can-i-get-them-approved" id="i-see-pending-suggestions-in-pontoon-how-can-i-get-them-approved">I see pending suggestions in Pontoon, how can I get them approved?</a></h3>
<p>Standard users in Pontoon can only provide suggestions: these translations are visible in Pontoon, but don’t get committed to repositories or ship in products.</p>
<p>For each locale there are translators and managers that can review these suggestions, and eventually approve them. The timing depends on each locale’s workflow.</p>
<h3><a class="header" href="#how-can-i-check-if-my-feature-is-localized" id="how-can-i-check-if-my-feature-is-localized">How can I check if my feature is localized?</a></h3>
<p>There’s no easy way to see this information in Pontoon. If all the strings are stored in a single file, only used for that feature, or you have a detailed list of all the strings used, it’s possible to extract this data manually. Get in touch with the <a href="products/firefox_desktop/firefox_l10n_faqs.html#who-can-i-contact-if-i-have-more-questions">Firefox L10N PM</a> for more information.</p>
<h3><a class="header" href="#how-can-i-see-all-translations-available-for-a-specific-string" id="how-can-i-see-all-translations-available-for-a-specific-string">How can I see all translations available for a specific string?</a></h3>
<p>Pontoon doesn’t allow to see all translations for a specific string, but you can use Transvision for it:</p>
<ul>
<li>Search for the string (by ID or text), making sure that gecko-strings is selected as repository</li>
<li>In the results, click on the green <code>all locales</code> tag close a string to see all available translations. Results are also available via API (linked at the bottom of the page).</li>
</ul>
<h1><a class="header" href="#review-process" id="review-process">Review process</a></h1>
<ul>
<li><a href="products/review/review.html">How to review strings in Firefox desktop</a></li>
<li><a href="products/review/signoffs.html">How to manage sign-offs for Firefox desktop and Firefox for Android</a></li>
</ul>
<h1><a class="header" href="#sign-offs-for-firefox-desktop-and-firefox-for-android" id="sign-offs-for-firefox-desktop-and-firefox-for-android">Sign-offs for Firefox desktop and Firefox for Android</a></h1>
<ul>
<li><a href="products/review/signoffs.html#overview">Overview</a></li>
<li><a href="products/review/signoffs.html#timeline-and-deadlines">Timeline and deadlines</a>
<ul>
<li><a href="products/review/signoffs.html#updating-release">Updating release</a></li>
</ul>
</li>
<li><a href="products/review/signoffs.html#how-to-perform-sign-offs">How to perform sign-offs</a></li>
<li><a href="products/review/signoffs.html#bulk-sign-offs">Bulk sign-offs</a></li>
<li><a href="products/review/signoffs.html#things-to-check-when-doing-a-sign-off">Things to check when doing a sign-off</a></li>
</ul>
<h2><a class="header" href="#overview" id="overview">Overview</a></h2>
<p>Sign-offs are a way for l10n-drivers to indicate that a specific changeset is technically sound and ready to ship to general audience in Firefox (Beta, Release). Currently, thanks to cross-channel, we ship all versions of Firefox from a <a href="https://hg.mozilla.org/l10n-central/">single localization repository</a>, but each channel uses a different snapshot in time of that repository.</p>
<p>While sign-offs are performed on l10n.mozilla.org (<em>Elmo</em>), the resulting data is stored in each tree (<code>mozilla-central</code>, <code>mozilla-beta</code>, etc.) to be used directly by the build system. A job, called <code>l10n-bumper</code>, runs on Taskcluster every hour, retrieves sign-off information from Elmo via API, and stores it in a file called <code>l10n-changesets.json</code>:</p>
<ul>
<li>For Nightly (<code>mozilla-central</code>), <a href="https://hg.mozilla.org/mozilla-central/file/default/browser/locales/l10n-changesets.json">l10n-changesets.json</a> always uses the revision <code>default</code>, and it’s only updated when changing the locales available in the build. That means that Nightly builds always use the tip of the l10n repository, i.e. the latest changes available for each locale.</li>
<li>Beta builds (<code>mozilla-beta</code>) only use the signed off changesets for each locale. Unlike in <code>mozilla-central</code>, <a href="https://hg.mozilla.org/releases/mozilla-beta/file/default/browser/locales/l10n-changesets.json">l10n-changesets.json</a> contains the changesets signed off in Elmo instead of <code>default</code>.</li>
<li>When the Beta code is merged to Release, <a href="https://hg.mozilla.org/releases/mozilla-release/file/default/browser/locales/l10n-changesets.json">l10n-changesets.json</a> moves together with the rest of the code to <code>mozilla-release</code>. That means that Release builds will use the same changesets as the last beta with the same version number, and any further change <a href="products/review/signoffs.html#updating-release">requires code uplifts</a>.</li>
</ul>
<h2><a class="header" href="#timeline-and-deadlines" id="timeline-and-deadlines">Timeline and deadlines</a></h2>
<p>This is how Beta looks like in a 4 weeks release cycle, with relevant milestones.</p>
<p><img src="products/review/../../assets/images/signoffs/beta_cycle.png" alt="Beta cycle" /></p>
<p>Sign-offs on Beta are not possible through the entire cycle: sign-offs deadline is on Wednesday, about 2 weeks before the release, to allow time for at least one more Beta build before the end of the cycle.</p>
<p>While it’s still possible to take last minute sign-offs during the rest of the third week, for example to fix bugs or improve coverage for tier 1 languages. that comes with increased risk, since there will be no time for another beta build to test these changes. Once the code merges from Beta to Release, any sign-off update would require a manual uplift to <code>mozilla-release</code> and a new Release Candidate (RC) build.</p>
<p>Given that the Beta version is closed to sign-offs for more than 10 days, to avoid accumulating a lot of review backlog, the PM in charge can decide to take sign-offs on the <a href="https://l10n.mozilla.org/shipping/dashboard?tree=fennec_central&amp;tree=fx_central">Nightly version</a> for the remaining part of the cycle.</p>
<p><img src="products/review/../../assets/images/signoffs/all_channels_timeline.png" alt="Timeline of all channels, 2 cycles" /></p>
<p>As explained at the beginning, sign-offs are not used for Nightly builds, but this approach has a few benefits:</p>
<ul>
<li>It reduces the content to review at the beginning of the Beta cycle. That’s particularly important when it comes to the amount of changes generated for Firefox desktop by <a href="products/review/../firefox_desktop/fluent_migrations.html">Fluent migrations</a>.</li>
<li>Since sign-offs are tied to a version number, when Nightly moves to Beta, the new Beta version will already have updated sign-offs and won’t fall back to outdated changesets. As a consequence, the first beta of the cycle will ships with better l10n coverage. In the example above, you start taking sign-offs for 77 at the end of the Nightly cycle. When 77 moves to Beta, it will already have update content compared to the last 76 sign-offs.</li>
</ul>
<h3><a class="header" href="#updating-release" id="updating-release">Updating release</a></h3>
<p>When the code moves from <code>mozilla-beta</code> to <code>mozilla-release</code>, <code>l10n-changesets.json</code> is frozen, as <code>l10n-bumper</code> is not configured to run against the release branch, and Elmo doesn’t allow to sign off changesets on the release channel.</p>
<p>In case of severe issues affecting one or more locales, it’s still possible to manually update the shipping changesets. A patch needs to be provided for <code>l10n-changesets.json</code> in <code>mozilla-release</code> branch and approved for uplift by Release Drivers (see for example <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1513259">this bug</a> and <a href="https://hg.mozilla.org/releases/mozilla-release/rev/308fd26a204e">associated patch</a>). Note that a dot release is needed in order to ship the updated version to users.</p>
<p>The same process applies to ESR versions, as long as the associated esr repository is included in the <a href="https://hg.mozilla.org/users/axel_mozilla.com/cross-channel-experimental/file/tip/initial/cli/_config.py">current version of cross-channel</a>.</p>
<h2><a class="header" href="#how-to-perform-sign-offs" id="how-to-perform-sign-offs">How to perform sign-offs</a></h2>
<p><a href="https://l10n.mozilla.org/shipping/dashboard?tree=fennec_beta&amp;tree=fx_beta">This page</a> only includes sign-offs for Firefox desktop (<code>fx_beta</code>) and Firefox for Android (<code>fennec_beta</code>) beta.</p>
<p><img src="products/review/../../assets/images/signoffs/signoffs_table.png" alt="Sign-offs table repository" /></p>
<p>A green checkmark is displayed in the <em>Status</em> column if the locale has a sign-off, while it’s empty if there are no sign-offs. This only happens for brand new locales that are only shipping in Nightly.</p>
<p>The <em>Action</em> column can display several icons:</p>
<ul>
<li>A prohibited icon indicates that there is no activity after the last sign-off (belonging to a previous version), and therefore it’s not possible to do an updated sign-off.</li>
<li>A sparkline icon indicates activity that should be checked:
<ul>
<li>Green indicates that the translation is complete (no error, no missing strings).</li>
<li>Orange means that the product is still incomplete.</li>
<li>Red means that there are errors in the localization. The number of errors and warnings is also reported within the table.</li>
</ul>
</li>
</ul>
<p>To perform the sign-off, click on the sparkline icon. It will open a new page, showing information about the last sign-off, and the changesets that follow it.</p>
<p><img src="products/review/../../assets/images/signoffs/changesets_table.png" alt="List of changesets" /></p>
<p>For each changeset, it’s possible to check <code>compare-locale</code>’s results by clicking on the link in the second column from the left. Errors and warnings would be reported in the link too.</p>
<p>Some changesets won’t have a link to <code>compare-locales</code>’s results (e.g. the second row in the image above). That indicates a changeset that doesn’t affect the product you’re currently signing off (e.g. a Thunderbird change in Firefox), and it’s not a good candidate for sign-offs.</p>
<p>By clicking in one of the cells in the rightmost column, by default you can display a diff between the latest changeset and the most recent sign-off. Note that both circles can be dragged, to display the diff between specific changesets. It’s also possible to load more changeset at the bottom of the table using the <em>Load more</em> button.</p>
<p><img src="products/review/../../assets/images/signoffs/diff_view.png" alt="Diff view" /></p>
<p>In this view, green means that content has been added, red it’s been removed, while orange indicates a change. Each level of the diff can be collapsed by clicking on the same line as the file or folder name.</p>
<p>Once you have reviewed the diff, you can return to the previous page, and sign off the changeset by clicking the <em>sign off…</em> button. To accept the sign-off, click the <em>Sign off</em> button:</p>
<p><img src="products/review/../../assets/images/signoffs/accept_signoff.png" alt="Requesting and accepting a sign-off" /></p>
<p>To explicitly reject a sign-off, unselect the <em>Sign off and accept</em> checkbox. Then click on <em>Review…</em> and reject the sign-off with a reason.</p>
<p><img src="products/review/../../assets/images/signoffs/reject_signoff.png" alt="Rejecting a sign-off" /></p>
<h2><a class="header" href="#bulk-sign-offs" id="bulk-sign-offs">Bulk sign-offs</a></h2>
<p>A <a href="https://l10n.mozilla.org/shipping/drivers">new view</a> has been added to Elmo to perform sign-offs in bulk. This is particularly useful, for example, after running <a href="products/review/../firefox_desktop/fluent_migrations.html">Fluent migrations</a>, when all locales receive changes and would require an updated sign-off.</p>
<p><img src="products/review/../../assets/images/signoffs/drivers_view.png" alt="Bulk sign-offs landing page" /></p>
<p>In the initial page it’s possible to select a product version. For example, clicking <code>Firefox 71</code> in the <em>Bulk Sign-Off</em> column will lead to this view:</p>
<p><img src="products/review/../../assets/images/signoffs/drivers_view_product.png" alt="Single product, bulk sign-offs page" /></p>
<p>The number of rows displayed depends on the number of changesets available to sign off for the requested product version. If there aren’t new changesets compared to the existing sign-offs, the table will be empty.</p>
<p>In each row:</p>
<ul>
<li>The first column shows the locale code, with a link to the locale’s sign-off page for the product version (e.g. <code>/shipping/signoffs/ach/fx71</code>).</li>
<li>The second column has the summary of <code>compare-locales</code>’s run for the latest changeset (link points to the full results). If empty, it means that there are no results available: either checks are still queued, or they didn’t run because the latest changeset doesn’t include files relevant for the requested product version (e.g. only Thunderbird changes, when the sign-off is for Firefox).</li>
<li>The third column links to the diff view between the last accepted sign-off and the latest changeset.</li>
</ul>
<p>After reviewing the diff, to accept a sign-off you can click the <em>Accept</em> button. It’s important to note that there will be no confirmation dialog, and it’s not possible to reject a sign-off from this view. The row will be automatically removed from the table after accepting a sign-off.</p>
<h2><a class="header" href="#things-to-check-when-doing-a-sign-off" id="things-to-check-when-doing-a-sign-off">Things to check when doing a sign-off</a></h2>
<p>The first thing to do is to look at errors and warnings. For warnings, always double check if the number increased from the last sign-off, identify which changeset introduced new warnings, and if they’re acceptable.</p>
<p>Here are a few more things to look out for when doing sign-offs:</p>
<ul>
<li>Strings, or portion of text, remaining in English or becoming empty.</li>
<li>Translated keyboard shortcuts (command keys). Unlike access keys, they should remain identical to English.</li>
<li>Changes to files that require review, like <code>region.properties</code>.</li>
<li><a href="https://mozilla-l10n.github.io/styleguides/mozilla_general/#brands-copyright-and-trademark">Changes to branding</a>, i.e. translated or transliterated brand names (Mozilla, Firefox).</li>
<li>Changes to <code>extensions/spellcheck</code> (dictionaries). We can only ship dictionaries if they have a compatible license. If a dictionary was already present, it’s likely to be OK. A brand new dictionary should land with a bug associated.</li>
</ul>
<h1><a class="header" href="#reviewing-strings-in-firefox-desktop" id="reviewing-strings-in-firefox-desktop">Reviewing strings in Firefox desktop</a></h1>
<ul>
<li><a href="products/review/review.html#review-landed-strings">Review landed strings</a>
<ul>
<li><a href="products/review/review.html#review-strings-landing-in-mozilla-central">Review strings landing in mozilla-central</a></li>
<li><a href="products/review/review.html#review-strings-landing-in-gecko-strings-quarantine">Review strings landing in gecko-strings-quarantine</a></li>
<li><a href="products/review/review.html#run-compare-locales-against-gecko-strings">Run compare-locales against gecko-strings</a></li>
<li><a href="products/review/review.html#run-compare-locales-against-a-localization-repository">Run compare-locales against a localization repository</a></li>
<li><a href="products/review/review.html#push-reviewed-strings-to-gecko-strings">Push reviewed strings to gecko-strings</a></li>
</ul>
</li>
</ul>
<h2><a class="header" href="#review-landed-strings" id="review-landed-strings">Review landed strings</a></h2>
<p>Starting from Firefox 57, all versions of Firefox desktop ship by localizing a single repository containing the reference English strings, called <a href="https://hg.mozilla.org/l10n/gecko-strings">gecko-strings</a>. It is generated from strings landing in the code repository for each branch (e.g. mozilla-central and comm-central for Nightly, mozilla-beta and comm-beta for Beta, etc.), and it’s exposed to localization tools like Pontoon.</p>
<p>There is a second repository, <a href="https://hg.mozilla.org/users/axel_mozilla.com/gecko-strings-quarantine">gecko-strings-quarantine</a>, used as a buffer to avoid exposing poor strings to the larger audience of localizers.</p>
<p>The localizations for all channels can be found in <a href="https://hg.mozilla.org/l10n-central/">l10n-central</a>, with a single repository for each locale.</p>
<p>The review process consists of three parts:</p>
<ul>
<li>Review strings landing in <code>mozilla-central</code>. Currently <code>comm-central</code> doesn’t undergo a similar review process.</li>
<li>Review strings landing in <code>gecko-strings-quarantine</code>. Currently, the quarantine repository is updated manually every few days.</li>
<li>Push reviewed strings to <code>gecko-strings</code>, and start the localization process.</li>
</ul>
<h3><a class="header" href="#review-strings-landing-in-mozilla-central" id="review-strings-landing-in-mozilla-central">Review strings landing in mozilla-central</a></h3>
<p>You can get the list of changesets touching localized strings in the last 2 days from <a href="https://hg.mozilla.org/mozilla-central/log?rev=keyword(%22locales/en-US%22)+and+pushdate(%22-2%22)">mozilla-central</a>. Adjust the <code>pushdate</code> part if you want to see more or less days.</p>
<p>There are some irrelevant changesets, like en-US dictionary updates, but the majority of landings are relevant and need to be checked for localization issues.</p>
<p>You need to open each changeset, and identify changed files that are relevant for localization (.properties, .dtd, .ini).</p>
<p>Things to look out for:</p>
<ul>
<li>Unclear strings and missing localization comments: the best way to identify them is to translate the strings, only having the string and comment as context (not the entire file, or the bug). For example: is the word used both a noun and a verb in English? Is the ID clear enough to give context (e.g. <code>buttonLabel</code>)?</li>
<li>String changes without new IDs.</li>
<li>Duplicated strings.</li>
<li><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Localization/Localization_content_best_practices">Localization issues</a>, like misused plural forms, unclear comments, etc.</li>
</ul>
<p>In case of issues, you have two options:</p>
<ul>
<li>Ask sheriffs (via bug or <a href="https://chat.mozilla.org/#/room/#sheriffs:mozilla.org">Matrix in #sheriffs</a>) to back out the patch.</li>
<li>Ask clarifications in the bug, and decide if it’s worth to stop exposing new strings until the issue is fixed.</li>
</ul>
<h3><a class="header" href="#review-strings-landing-in-gecko-strings-quarantine" id="review-strings-landing-in-gecko-strings-quarantine">Review strings landing in gecko-strings-quarantine</a></h3>
<p>The next step is to spot check changes landed in <a href="https://hg.mozilla.org/users/axel_mozilla.com/gecko-strings-quarantine/shortlog">gecko-strings-quarantine</a>. Here are some things to look out for:</p>
<ul>
<li>Check if a changeset is removing strings. This should happen only when a string landed in Nightly and was removed during the same cycle, or at the beginning of a release cycle when a group of strings becomes unused in all shipping versions.</li>
<li>Compare the changeset with the original landing in mozilla-central. Each changeset’s header contains a set of references (consider <a href="https://hg.mozilla.org/users/axel_mozilla.com/gecko-strings-quarantine/rev/9c9e89dd4fd5">this example</a>), the most important one is <code>X-Channel-Converted-Revision</code>, which links to the original landing in the code repository.</li>
</ul>
<p><strong>IMPORTANT:</strong> Patches including Fluent migrations need to be kept in quarantine, and can only be pushed to <code>gecko-strings</code> following the process described in <a href="products/review/../firefox_desktop/fluent_migrations.html">this document</a>.</p>
<h3><a class="header" href="#run-compare-locales-against-gecko-strings" id="run-compare-locales-against-gecko-strings">Run compare-locales against gecko-strings</a></h3>
<p>A good next step to check for issues is to run <a href="https://developer.mozilla.org/en-US/docs/Mozilla/Projects/compare-locales">compare-locales</a> against the <code>gecko-strings</code> repository.</p>
<p>First of all make sure that your environment is <a href="products/review/../../tools/mercurial/setting_mercurial_environment.html">correctly set up</a>, and update your local <code>mozilla-unified</code> clone.</p>
<p><code>compare-locales</code> needs to be installed on your system. You can either install a specific release, or clone the <a href="https://hg.mozilla.org/l10n/compare-locales/">hg repository</a> and install it via <code>pip install -e .</code>. You can check that <code>compare-locales</code> is running correctly by checking its version:</p>
<pre><code>$ compare-locales --version
compare-locales 2.1
</code></pre>
<p>Let’s assume that:</p>
<ul>
<li><a href="https://hg.mozilla.org/users/axel_mozilla.com/gecko-strings-quarantine">gecko-strings-quarantine</a> is cloned in <code>~/l10n/gecko-strings-quarantine</code>.</li>
<li><a href="https://hg.mozilla.org/mozilla-unified">mozilla-unified</a> is cloned in <code>~/src/mozilla-unified</code>, and you checked out the version corresponding to the converted changeset.</li>
</ul>
<p>Then run</p>
<pre><code>$ compare-locales --unified --full ~/src/mozilla-unified/browser/locales/l10n.toml ~/l10n gecko-strings-quarantine
</code></pre>
<p>If you also have <a href="https://hg.mozilla.org/comm-central">comm-central</a> checked out, you can check Thunderbird and allies with:</p>
<pre><code>$ compare-locales --unified --full -Dmozilla=~/src/mozilla-unified/ ~/src/comm-central/mail/locales/l10n.toml ~/src/comm-central/calendar/locales/l10n.toml ~/src/comm-central/suite/locales/l10n.toml ~/l10n gecko-strings-quarantine
</code></pre>
<p>When running these, you should see no errors or warnings. When running them against the central revisions, you should see no missing or changed strings, while having obsolete strings is expected. When running against beta or release revisions, expect to have changed strings, but again, no missing strings.</p>
<p>Note: when running compare-locales against a non-existing locale code, use the <code>--full</code> commandline argument to get all strings in submodules. In particular for gecko-strings, you need that, otherwise you only get the strings in the <code>browser</code> directory.</p>
<h3><a class="header" href="#run-compare-locales-against-a-localization-repository" id="run-compare-locales-against-a-localization-repository">Run compare-locales against a localization repository</a></h3>
<p>A good next step to check for issues is to run compare-locales against a localization repository frequently updated (Italian and French are good examples).</p>
<ul>
<li><a href="https://hg.mozilla.org/l10n-central/it">l10n-central/it</a> is cloned in <code>~/l10n/it</code>.</li>
</ul>
<p>To run compare-locales against <code>mozilla-unified</code> and Italian you can run:</p>
<pre><code>$ compare-locales --unified ~/src/mozilla-unified/browser/locales/l10n.toml ~/l10n it
</code></pre>
<p>To run compare-locales against <code>gecko-strings-quarantine</code> and Italian you can run:</p>
<pre><code>$ compare-locales --unified ~/l10n/gecko-strings-quarantine/_configs/browser.toml ~/l10n it
</code></pre>
<p>Both are really long commands, so it’s convenient to create Bash aliases in <code>~/.bash_profile</code> for them, e.g.</p>
<pre><code>cmp_moz=&quot;compare-locales --unified ~/src/mozilla-unified/browser/locales/l10n.toml ~/l10n it&quot;
cmp_mozx=&quot;compare-locales --unified ~/l10n/gecko-strings-quarantine/_configs/browser.toml ~/l10n it&quot;
</code></pre>
<p>Let’s start with the output of <code>compare-locales</code> against <code>gecko-strings-quarantine</code>: most of the time, it should only report missing strings. There will be obsolete strings only if a string was removed, which is a rare event in cross-channel.</p>
<p>For example, this is the output for a fully localized locale.</p>
<pre><code>$ compare-locales --unified ~/l10n/gecko-strings-quarantine/_configs/browser.toml ~/l10n it
it:
changed: 9914
changed_w: 52351
keys: 1383
unchanged: 883
unchanged_w: 1085
91% of entries changed
</code></pre>
<p>Check the results for duplicated strings and errors. For example, if a new error shows up for a missing variable, it’s likely that a string changed without a new ID and introduced new variables.</p>
<p>The output of <code>compare-locales</code> against <code>mozilla-unified</code> is going to contain a lot of noise, since it includes all strings that are obsolete for <code>mozilla-central</code>, but are still needed for other branches. If you’re interested in only seeing missing strings, i.e. strings that need to be added to the l10n repository, you can <code>grep</code> the results by piping the output to <code>egrep '^\s*\+'</code>.</p>
<pre><code>$ compare-locales --unified ~/src/mozilla-unified/browser/locales/l10n.toml ~/l10n it | egrep '^\s*\+'
</code></pre>
<h3><a class="header" href="#push-reviewed-strings-to-gecko-strings" id="push-reviewed-strings-to-gecko-strings">Push reviewed strings to gecko-strings</a></h3>
<p>If there are no issues in <code>gecko-strings-quarantine</code> and no pending <a href="products/review/../firefox_desktop/fluent_migrations.html">Fluent migrations</a>, the next step is to push changes to <code>gecko-strings</code> and expose content to tools.</p>
<p>One time setup: after you cloned <code>gecko-strings-quarantine</code> on your system, you need to edit its <code>.hg/hgrc</code> file, and add <code>gecko-strings</code> as path. While you only need <code>https</code> for pulling the quarantine repository, you need <code>ssh</code> in order to push updates to <code>gecko-strings</code>.</p>
<p>The content of <code>~/l10n/gecko-strings-quarantine/.hg/hgrc</code> should be similar to this:</p>
<pre><code>[paths]
default = https://hg.mozilla.org/users/axel_mozilla.com/gecko-strings-quarantine
gecko-strings = ssh://hg.mozilla.org/l10n/gecko-strings
</code></pre>
<p>To push the current <code>default</code> to <code>gecko-strings</code>, from the <code>gecko-strings-quarantine</code> folder simply run:</p>
<pre><code>$ hg push -r default gecko-strings
</code></pre>
<p>Instead of <code>default</code>, you can also push a specific changeset, e.g.</p>
<pre><code>$ hg push -r 4c05bc050007 gecko-strings
</code></pre>
<h1><a class="header" href="#l10n-and-firefox-for-ios" id="l10n-and-firefox-for-ios">L10n and Firefox for iOS</a></h1>
<p>Some documentation specific for common tasks regarding Firefox for iOS and l10n:</p>
<ul>
<li><a href="products/firefox_iOS/review_iOSstrings.html">Reviewing new strings for a new release</a>.</li>
</ul>
<h1><a class="header" href="#reviewing-strings-for-a-new-release-of-firefox-for-ios" id="reviewing-strings-for-a-new-release-of-firefox-for-ios">Reviewing strings for a new release of Firefox for iOS</a></h1>
<p>Usually, a new release of Firefox for iOS means an update to strings. If this is the case, a pull request will be made by the iOS team, in order to land these new strings in the <a href="https://github.com/mozilla-l10n/firefoxios-l10n">mozilla-l10n firefoxios-l10n repository</a>.</p>
<p>At this point, the PR is reviewed by an l10n-driver - most often by the PM in charge of the project.</p>
<p>Let’s go over some of the steps needed over time in order to review correctly strings for a new release.</p>
<h2><a class="header" href="#reviewing-the-pr" id="reviewing-the-pr">Reviewing the PR</a></h2>
<p>When you’re getting close to the end of the <a href="https://wiki.mozilla.org/Firefox_for_iOS_Train_Schedule">Firefox for iOS l10n cycle</a>, the iOS team will make a pull request in order to land new strings for the upcoming release.</p>
<p>Let’s consider a past PR, which was done for v6.0:
https://github.com/mozilla-l10n/firefoxios-l10n/pull/19</p>
<p>The first thing you’ll want to do is to check the changes to the /en-US folder:
https://github.com/mozilla-l10n/firefoxios-l10n/pull/19/commits/edcee6500a4cec7cd40251e0dd2c047a5ffbe3ae</p>
<h3><a class="header" href="#acceptable-changes" id="acceptable-changes">Acceptable changes</a></h3>
<p>Changes to attributes like tool-version and build-num are expected, they happen every time you change the version of Xcode.</p>
<p>Same for the utf-8 -&gt; UTF-8 at the beginning, and version number bumping to 6.0. Note that these should now be automatically translated (so will not appear as new strings for localizers and they will not need to touch them).</p>
<p>Changes to comments (<note>) are irrelevant in terms of string updates, so they’re also OK.</p>
<p>Remember also that the script converts Unicode literals into UTF-8 characters. Example: https://github.com/mozilla-l10n/firefoxios-l10n/pull/19/commits/713def82602224556d797b46e3f6d611297ee3e3#diff-42d28e544c7a30099950b7a09a69f2caL2289</p>
<p>As you can see, the <code>&amp;#173;</code> was not lost - it was converted to the invisible UTF-8 character.</p>
<h3><a class="header" href="#potentially-problematic-changes-removals" id="potentially-problematic-changes-removals">Potentially problematic changes (removals)</a></h3>
<p>Then you start scrolling down, checking if the new strings make sense: the first one you find is NSCameraUsageDescription.</p>
<p>You mostly need to pay attention to the strings removed. Double-check each time that iOS team clearly realizes that they won’t be able to release updates to v5 (or any v5.x release) once strings are exported.</p>
<p>For example: <code>Menu.NightModeAction.Title</code> is removed. If it’s used in v5, and the iOS team plans to release an update to v5 in the future, localizations will miss that string.</p>
<h3><a class="header" href="#quickly-review-other-locales" id="quickly-review-other-locales">Quickly review other locales</a></h3>
<p>Once you’ve checked <code>templates</code>, you can pick at least one locale and see what changes:
https://github.com/mozilla-l10n/firefoxios-l10n/pull/19/commits/a1c041a012e6996bd8bdaec88f21f3c34fe383b0</p>
<h2><a class="header" href="#reviewing-strings-during-the-cycle" id="reviewing-strings-during-the-cycle">Reviewing strings during the cycle</a></h2>
<p>It’s good to keep an eye on the strings landing during the Firefox for iOS cycle. In fact, if you wait to review strings when the PR is already opened, it’s going to be complicated to get a fix in (until <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1270855">Bug 1270855</a> is resolved).</p>
<p>You should try to periodically check out the strings landing, and try to localize them in your head: how would you translate them? Would you be able to do it without the app? Is the localization comment clear enough?</p>
<p>You might also need to identify the bug that added that string, see if there are screenshots, or ask if the iOS team can provide one. The point below explains how to find that bug.</p>
<h3><a class="header" href="#how-to-find-the-bug-that-introduced-a-string" id="how-to-find-the-bug-that-introduced-a-string">How to find the bug that introduced a string</a></h3>
<p>Let’s consider an example of new strings for Firefox for iOS, with <a href="https://github.com/mozilla-l10n/firefoxios-l10n/pull/19">this past PR</a>.</p>
<p>The ID is <code>NSCameraUsageDescription</code>, the label <code>This lets you take and upload photos</code>
It doesn’t have a localization comment, which is bad.</p>
<p>In fact currently, the only strings that can not have localization comments are strings that are located in <code>InfoPlist.strings</code> and <code>Info.plist</code> - see <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1277515">Bug 1277515</a> for more details. Otherwise, strings should always have localization comments.</p>
<p>So you open the main repository page:
https://github.com/mozilla-mobile/firefox-ios</p>
<p>And use the search box at the top, searching for the string ID (or the string):
https://github.com/mozilla-mobile/firefox-ios/search?utf8=%E2%9C%93&amp;q=NSCameraUsageDescription</p>
<p>In this case you find two occurrences. The first one is the most interesting, so you open the file:
https://github.com/mozilla-mobile/firefox-ios/blob/978bf46bb680291c61c5d21b6dc26472388a374f/Client/en.lproj/InfoPlist.strings</p>
<p>Then use the <code>Blame</code> link on top:
https://github.com/mozilla-mobile/firefox-ios/blame/978bf46bb680291c61c5d21b6dc26472388a374f/Client/en.lproj/InfoPlist.strings</p>
<p>On the left, you should (almost always) find the bug reference:
https://bugzilla.mozilla.org/show_bug.cgi?id=1312842</p>
<h2><a class="header" href="#wrapping-up-your-work" id="wrapping-up-your-work">Wrapping up your work</a></h2>
<p>So you’ve reviewed the strings during the cycle, and the PR looks good? Wait! Don’t merge it quite yet.</p>
<p>You will need to announce this on <a href="https://lists.mozilla.org/listinfo/dev-l10n">dev.l10n mailing list</a> as soon as you merge the PR. Prepare your email in advance. Here’s <a href="https://groups.google.com/forum/#!searchin/mozilla.dev.l10n/ios$20v7%7Csort:relevance/mozilla.dev.l10n/oR5u3MdMLgE/952I4eyADAAJ">an example</a> of what it should contain.</p>
<p><a href="https://pontoon.mozilla.org/projects/firefox-for-ios/">Pontoon</a> should get the new strings automatically, but it’s always a good idea to double check just in case.</p>
<h1><a class="header" href="#working-on-mozillaorg" id="working-on-mozillaorg">Working on mozilla.org</a></h1>
<p>Some documentation specific for common tasks on mozilla.org</p>
<ul>
<li><a href="products/mozilla_org/extract_strings.html">Process overview to expose mozilla.org content for localization</a></li>
<li><a href="products/mozilla_org/working_bedrock.html">Working with Bedrock: running it, extracting strings from templates, tips</a>.</li>
<li><a href="products/mozilla_org/../../tools/webdashboards/import_translations.html">Importing translations from existing files</a>.</li>
<li><a href="products/mozilla_org/updating_mozillaorg_production.html">Updating mozilla.org production</a>.</li>
<li><a href="products/mozilla_org/enable_production.html">Enable a new locale on production</a>.</li>
</ul>
<p>For documentation about Langchecker, see <a href="products/mozilla_org/../../tools/webdashboards/">this page</a>.</p>
<h1><a class="header" href="#process-overview-to-expose-mozillaorg-content-for-localization" id="process-overview-to-expose-mozillaorg-content-for-localization">Process overview to expose mozilla.org content for localization</a></h1>
<p>This document describes the tools and processes involved in converting a mozilla.org template in English to a .lang file containing localizable content and relevant information to help with localization.</p>
<h2><a class="header" href="#this-is-a-brief-overview-of-the-process" id="this-is-a-brief-overview-of-the-process">This is a brief overview of the process</a></h2>
<ul>
<li>In <a href="https://github.com/mozilla/bedrock">Bedrock</a>, when a page is in the final coding review phase in GitHub and content is finalized, an <a href="https://github.com/mozilla/bedrock/pulls?q=is%3Aopen+is%3Apr+label%3AL10N">L10n label</a> is added to the PR, signaling that it is ready for string extraction.</li>
<li>Strings are extracted from the identified templates, generating a temporary .lang file. The new strings are manually added to an existing en-US .lang file, or a brand new file added to the <a href="https://github.com/mozilla-l10n/www.mozilla.org">mozilla.org l10n repository</a>. A pull request is opened to review the en-US initial content for issues or errors.</li>
<li>Another PR is created in the <a href="https://github.com/mozilla-l10n/langchecker/">Langchecker</a> repository. Langchecker is the tool used to keep track of all localizable files in the l10n repositories, and contains a set of scripts used to manage the repository.</li>
<li>After both PRs are reviewed and approved, a script will be run locally to propagate the en-US content into files in other locales. That means both adding a new file, or adding new strings to existing files.</li>
<li>Once merged to the master branch, files will be available on www.mozilla.org repository for localization, and the merge commit will be cherry-picked to <a href="https://github.com/mozilla-l10n/bedrock-l10n">bedrock-l10n</a>, the localization production repository. Within 20 minutes, Pontoon will display the status of the new or updated files for all locales.</li>
<li>In some cases, an email through a mailing list will be sent out to communicate the localization request. At this point, the L10n tag is also removed from Bedrock’s PR.</li>
</ul>
<h2><a class="header" href="#environment" id="environment">Environment</a></h2>
<p>In order to run Langchecker locally, you need a recent version of PHP (ideally 7 and above):</p>
<ul>
<li><a href="https://github.com/mozilla-l10n/langchecker/">Langchecker</a> repository has instructions on how to <a href="https://github.com/mozilla-l10n/langchecker/#installation">install</a> the tool. The <a href="https://github.com/mozilla-l10n/langchecker/wiki">Wiki</a> has detailed informations on all the available scripts.</li>
<li>While Apache is not needed (you can use PHP internal web server), it’s highly recommended.</li>
<li>L10n-drivers use a VMWare virtual machine based on Ubuntu LTS. This VM includes a set of Bash aliases and symbolic links designed to simplify the workflow. You can find the script used to set up the VM <a href="https://github.com/mozilla-l10n/vm_scripts/blob/master/setup_vm/setup_vm.sh">here</a>, and the list of aliases <a href="https://github.com/mozilla-l10n/vm_scripts/blob/master/.bashrc_aliases">here</a>.</li>
</ul>
<h2><a class="header" href="#step-by-step-details-for-the-entire-process" id="step-by-step-details-for-the-entire-process">Step by step details for the entire process</a></h2>
<h3><a class="header" href="#extract-strings-from-a-template-in-bedrock" id="extract-strings-from-a-template-in-bedrock">Extract strings from a template in Bedrock</a></h3>
<p>The process is detailed in <a href="products/mozilla_org/../../products/mozilla_org/working_bedrock.html">this document</a>.</p>
<p>Note: you only use this generated .lang file as a reference. You still need to add comments and reorder strings before exposing them for localization.</p>
<h3><a class="header" href="#prepare-the-en-us-lang-file" id="prepare-the-en-us-lang-file">Prepare the en-US .lang file</a></h3>
<p>It is very important to have a clean, error free .lang file in en-US. Once the file is approved and content is pushed into other locales, if an error is found then, it will take much more effort to correct. If localizers have already started their work, the cleanup is even messier. At that point, it is a fix in one file versus fixes in 100+ files.</p>
<p>Initial review should include checking the file against the page on the testing server and checking against the template. This is to ensure that there are no hard coded strings.</p>
<p>Note: if there is an update to an existing page, it is advised to still generate the .lang file, and copy the new string there instead of copying it from the .html file. This is to make sure, for example, that the syntax used for variable replacements is correct, and remove eventual extra white spaces between words that are not carried over to the .lang file.</p>
<h3><a class="header" href="#add-notes-and-comments-to-the-extracted-file" id="add-notes-and-comments-to-the-extracted-file">Add notes and comments to the extracted file:</a></h3>
<p>Add important information at the top of the file:</p>
<ul>
<li>A Note (<code>## NOTE:</code>) for <a href="https://github.com/mozilla-l10n/www.mozilla.org/blob/f5747193ee5af7e83fafa2cf70a2031dfa3d9773/en-US/firefox/facebookcontainer/index.lang#L2">demo/test URLs</a>.</li>
<li>A Note for test instruction if necessary, for a page that is more dynamic, such as the <a href="https://github.com/mozilla-l10n/www.mozilla.org/blob/f5747193ee5af7e83fafa2cf70a2031dfa3d9773/en-US/firefox/tracking-protection-tour.lang#L8">privacy_protection_tour.lang</a>.</li>
<li>Make sure to add tags, if there are strings <a href="products/mozilla_org/working_bedrock.html#l10n-tags">bound to l10n tags</a>.</li>
</ul>
<p>Proceed to the content of the file. Add a comment to the following type of strings to provide more context:</p>
<ul>
<li>Page title and description. Typically, a page title string should be translated in a short or catchy way.</li>
<li>If the string contains a link, to which <a href="https://github.com/mozilla-l10n/www.mozilla.org/blob/f5747193ee5af7e83fafa2cf70a2031dfa3d9773/en-US/firefox/tracking-protection-tour.lang#L129">URL</a> it points to. This gives context to localizers.</li>
<li>If a string is behind a tag, make sure to add the <a href="https://github.com/mozilla-l10n/langchecker/wiki/.lang-files-format#string-meta-data">tag bindings</a>.</li>
<li>A new string behind a tag makes another string obsolete. Make sure to add <a href="https://github.com/mozilla-l10n/www.mozilla.org/blob/f5747193ee5af7e83fafa2cf70a2031dfa3d9773/en-US/firefox/tracking-protection-tour.lang#L99">an obsolete comment</a> to help localizers prioritize their work, and that old and new strings are next to each other. This will also make removal of old strings easier in further updates.</li>
<li>A comment for an alternative to an expression that may not be culturally relevant, or to a pun that doesn’t translate well.</li>
<li>Check English content for capitalization, hyphenated word to make sure they are consistent with the <a href="https://design.firefox.com/photon/copy/word-list.html">Firefox style guide</a> (macOS vs. MacOS, sign in to vs. sign into).</li>
</ul>
<p>When all is done, create a PR in the www.mozilla.org repo for review. Describe what the PR is for, add references to the Bedrock’s pull requests to add context for the review.</p>
<p>Check for possible <a href="https://l10n.mozilla-community.org/langchecker/?action=errors">errors</a> such as duplicates or unmatched strings before requesting for review. In order to do this, you will need to run Langchecker locally, and make sure that both the l10n repository and Langchecker’s are using the branches you’re working on.</p>
<h3><a class="header" href="#work-with-the-scripts-in-langchecker" id="work-with-the-scripts-in-langchecker">Work with the scripts in Langchecker</a></h3>
<p>Below are some of the common commands and purposes of using Lanchecker.</p>
<p>You use Langchecker for the following purposes:</p>
<ul>
<li><a href="https://github.com/mozilla-l10n/langchecker/blob/master/app/config/sources.inc.php">app/config/sources.inc.php</a>: modify this file when there is a new or an updated .lang: add file name, define supported locales, deadline and flags.</li>
<li><a href="https://github.com/mozilla-l10n/langchecker/blob/master/app/config/locales.inc.php">app/config/locales.inc.php</a>: bootstrap a new new locale on Mozilla.org</li>
</ul>
<p>The following commands are used for some common tasks:</p>
<ul>
<li><code>lang_update</code> is to populate new and revised content in the en-US into localized files.</li>
<li><code>mark_active</code> will add an <code>## active ##</code> tag at the beginning of the file after checking that the entire file is translated and no errors are detected. The associate template will be live on production.</li>
<li><code>add_tags</code> tracks the completion of the tagged strings, and add the tag on top of the file when all are translated.</li>
</ul>
<p>For more details, check <a href="products/mozilla_org/../../tools/webdashboards/langchecker.html">here</a>.</p>
<p>This document details the process to <a href="products/mozilla_org/updating_mozillaorg_production.html">update production repo</a>.</p>
<h2><a class="header" href="#pontoon-and-communication" id="pontoon-and-communication">Pontoon and Communication</a></h2>
<p>Within 20 minutes, the content change will show up on <a href="https://pontoon.mozilla.org/projects/mozillaorg/">Pontoon project dashboard</a>. L10n-driver will update project deadline (high level against all other projects) and page level deadline (if applicable) when viewing the entire mozilla.org page status in a given locale.</p>
<p>An email communication about this localization request will be sent out soon after.</p>
<h1><a class="header" href="#working-with-bedrock" id="working-with-bedrock">Working with Bedrock</a></h1>
<ul>
<li><a href="products/mozilla_org/working_bedrock.html#running-bedrock">Running Bedrock</a></li>
<li><a href="products/mozilla_org/working_bedrock.html#extracting-strings-from-a-template">Extracting strings from a template</a></li>
<li><a href="products/mozilla_org/working_bedrock.html#notes-about-templates-and-l10n">Notes about templates and l10n</a>
<ul>
<li><a href="products/mozilla_org/working_bedrock.html#wrapping-strings">Wrapping strings</a></li>
<li><a href="products/mozilla_org/working_bedrock.html#shared-lang-files">Shared .lang files</a></li>
<li><a href="products/mozilla_org/working_bedrock.html#loading-other-lang-files">Loading other .lang files</a></li>
<li><a href="products/mozilla_org/working_bedrock.html#activating-a-template">Activating a template</a></li>
<li><a href="products/mozilla_org/working_bedrock.html#l10n-tags">L10n tags</a></li>
<li><a href="products/mozilla_org/working_bedrock.html#try-a-patch-locally">Try a patch locally</a></li>
<li><a href="products/mozilla_org/working_bedrock.html#identifying-l10n-issues-in-a-patch">Identifying l10n issues in a patch</a></li>
</ul>
</li>
</ul>
<p>This document covers a few tasks and tips regarding Bedrock.</p>
<h2><a class="header" href="#running-bedrock" id="running-bedrock">Running Bedrock</a></h2>
<p>You can install Bedrock by following the instructions available in <a href="https://bedrock.readthedocs.io/en/latest/install.html">this page</a>.</p>
<p>If you’re using the virtual machine described in <a href="products/mozilla_org/../../config/setup_l10ndrivers_vm.html">this document</a>, Bedrock is already installed in <code>~/mozilla/git/bedrock</code>.</p>
<p>Move into the main folder, activate the Virtual environment, and run the server</p>
<pre><code class="language-BASH">$ cd ~/mozilla/git/bedrock/
$ source venv/bin/activate
$ ./manage.py runserver
</code></pre>
<p>In a different terminal window run</p>
<pre><code class="language-BASH">$ gulp
</code></pre>
<p>At this point Bedrock will be available at http://localhost:8000</p>
<p>In the virtual machine the locale folder is a symbolic link to the mozilla.org trunk l10n repository.</p>
<p>Don’t forget to exit the virtual environment by running <code>deactivate</code> when you’re finished.</p>
<h2><a class="header" href="#extracting-strings-from-a-template" id="extracting-strings-from-a-template">Extracting strings from a template</a></h2>
<p>The first part is to identify the template (or templates) you need to extract strings from. For example, assuming that you want to extract strings from <code>bedrock/mozorg/templates/mozorg/contribute/signup.html</code>, you would run from Bedrock’s main folder:</p>
<pre><code class="language-BASH">$ cd ~/mozilla/git/bedrock/
$ source venv/bin/activate
(venv) $ ./manage.py l10n_extract bedrock/mozorg/templates/mozorg/contribute/signup.html
</code></pre>
<p>If the last command returns any error, try reinstalling the requirements with</p>
<pre><code class="language-BASH">$ pip install -r requirements/dev.txt
</code></pre>
<p>At this point a .lang file will be created inside <code>/locale/templates</code> with all the strings extracted. The name of the file depends on several factors: for example the template could include another template that specify a specific .lang file so, instead of having <code>locale/templates/mozorg/contribute/signup.lang</code>, you have <code>locale/templates/mozorg/contribute/index.lang</code>.</p>
<p>The suggestion is to always remove the <code>templates</code> folder before doing an extraction, to make sure you start from a clean situation.</p>
<p>Note that you can also use wildcards in the command, e.g. <code>./manage.py l10n_extract bedrock/mozorg/templates/mozorg/contribute/*.html</code>, but you should try to extract strings only from the template you need.</p>
<p>One final note: you only use this generated .lang file as a reference, you still need to add comments and reorder strings before exposing them for localization.</p>
<h2><a class="header" href="#notes-about-templates-and-l10n" id="notes-about-templates-and-l10n">Notes about templates and l10n</a></h2>
<h3><a class="header" href="#wrapping-strings" id="wrapping-strings">Wrapping strings</a></h3>
<pre><code class="language-DJANGO">&lt;span class=&quot;outline-button more&quot;&gt;{{ _('Start using the Mozilla Stumbler app') }}&lt;/span&gt;
</code></pre>
<p>Localizable strings are wrapped like <code>_('This')</code>. That means you can simply copy and paste the string <code>This</code> instead of performing a full extraction.</p>
<p>More complex strings can be wrapped in <em>trans</em> blocks, e.g.</p>
<pre><code class="language-DJANGO">&lt;p class=&quot;license&quot;&gt;
  {% trans url=url('foundation.licensing.website-content') %}
  Portions of this content are ©1998–{{ current_year }} by individual
  mozilla.org contributors. Content available under
  a &lt;a href=&quot;{{ url }}&quot;&gt;Creative Commons license&lt;/a&gt;.
  {% endtrans %}
&lt;/p&gt;
</code></pre>
<h3><a class="header" href="#shared-lang-files" id="shared-lang-files">Shared .lang files</a></h3>
<p>There are some <a href="https://github.com/mozilla/bedrock/blob/master/bedrock/settings/base.py#L199">shared .lang files</a> that are available across all templates:</p>
<ul>
<li>main.lang</li>
<li>download_button.lang</li>
</ul>
<p>If a string is available in one of these files, it can be safely used by any of the other templates. This is useful, but these files shouldn’t become bigger than necessary.</p>
<h3><a class="header" href="#loading-other-lang-files" id="loading-other-lang-files">Loading other .lang files</a></h3>
<p>The <code>add_lang_files</code> directive is used in templates to specify a different .lang file, or include strings from another .lang file. Example above: normally a template called <code>bedrock/mozorg/templates/mozorg/contribute/signup.html</code> should generate a file called <code>mozorg/contribute/signup.lang</code>, but instead it generates a .lang file called <code>mozorg/contribute/index</code>. Why? Because the template has this directive:</p>
<pre><code class="language-DJANGO">{% add_lang_files &quot;mozorg/contribute/index&quot; %}
</code></pre>
<p>This is particularly important to understand .lang file activation.</p>
<h3><a class="header" href="#activating-a-template" id="activating-a-template">Activating a template</a></h3>
<p>A .lang file is active when it starts with the line <code>## ACTIVE ##</code>.
A file is activated by l10n-drivers when all strings inside this file are translated, and the page can be displayed in production. Example: https://www.mozilla.org/firefox/new uses <code>firefox/new.lang</code> for strings:</p>
<ul>
<li>https://www.mozilla.org/en-US/firefox/new will always work, since it’s en-US.</li>
<li>https://www.mozilla.org/fr/firefox/new will work if <code>fr/firefox/new.lang</code> is activated. If it’s not, it will redirect to en-US (or any other active locale before en-US in the accept_languages header).</li>
<li>https://www-dev.allizom.org/fr/firefox/new will always work, because files are always active on the dev server.</li>
</ul>
<p>If you’re running Bedrock locally, you need to change <code>bedrock/settings/local.py</code> to modify the behaviour:</p>
<ul>
<li><code>DEV = True</code> means that the server is set as DEV, and all locales will be enabled.</li>
<li><code>DEV = False</code> means that the server is set as PROD, and specific pages will work only if a locale has the file activated.</li>
</ul>
<p>One important fact to keep in mind: if you add a new .lang file with the <code>add_lang_files</code> directive, the activation status will be inherited. Always double check with the production settings.</p>
<p>It’s possible to activate l10n files by using the <a href="https://github.com/mozilla-l10n/langchecker/wiki/CLI-scripts-syntax#mark_active">mark_active script</a> available in Langchecker. It will activate only locales that are completely localized and don’t have any errors.</p>
<h3><a class="header" href="#l10n-tags" id="l10n-tags">L10n tags</a></h3>
<p>Bedrock supports l10n tags through the <code>l10n_has_tag</code> function. For example:</p>
<pre><code class="language-DJANGO">{% if l10n_has_tag('sync_device_note') %}
  {{ _('Learn more about bookmarks') }}
{% else %}
  {{ _('Learn more') }}
{% endif %}
</code></pre>
<p>l10n tags allow to add a new string in the template and to push it to production without waiting for localization to happen: if the l10n .lang file has this tag, the template will use the new string <code>Learn more about bookmarks</code>, otherwise if will fallback to the previous version <code>Learn more</code>.</p>
<p>The tag appears as <code>sync_device_note</code> in the code, but it will appear as <code>## sync_device_note ##</code> at the beginning of the .lang file. Using underscores is preferable to dashes for tag names.</p>
<p>It’s possible to add tags to l10n files by using the <a href="https://github.com/mozilla-l10n/langchecker/wiki/CLI-scripts-syntax#add_tags">add tags script</a> available in Langchecker. It will add tags only if the file translated all strings associated to it.</p>
<p>All tags are enabled by default on a DEV server.</p>
<p>For more information about .lang files, for example how to bind a string to a tag, see <a href="https://github.com/mozilla-l10n/langchecker/wiki/.lang-files-format">the wiki page</a>.</p>
<h3><a class="header" href="#try-a-patch-locally" id="try-a-patch-locally">Try a patch locally</a></h3>
<p>Let’s assume you want to test a pull request locally, for example to extract strings. The URL for this pull request is https://github.com/mozilla/bedrock/pull/4100. By adding <code>.patch</code> to the URL you get a patch for this PR: https://github.com/mozilla/bedrock/pull/4100.patch.</p>
<p>You can download this patch and apply it locally.</p>
<pre><code class="language-BASH">$ cd ~/mozilla/git/bedrock/
$ source venv/bin/activate
(venv) $ wget https://github.com/mozilla/bedrock/pull/4101.patch
(venv) $ git apply 4101.patch
(venv) $ gulp
</code></pre>
<p>Remember that Bedrock on the VM-l10n uses a link to the actual trunk repository, so make sure to delete any test you make. The <code>templates</code> folder will be automatically ignored.</p>
<h3><a class="header" href="#identifying-l10n-issues-in-a-patch" id="identifying-l10n-issues-in-a-patch">Identifying l10n issues in a patch</a></h3>
<p>The most common issue is that strings are not <em>wrapped</em>, so they’re not exposed by the extraction process or translated, even if the string is available in the .lang file. To identify them you need to run the patch locally with a modified .lang file, for example adding asterisks or other characters to the English string. There might be need for a tool to automatically create such a file.</p>
<p>How to read a patch and identify the string? One possible approach is to load the patch (add .patch to the PR URL) in a text editor, and use this regular expression to search for new/changed lines with wrapped strings: <code>^\+.*_\(.*\)</code>. The regular expression can be read as: search for a line starting with <code>+</code> and including a <code>_(…)</code> structure. Note that a change might be generated by a change in padding, so the block moves but the string is always the same.</p>
<p>Normally PRs are tagged as L10N to indicate that the PR has some impact on l10n (new strings), either by devs or l10n-drivers.</p>
<h1><a class="header" href="#importing-translations-from-existing-files" id="importing-translations-from-existing-files">Importing translations from existing files</a></h1>
<p>Sometimes it’s useful to import strings from existing files. A typical example is when an existing page is replaced by a new template, with some strings in common.</p>
<p>First of all, always make sure that your repositories are up to date. If you’re using the l10n-drivers VM, simply run <code>gitup</code>.</p>
<p>Let’s consider a simple example: the string <code>Internet Health</code> is currently available in <code>main.lang</code>. A new page is created (<code>mozorg/internet-health.lang</code>), and it includes that string in the template. Since <code>main.lang</code> is a shared file it would be possible to avoid adding the string to the new template, but in this case you want to make sure that localizers can use an alternative translation.</p>
<p>To start check that all locales have the untranslated string available in <code>mozorg/internet-health.lang</code></p>
<pre><code class="language-BASH">$ lang_update mozorg/internet-health.lang 0 all
</code></pre>
<p>At this point you need to work on langchecker, editing your local copy of <a href="https://github.com/mozilla-l10n/langchecker/blob/master/app/scripts/lang_update#L105">app/scripts/lang_update</a>.</p>
<pre><code class="language-BASH">$ atom ~/mozilla/git/app/scripts/lang_update
</code></pre>
<p>Search for the variable <code>$import_files</code> and add the file from which you want to import strings (<code>main.lang</code> in this case). Make also sure that <code>$import_website</code> is set to <code>0</code> (identifier for <code>mozilla.org</code>).</p>
<pre><code class="language-PHP">$import_files = ['main.lang'];
$import_website = 0;
</code></pre>
<p>This will make the next run of <code>lang_update</code> import existing strings from <code>main.lang</code>. For this reason, always run <code>lang_update</code> only against the file you wish to update.</p>
<p>Now you can run the update, propagating updates to all locales:</p>
<pre><code class="language-BASH">$ lang_update mozorg/internet-health.lang 0 all
</code></pre>
<p>Note that <code>$import_files</code> is an array, which means you could have more source files, e.g.</p>
<pre><code class="language-PHP">$import_files = ['main.lang', 'mozorg/home/index.lang'];
</code></pre>
<p>The order is relevant: files are checked in the order they’re available in the array, the first matching translation is kept.</p>
<p><strong>Important</strong>: make sure to not commit this change to langchecker. You can either ignore it and it will be removed the next time you run <code>gitup</code>, or reset the repository with <code>git reset --hard</code>.</p>
<pre><code class="language-BASH">$ cd ~/mozilla/git/langchecker
$ git reset --hard
</code></pre>
<p>Check your local installation of langchecker for errors by visiting http://localhost/langchecker/?action=errors</p>
<p>If there are no errors, check the status of this repository with <code>git status</code>, and the content of the updated files for at least one locale (with <code>git diff LOCALE</code>), to confirm that strings were imported correctly. Then push to your branch.</p>
<p>It’s a good idea to send localizers an email to explain why the string will be already translated when they start working on the file.</p>
<h1><a class="header" href="#updating-mozillaorg-production" id="updating-mozillaorg-production">Updating mozilla.org production</a></h1>
<p>For mozilla.org there are two separate repositories:</p>
<ul>
<li><a href="https://github.com/mozilla-l10n/www.mozilla.org">www.mozilla.org</a> is used for <strong>trunk</strong> localization, it’s accessible to localizers and tools and is used to localize the <a href="https://www-dev.allizom.org/it/">DEV server</a>.</li>
<li><a href="https://github.com/mozilla-l10n/bedrock-l10n">bedrock-l10n</a> is used for <strong>production</strong> localization of www.mozilla.org</li>
</ul>
<p>l10n-drivers are in charge of manually moving files from trunk to prod after doing a technical review. On Linux <a href="http://meldmerge.org/">meld</a> is a great tool for this task: you can open both repositories, move files between them and visualize the changes between the two versions.</p>
<pre><code class="language-BASH">$ meld path/to/trunk_repository path/to/production_repository
</code></pre>
<p>If you’re using the virtual machine described in <a href="products/mozilla_org/../../config/setup_l10ndrivers_vm.html">this document</a>, there are a few shortcuts:</p>
<ul>
<li><code>trunkst</code> will move into the trunk folder, and check the status (<code>git status</code>).</li>
<li><code>prodst</code> will do the same for production, but will also fetch updates from trunk in case you want to cherry-pick changesets (see next section).</li>
<li><code>mozmeld</code> will open meld with trunk on the left, and production on the right. Use alt+up/down to move to the next change, use alt+right to move from trunk to production. <strong>Don’t</strong> move the README file, since they’re different between the two repositories.</li>
<li><code>gitup</code> will update all Git repositories, discard pending changing, and checkout master branch.</li>
</ul>
<h2><a class="header" href="#cherry-picking-changes" id="cherry-picking-changes">Cherry-picking changes</a></h2>
<p>Sometimes moving files manually between the two repositories in not viable, for example when updating a file in all locales. In this case it’s possible to cherry-pick a commit from trunk into production.</p>
<p>When you commit a change to the trunk repository you will get a SHA for the changes</p>
<pre><code class="language-BASH">$ trunkst
$ git commit -a -m &quot;Update translation&quot;
[master 31c3920] Update translation
 1 file changed, 1 insertion(+)
$ git push
</code></pre>
<p>In this case the changeset is <em>31c3920</em>. From the production repository:</p>
<pre><code class="language-BASH">$ prodst
$ git cherry-pick 31c3920
[master 380ebdc] Update translation
 Date: Mon May 2 17:31:06 2016 +0200
 1 file changed, 1 insertion(+)
$ git push
</code></pre>
<h2><a class="header" href="#doing-a-manual-push-to-production" id="doing-a-manual-push-to-production">Doing a manual push to production</a></h2>
<p>If you want to do this all manually using Git, you can follow these steps:</p>
<ol>
<li>Make sure the master branches for your clones of both the trunk and production repositories are up to date.</li>
<li>In your local clone of the <strong>production</strong> repo, add a remote that points to the <strong>trunk</strong> repo using <code>git remote add trunk https://github.com/%GITUHB-USERNAME%/www.mozilla.org.git</code>.</li>
<li>Run <code>git checkout master</code>.</li>
<li>Run <code>git fetch trunk</code>.</li>
<li>Now <code>git cherry-pick</code> the commit from the <strong>trunk</strong> repo, referencing the Git hash of the commit you wish to include (e.g. <code>git cherry-pick 31c3920</code>).</li>
<li>Push the changes to master using <code>git push upstream master</code> (assuming <code>upstream</code> is your remote that points to <code>https://github.com/mozilla-l10n/bedrock-l10n.git</code>).</li>
</ol>
<h2><a class="header" href="#guidelines" id="guidelines">Guidelines</a></h2>
<p>There are some principles to keep in mind when updating the production repository:</p>
<ol>
<li>Before moving any file, check the <a href="https://l10n.mozilla-community.org/langchecker/?action=errors">Errors view</a>, possibly on your local installation.</li>
<li>Check the diff for each file before moving it to production, to see if there are any errors.</li>
<li>In case of any doubts always check the page on your local installation of Bedrock or the <a href="https://www-dev.allizom.org/it/">DEV server</a>, especially for new locales.</li>
</ol>
<h1><a class="header" href="#enable-a-new-locale-on-production-for-mozillaorg" id="enable-a-new-locale-on-production-for-mozillaorg">Enable a new locale on production for mozilla.org</a></h1>
<p>All locales available in the <a href="https://github.com/mozilla-l10n/www.mozilla.org">www.mozilla.org GitHub repository</a> are automatically enabled on the <a href="https://www-dev.allizom.org/">dev server</a>. In order to enable a language for <a href="https://www.allizom.org/">stage</a> and <a href="https://www.mozilla.org/">production</a>, it needs to be added to Bedrock’s settings.</p>
<p>Before doing that, make sure that the locale has reached a good level of completion, and test the main pages on the dev server.</p>
<p>First, <a href="https://bugzilla.mozilla.org/enter_bug.cgi?product=www.mozilla.org&amp;component=L10N">file a bug</a> to track this change. Bug number will be needed for the commit message later. Consider for example <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1338759">this bug</a>, to add Nepali to production.</p>
<h2><a class="header" href="#create-a-new-branch" id="create-a-new-branch">Create a new branch</a></h2>
<p>A clone of your fork of Bedrock is already available in the <a href="products/mozilla_org/../../config/setup_l10ndrivers_vm.html">virtual machine</a>, so run <code>gitup</code> to make sure everything is up to date. Then move to Bedrock’s folder, and create a new branch, for example using the bug number as reference.</p>
<pre><code class="language-BASH">$ cd ~/mozilla/git/bedrock
$ git branch bug1338759
$ git checkout bug1338759
</code></pre>
<p>If you see a message referencing legal-docs like this one, it means that there’s an unwanted change in the legal-docs repository:</p>
<pre><code class="language-BASH">$ git checkout bug1338759
M	vendor-local/src/legal-docs
Switched to branch 'bug1338759'
</code></pre>
<p>You can verify it by running <code>git status</code></p>
<pre><code class="language-BASH">$ git status
On branch bug1338759
Changes not staged for commit:
  (use &quot;git add &lt;file&gt;...&quot; to update what will be committed)
  (use &quot;git checkout -- &lt;file&gt;...&quot; to discard changes in working directory)

	modified:   vendor-local/src/legal-docs (new commits)

no changes added to commit (use &quot;git add&quot; and/or &quot;git commit -a&quot;)
</code></pre>
<p><strong>IMPORTANT</strong>: you need to get rid of this change before doing any work. If you don’t, your pull request will be rejected.</p>
<p>In order to remove this change, run the following commands</p>
<pre><code class="language-BASH">$ cd ~/mozilla/git/bedrock/vendor-local/src/legal-docs/
$ git checkout master
$ git pull
$ cd ~/mozilla/git/bedrock
</code></pre>
<p>Make sure you’re back to the <code>bedrock</code> folder in your virtual machine, and check that there are no pending changes with <code>git status</code>.</p>
<h2><a class="header" href="#edit-bedrocks-settings" id="edit-bedrocks-settings">Edit Bedrock’s settings</a></h2>
<p>The file to modify is <code>bedrock/base/settings.py</code>.</p>
<pre><code class="language-BASH">$ cd ~/mozilla/git/bedrock
$ atom bedrock/settings/base.py
</code></pre>
<p>Search for <code>PROD_LANGUAGES</code>.</p>
<pre><code class="language-PYTHON">PROD_LANGUAGES = ('ach', 'af', 'an', 'ar', 'as', 'ast', 'az', 'bg',
                  'bn-BD', 'bn-IN', 'br', 'bs', 'ca', 'cak', 'cs',
                  'cy', 'da', 'de', 'dsb', 'el', 'en-GB', 'en-US',
                  'en-ZA', 'eo', 'es-AR', 'es-CL', 'es-ES', 'es-MX', 'et',
                  'eu', 'fa', 'ff', 'fi', 'fr', 'fy-NL', 'ga-IE', 'gd',
                  'gl', 'gn', 'gu-IN', 'he', 'hi-IN', 'hr', 'hsb',
                  'hu', 'hy-AM', 'id', 'is', 'it', 'ja', 'ja-JP-mac',
                  'ka', 'kab', 'kk', 'km', 'kn', 'ko', 'lij', 'lt',
                  'ltg', 'lv', 'mai', 'mk', 'ml', 'mr', 'ms', 'my', 'nb-NO',
                  'nl', 'nn-NO', 'oc', 'or', 'pa-IN', 'pl', 'pt-BR', 'pt-PT',
                  'rm', 'ro', 'ru', 'si', 'sk', 'sl', 'son', 'sq',
                  'sr', 'sv-SE', 'ta', 'te', 'th', 'tr', 'uk', 'ur',
                  'uz', 'vi', 'xh', 'zh-CN', 'zh-TW', 'zu')
</code></pre>
<p>You need to add your locale to the list, making sure to:</p>
<ul>
<li>Respect the alphabetical order.</li>
<li>Use one space after commas, no comma after the last element.</li>
<li>Maximum 80 characters per line.</li>
<li>Enclose the locale code in single quotes.</li>
</ul>
<p>In Atom there’s a vertical line to display where the 80 characters limit is. If your line is too long, like in this case, you can use a trick to make sure the text fits within the maximum length. First add the new locale code in the correct position, don’t worry about the line length.</p>
<pre><code class="language-PYTHON">PROD_LANGUAGES = ('ach', 'af', 'an', 'ar', 'as', 'ast', 'az', 'bg',
                  'bn-BD', 'bn-IN', 'br', 'bs', 'ca', 'cak', 'cs',
                  'cy', 'da', 'de', 'dsb', 'el', 'en-GB', 'en-US',
                  'en-ZA', 'eo', 'es-AR', 'es-CL', 'es-ES', 'es-MX', 'et',
                  'eu', 'fa', 'ff', 'fi', 'fr', 'fy-NL', 'ga-IE', 'gd',
                  'gl', 'gn', 'gu-IN', 'he', 'hi-IN', 'hr', 'hsb',
                  'hu', 'hy-AM', 'id', 'is', 'it', 'ja', 'ja-JP-mac',
                  'ka', 'kab', 'kk', 'km', 'kn', 'ko', 'lij', 'lt',
                  'ltg', 'lv', 'mai', 'mk', 'ml', 'mr', 'ms', 'my', 'nb-NO', 'ne-NP',
                  'nl', 'nn-NO', 'oc', 'or', 'pa-IN', 'pl', 'pt-BR', 'pt-PT',
                  'rm', 'ro', 'ru', 'si', 'sk', 'sl', 'son', 'sq',
                  'sr', 'sv-SE', 'ta', 'te', 'th', 'tr', 'uk', 'ur',
                  'uz', 'vi', 'xh', 'zh-CN', 'zh-TW', 'zu')
</code></pre>
<p>Add an empty line two lines above and below the line you need to fix (more if needed, i.e. all lines are at near the maximum length).</p>
<pre><code class="language-PYTHON">PROD_LANGUAGES = ('ach', 'af', 'an', 'ar', 'as', 'ast', 'az', 'bg',
                  'bn-BD', 'bn-IN', 'br', 'bs', 'ca', 'cak', 'cs',
                  'cy', 'da', 'de', 'dsb', 'el', 'en-GB', 'en-US',
                  'en-ZA', 'eo', 'es-AR', 'es-CL', 'es-ES', 'es-MX', 'et',
                  'eu', 'fa', 'ff', 'fi', 'fr', 'fy-NL', 'ga-IE', 'gd',
                  'gl', 'gn', 'gu-IN', 'he', 'hi-IN', 'hr', 'hsb',
                  'hu', 'hy-AM', 'id', 'is', 'it', 'ja', 'ja-JP-mac',

                  'ka', 'kab', 'kk', 'km', 'kn', 'ko', 'lij', 'lt',
                  'ltg', 'lv', 'mai', 'mk', 'ml', 'mr', 'ms', 'my', 'nb-NO', 'ne-NP',
                  'nl', 'nn-NO', 'oc', 'or', 'pa-IN', 'pl', 'pt-BR', 'pt-PT',

                  'rm', 'ro', 'ru', 'si', 'sk', 'sl', 'son', 'sq',
                  'sr', 'sv-SE', 'ta', 'te', 'th', 'tr', 'uk', 'ur',
                  'uz', 'vi', 'xh', 'zh-CN', 'zh-TW', 'zu')
</code></pre>
<p>Position the cursor in the block including the line you need to fix, and select <em>Edit -&gt; Reflow Selection</em>. With this command lines are reorganized to fit the 80 characters limit, and this will be the result:</p>
<pre><code class="language-PYTHON">PROD_LANGUAGES = ('ach', 'af', 'an', 'ar', 'as', 'ast', 'az', 'bg',
                  'bn-BD', 'bn-IN', 'br', 'bs', 'ca', 'cak', 'cs',
                  'cy', 'da', 'de', 'dsb', 'el', 'en-GB', 'en-US',
                  'en-ZA', 'eo', 'es-AR', 'es-CL', 'es-ES', 'es-MX', 'et',
                  'eu', 'fa', 'ff', 'fi', 'fr', 'fy-NL', 'ga-IE', 'gd',
                  'gl', 'gn', 'gu-IN', 'he', 'hi-IN', 'hr', 'hsb',
                  'hu', 'hy-AM', 'id', 'is', 'it', 'ja', 'ja-JP-mac',

                  'ka', 'kab', 'kk', 'km', 'kn', 'ko', 'lij', 'lt', 'ltg', 'lv',
                  'mai', 'mk', 'ml', 'mr', 'ms', 'my', 'nb-NO', 'ne-NP', 'nl',
                  'nn-NO', 'oc', 'or', 'pa-IN', 'pl', 'pt-BR', 'pt-PT',

                  'rm', 'ro', 'ru', 'si', 'sk', 'sl', 'son', 'sq',
                  'sr', 'sv-SE', 'ta', 'te', 'th', 'tr', 'uk', 'ur',
                  'uz', 'vi', 'xh', 'zh-CN', 'zh-TW', 'zu')
</code></pre>
<p>You can then <strong>remove the empty lines</strong> and save the file. These empty lines are needed to avoid affecting more content than needed, in particular the first line. Without them you would end up with this:</p>
<pre><code class="language-PYTHON">PROD_LANGUAGES = ('ach', 'af', 'an', 'ar', 'as', 'ast', 'az', 'bg', 'bn-BD',
'bn-IN', 'br', 'bs', 'ca', 'cak', 'cs', 'cy', 'da', 'de', 'dsb', 'el', 'en-GB',
'en-US', 'en-ZA', 'eo', 'es-AR', 'es-CL', 'es-ES', 'es-MX', 'et', 'eu', 'fa',
'ff', 'fi', 'fr', 'fy-NL', 'ga-IE', 'gd', 'gl', 'gn', 'gu-IN', 'he', 'hi-IN',
'hr', 'hsb', 'hu', 'hy-AM', 'id', 'is', 'it', 'ja', 'ja-JP-mac', 'ka', 'kab',
'kk', 'km', 'kn', 'ko', 'lij', 'lt', 'ltg', 'lv', 'mai', 'mk', 'ml', 'mr', 'ms',
'my', 'nb-NO', 'ne-NP', 'nl', 'nn-NO', 'oc', 'or', 'pa-IN', 'pl', 'pt-BR',
'pt-PT', 'rm', 'ro', 'ru', 'si', 'sk', 'sl', 'son', 'sq', 'sr', 'sv-SE', 'ta',
'te', 'th', 'tr', 'uk', 'ur', 'uz', 'vi', 'xh', 'zh-CN', 'zh-TW', 'zu')
</code></pre>
<p>Verify that there are no other changed files, and the diff looks good with <code>git diff</code>. Since you reorganized lines to fit the 80 characters limit, there will be more than one line changed.</p>
<pre><code class="language-BASH">$ git status
On branch bug1338759
Changes not staged for commit:
  (use &quot;git add &lt;file&gt;...&quot; to update what will be committed)
  (use &quot;git checkout -- &lt;file&gt;...&quot; to discard changes in working directory)

	modified:   bedrock/settings/base.py

no changes added to commit (use &quot;git add&quot; and/or &quot;git commit -a&quot;)
$ git diff
</code></pre>
<p>If you notice <strong>trailing whitespaces</strong> after a line, you need to remove them. First make sure that Atom is set to trim whitespaces:</p>
<ul>
<li>Open <em>Edit-&gt;Preferences</em>.</li>
<li>Select the <em>Packages</em> tab and search for <em>whitespace</em>.</li>
<li>Click on the package <em>whitespace</em> in <em>Core Packages</em>.</li>
<li>Check <em>Remove Trailing Whitespace</em>. If it’s already selected, uncheck and check it again (this should fix configuration problems).</li>
</ul>
<p>Then open and save your file again.</p>
<h2><a class="header" href="#commit-and-open-a-pull-request" id="commit-and-open-a-pull-request">Commit and open a pull request</a></h2>
<p>You’re ready to commit your change. Remember to references your bug with &quot;Fix&quot;, this will automatically close the bug when the change lands.</p>
<pre><code class="language-BASH">$ git commit -a -m &quot;Fix Bug 1338759 - Enable ne-NP on production for mozilla.org&quot;
$ git push origin bug1338759
</code></pre>
<p>Then visit <a href="https://github.com/mozilla/bedrock">Bedrock on GitHub</a> and use the <em>Compare &amp; pull request</em> button. Don’t forget to double check the diff:</p>
<ul>
<li>Only one file should be included: <code>bedrock/settings/base.py</code>).</li>
<li>No trailing whitespaces added.</li>
<li>New locale should be there.</li>
</ul>
<h1><a class="header" href="#other-projects" id="other-projects">Other Projects</a></h1>
<h2><a class="header" href="#firefox-monitor" id="firefox-monitor">Firefox Monitor</a></h2>
<ul>
<li>Repository: <a href="https://github.com/mozilla/blurts-server/">GitHub</a></li>
<li>Bug reports: <a href="https://github.com/mozilla/blurts-server/issues">GitHub</a></li>
<li>Dev server: <a href="https://fx-breach-alerts.herokuapp.com/">link</a></li>
<li>Prod server: <a href="https://monitor.firefox.com/">link</a></li>
<li>Other resources: <a href="https://fx-breach-alerts.herokuapp.com/email-l10n">email templates</a></li>
</ul>
<p>To add a new locale to this project it’s enough to add the locale to Pontoon. This will make the locale automatically available on the dev server and commit to the repository.</p>
<p>For production, locales need to be added to a list that is stored in a private repository, so a new issue needs to be filed (<a href="https://github.com/mozilla/blurts-server/issues/1332">example</a>).</p>
<h2><a class="header" href="#firefox-send" id="firefox-send">Firefox Send</a></h2>
<ul>
<li>Repository: <a href="https://github.com/mozilla/send/">GitHub</a></li>
<li>Bug reports: <a href="https://github.com/mozilla/send/issues">GitHub</a></li>
<li>Dev server: <a href="https://dev.send.nonprod.cloudops.mozgcp.net/">link</a></li>
<li>Prod server: <a href="https://send.firefox.com/">link</a></li>
</ul>
<p>To add a new locale to this project it’s enough to add the locale to Pontoon. This will make the locale automatically available on the dev server and commit to the repository.</p>
<p>The list of locales enabled in production is stored in the <code>availableLanguages</code> key in <a href="https://github.com/mozilla/send/blob/master/package.json">package.json</a>. New locales can be added through pull requests (<a href="https://github.com/mozilla/send/pull/1417">example</a>).</p>
<h1><a class="header" href="#set-up-searchplugins-and-protocol-handlers" id="set-up-searchplugins-and-protocol-handlers">Set up searchplugins and protocol handlers</a></h1>
<ul>
<li><a href="products/searchplugins/setup_searchplugins.html#set-up-searchplugins">Set up searchplugins</a>
<ul>
<li><a href="products/searchplugins/setup_searchplugins.html#tips-for-icons-and-wikipedia">Tips for icons and Wikipedia</a>
<ul>
<li><a href="products/searchplugins/setup_searchplugins.html#icons">Icons</a></li>
<li><a href="products/searchplugins/setup_searchplugins.html#wikipedia">Wikipedia</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="products/searchplugins/setup_searchplugins.html#set-up-protocol-handlers">Set up protocol handlers</a>
<ul>
<li><a href="products/searchplugins/setup_searchplugins.html#regionproperties">region.properties</a></li>
<li><a href="products/searchplugins/setup_searchplugins.html#creating-a-patch-for-review-locale-repository">Creating a patch for review (locale repository)</a></li>
</ul>
</li>
</ul>
<h2><a class="header" href="#set-up-searchplugins-1" id="set-up-searchplugins-1">Set up searchplugins</a></h2>
<p>Searchplugins configuration has become too complex and it’s constantly evolving, because of that a <a href="https://bugzilla.mozilla.org/enter_bug.cgi?product=Firefox&amp;component=Search">bug needs to be filed</a> to let the Search Team set up new locales. This section is meant as an overall reference, with link to external documentation.</p>
<p>Given the complexity and external dependencies, it’s become common practice to set up searchplugins at a later phase, when the locale is ready to move from Nightly to Beta, and let Nightly rely on default settings.</p>
<p>Starting with Firefox 68, the <a href="https://developer.mozilla.org/en-US/docs/Web/OpenSearch">XML OpenSearch</a> format was dropped for built-in searchplugins, switching to <a href="https://searchfox.org/mozilla-central/source/browser/components/search/extensions">WebExtensions</a>. Each searchplugin has its own folder, with:</p>
<ul>
<li>An icon, which can be either in PNG format (<code>favicon.png</code>) or ICO (<code>favicon.ico</code>).</li>
<li>A WebExtension manifest (<code>manifest.json</code>). If the searchplugin supports only one locale, the manifest includes the localized name (repeated twice) and description (<a href="https://searchfox.org/mozilla-central/rev/a78233c11a6baf2c308fbed17eb16c6e57b6a2ac/browser/components/search/extensions/leo_ende_de/manifest.json">leo-ende example</a>).</li>
</ul>
<pre><code class="language-JSON">{
  &quot;name&quot;: &quot;LEO Eng-Deu&quot;,
   &quot;description&quot;: &quot;Deutsch-Englisch Wörterbuch von LEO&quot;,
  [...]
  &quot;chrome_settings_overrides&quot;: {
    &quot;search_provider&quot;: {
      &quot;name&quot;: &quot;LEO Eng-Deu&quot;,
      [...]
    }
  }
}
</code></pre>
<ul>
<li>A <code>_locales</code> folder if the searchplugins supports multiple locales. In this case, the manifest will only include placeholders for name and description, and they will be localized in a subfolder for the locale itself (<a href="https://searchfox.org/mozilla-central/rev/a78233c11a6baf2c308fbed17eb16c6e57b6a2ac/browser/components/search/extensions/wikipedia/_locales/it/messages.json">Wikipedia example</a>).</li>
</ul>
<pre><code class="language-JSON">  &quot;extensionName&quot;: {
    &quot;message&quot;: &quot;Wikipedia (it)&quot;
  },
  &quot;extensionDescription&quot;: {
    &quot;message&quot;: &quot;Wikipedia, l'enciclopedia libera&quot;
  },
</code></pre>
<p>As of Firefox 77, the search configuration is still stored in-tree (<a href="https://searchfox.org/mozilla-central/rev/41c3ea3ee8eab9ce7b82932257cb80b703cbba67/browser/components/search/extensions/list.json">list.json</a>). More recent versions of Firefox will switch to a new configuration system (<code>search-config.json</code>), and use <a href="https://firefox.settings.services.mozilla.com/v1/buckets/main/collections/search-config/records">Remote Settings</a> to be able to update the configuration independently from the release cycle. The new system, including the schema for <code>search-config.json</code>, is documented in <a href="https://firefox-source-docs.mozilla.org/toolkit/search/index.html">Firefox Documentation - Search Service</a>.</p>
<p>When <a href="https://bugzilla.mozilla.org/enter_bug.cgi?product=Firefox&amp;component=Search">filing a new bug</a>, make sure to provide the following information:</p>
<ul>
<li>The list of searchplugins to use for the locale.</li>
<li>If a new searchplugin needs to be added: name, description, icon, search parameters. The best way to make sure all information is included is to use existing searchplugins as reference.</li>
</ul>
<h3><a class="header" href="#tips-for-icons-and-wikipedia" id="tips-for-icons-and-wikipedia">Tips for icons and Wikipedia</a></h3>
<h4><a class="header" href="#icons" id="icons">Icons</a></h4>
<p>These are some useful tips to deal with icons for brand new searchplugins:</p>
<ul>
<li>If the image is a PNG, make sure to optimize it before encoding it to <code>base64</code> (for example using <a href="https://tinypng.com/">tinypng.com</a>).</li>
<li>You can create an <code>.ico</code> file starting from separate 16px and 32px PNG icons. Create a 32px image in <a href="https://www.gimp.org/">Gimp</a>, add each icon to a separate layer, and export the file as <code>.ico</code> (make sure to select the option to compress each of the layers).</li>
<li>You can use online services (like <a href="http://freeonlinetools24.com/base64-image">this one</a>) to quickly encode an image to <code>base64</code>.</li>
<li>You can test the image in the browser (copy and paste the data URI in the address bar). You will still have to download it to check that everything looks good, since only one image will be displayed for multilayer <code>.ico</code> files, and transparent files are displayed in a misleading way in Firefox preview.</li>
</ul>
<h4><a class="header" href="#wikipedia" id="wikipedia">Wikipedia</a></h4>
<p><strong>URLs:</strong> Make sure to update all URLs. If the URL for English starts with <code>en.wikipedia.</code>, for <code>ur</code> it should start with <code>ur.wikipedia.</code> (check if the domain actually exists).</p>
<p><strong>Search template:</strong> There’s one special URL to keep in mind, in English it’s https://en.wikipedia.org/wiki/Special:Search
It’s particular because the last part changes according to the locale, just try replacing the domain first from <code>en.</code> to <code>ur.</code>: https://ur.wikipedia.org/wiki/Special:Search
You’ll notice that it redirects to <code>https://ur.wikipedia.org/wiki/خاص:تلاش</code> and that’s the URL you need to use in the webextension.</p>
<p>You can’t copy the full URL from the address bar since it will encode UTF-8 characters, e.g. <code>https://ur.wikipedia.org/wiki/%D8%AE%D8%A7%D8%B5:%D8%AA%D9%84%D8%A7%D8%B4</code>, so it’s faster to just copy only part of the URL and fix the rest by hand.</p>
<p><strong>Description:</strong> You will need localizers to provide the translation for <code>Wikipedia, the Free Encyclopedia</code>.</p>
<p><strong>Name:</strong> In the localization file there’s an attribute called <code>extensionName</code>. For English is:</p>
<pre><code class="language-JSON">&quot;extensionName&quot;: {
  &quot;message&quot;: &quot;Wikipedia (en)&quot;
},
</code></pre>
<p>To get the localized name, visit https://gn.wikipedia.org and press <code>CTRL+U</code> to view the source code of the page. At the beginning you will find a line looking like this:</p>
<pre><code class="language-HTML">&lt;link rel=&quot;search&quot; type=&quot;application/opensearchdescription+xml&quot; href=&quot;/w/opensearch_desc.php&quot; title=&quot;ویکیپیڈیا (ur)&quot;/&gt;
</code></pre>
<p>The <em>Name</em> to use in your localization is <code>ویکیپیڈیا (ur)</code>. Copying and pasting RTL languages is particularly tricky.</p>
<h2><a class="header" href="#set-up-protocol-handlers" id="set-up-protocol-handlers">Set up protocol handlers</a></h2>
<p>You will be working on l10n-central to set up protocol handlers for a new locale, and you need this locale’s Mercurial repository on your computer.</p>
<p>l10n repositories for Firefox live in https://hg.mozilla.org/l10n-central. In this case, let’s assume that l10n clones will be stored in <code>~/mozilla/mercurial/l10n</code>, with a subfolder for each locale. So, if the locale is <code>ur</code>, the repository will be stored in <code>~/mozilla/mercurial/l10n/ur</code>.</p>
<pre><code class="language-BASH">$ mkdir -p ~/mozilla/mercurial/l10n
$ cd ~/mozilla/mercurial/l10n
</code></pre>
<p>The first command makes sure that the path for l10n repositories exists, the second moves into the folder.</p>
<p>If you don’t have a clone yet, you need to create it:</p>
<pre><code class="language-BASH">$ hg clone ssh://hg.mozilla.org/l10n-central/ur
</code></pre>
<p>The command uses <code>ssh://</code>, which means you need an active (and <a href="products/searchplugins/../../tools/mercurial/setting_mercurial_environment.html">properly configured</a>) SSH access to the repository.</p>
<p>Once the execution is completed, there should be a clone stored in <code>~/mozilla/mercurial/l10n/ur</code>.</p>
<p>If you already have a clone on your computer, always make sure to update it before doing anything:</p>
<pre><code class="language-BASH">$ cd ~/mozilla/mercurial/l10n/ur
$ hg pull -r default -u
</code></pre>
<h3><a class="header" href="#regionproperties" id="regionproperties">region.properties</a></h3>
<p>region.properties is stored in <code>/browser/chrome/browser-region</code> for Firefox desktop, and it contains information about protocol handlers. You can use <a href="products/searchplugins/files/desktop_region.properties">this region.properties model</a> as a base.</p>
<p>If you’re updating an existing file, make sure to not reset the <code>gecko.handlerService.defaultHandlersVersion</code> key. If, on the other hand, you’re adding a new handler, you will have to increment the existing numeric value.</p>
<h3><a class="header" href="#creating-a-patch-for-review-locale-repository" id="creating-a-patch-for-review-locale-repository">Creating a patch for review (locale repository)</a></h3>
<p>Once files are ready, follow the instructions available in <a href="products/searchplugins/../../tools/mercurial/creating_mercurial_patch.html">this document</a> to create a patch, submit it for review, and land it.</p>
<h1><a class="header" href="#working-with-pontoon" id="working-with-pontoon">Working with Pontoon</a></h1>
<p>Some documentation specific for common and advanced tasks on Pontoon</p>
<ul>
<li><a href="tools/pontoon/adding_new_project.html">Adding a new project</a>.</li>
<li><a href="tools/pontoon/adding_new_short_term_project.html">Adding a new short-term project</a>.</li>
<li><a href="tools/pontoon/adding_new_locale.html">Adding a new locale</a>.</li>
<li><a href="tools/pontoon/sending_notifications.html">Sending notifications</a>.</li>
<li><a href="tools/pontoon/renaming_a_file.html">Renaming a localization file</a>.</li>
<li><a href="tools/pontoon/deactivating_users.html">Deactivating users</a>.</li>
</ul>
<h1><a class="header" href="#adding-a-new-project-on-pontoon" id="adding-a-new-project-on-pontoon">Adding a new project on Pontoon</a></h1>
<h2><a class="header" href="#verify-that-the-project-is-properly-localizable" id="verify-that-the-project-is-properly-localizable">Verify that the project is properly localizable</a></h2>
<p>Project owners can follow the <a href="https://mozilla-pontoon.readthedocs.io/en/latest/user/localizing-your-projects.html">guidelines</a> available in Pontoon Documentation to properly structure files inside the repository. Some things to check:</p>
<ul>
<li>Files should be in a folder like <code>locale(s)/ab-CD/somefile.extension</code> and be in one of the supported formats (.ftl, .lang, .properties, .po, .xliff).</li>
<li>User <strong>mozilla-pontoon</strong> needs write access to the repository.</li>
</ul>
<p>It’s important to also check the files for localization issues before exposing them to localizers: unclear strings, lack of localization comments, missing plural forms are some of the things to check.</p>
<h2><a class="header" href="#create-the-project-in-pontoon-stage-instance" id="create-the-project-in-pontoon-stage-instance">Create the project in Pontoon STAGE instance</a></h2>
<p>First you want to test that everything works using Pontoon staging server.</p>
<p>Access Pontoon’s <a href="https://mozilla-pontoon-staging.herokuapp.com/admin/">admin console</a> on the <strong>stage server</strong> and click <strong>ADD NEW PROJECT</strong>.</p>
<ul>
<li>Name: name of the repository (it will be displayed in Pontoon’s project selector).</li>
<li>Slug: used in URLs, will be generated automatically based on the repository’s name.</li>
<li>Locales:
<ul>
<li>Select at least one locale. To make things faster it’s possible to copy supported locales from an existing project.</li>
<li>The <em>Read-only</em> column can be used to add languages in read-only mode. In this way, their translations will be available to other languages in the LOCALES tab when translating, but it won’t be possible to change or submit translations directly in Pontoon.</li>
<li>You can uncheck the <code>Locales can opt-in</code> checkbox to prevent localizers from requesting this specific project.</li>
</ul>
</li>
<li>Repositories: select the type of repository and URL. Make sure to use SSH to allow write access. For example, if the repository is <code>https://github.com/meandavejustice/min-vid</code>, the URL should be <code>git@github.com:meandavejustice/min-vid.git</code>. You can use the <em>Clone or download</em> button in the repository page on GitHub, making sure that <em>Clone with SSH</em> is selected.</li>
<li>Leave the <code>Branch</code> field empty, unless developers asked to commit translations in a branch instead of <em>master</em>.</li>
<li>Download prefix: a URL prefix for downloading localized files. For GitHub repositories, select any localized file on GitHub, click <code>Raw</code> and replace locale code and the following bits in the URL with <code>{locale_code}</code>. For example, if the link is <code>https://raw.githubusercontent.com/bwinton/TabCenter-l10n/master/locales/en-US/addon.properties</code>, the field should be set to <code>https://github.com/bwinton/TabCenter-l10n/blob/master/locales/{locale_code}</code>.</li>
<li>Public Repository Website: displayed on dashboards. E.g. <code>https://github.com/meandavejustice/min-vid</code>. Pontoon will try to prefill it after you enter Repository URL.</li>
<li>Project info: provide some information about the project to help localizers with context or testing instructions. HTML is supported, so you can add external links. For example:</li>
</ul>
<pre><code class="language-HTML">Localization for the &lt;a href=&quot;https://testpilot.firefox.com/experiments/min-vid&quot;&gt;Min Vid add-on&lt;/a&gt;.
</code></pre>
<ul>
<li>Internal admin notes: use them e.g. for developer contacts and information that other PMs will find useful when covering for you.</li>
<li>Deadline: if available, enter project deadline in the YYYY-MM-DD format.</li>
<li>Priority: select priority level from one of the 5 levels available (Lowest, Low, Normal, High, Highest).</li>
<li>Contact: select the L10n driver in charge of the project, probably yourself.</li>
<li>External Resources: provide links to external resources like l10n preview environment. You need to enter the name and the URL for each resource. You can also pick one of the predefined names: Development site, Production site, Development build, Production build, Screenshots, Language pack.</li>
<li>Visibility: determines who can access the project. Pontoon supports the following visibility types:
<ul>
<li>private (default) - only administrators can access the project.</li>
<li>public - the project is visible for everyone.</li>
</ul>
</li>
</ul>
<p>Click <strong>SAVE PROJECT</strong> at the bottom of the page, then click <strong>SYNC</strong> to run a test sync. In the <a href="https://mozilla-pontoon-staging.herokuapp.com/sync/log/">Sync log</a> you should be able to see if it succeeded or failed.</p>
<h3><a class="header" href="#tags" id="tags">Tags</a></h3>
<p>Tags can be used in a project to logically group resources, assigning them a priority. To enable tags for a project, check <em>Tags enabled</em> and save the project.</p>
<p>For each tag, it’s possible to define:</p>
<ul>
<li><em>Name</em>: it will be displayed in project (e.g. <code>/projects/firefox/tags/</code>) and localization dashboards (e.g. <code>/it/firefox/tags/</code>), but also in search filters.</li>
<li><em>Slug</em>: used in URLs for tag dashboards, e.g. <code>/projects/firefox/tags/devtools/</code>.</li>
<li><em>Priority</em>: like for a project, it’s possible to select a priority level from one of the 5 levels available (Lowest, Low, Normal, High, Highest).</li>
</ul>
<p><img src="tools/pontoon/../../assets/images/pontoon/manage_tags_resources.png" alt="Tags resources" /></p>
<p>Once you’ve created a new tag, you need to save the project in order to be able to manage the resources associated to the tag itself, using the button highlighted in red.</p>
<p>A few tips on using this section:</p>
<ul>
<li>Use the selector on the right (highlighted in orange) to switch between <em>Linked</em> resources, i.e. resources already associated to the tag, and <em>Unlinked</em> resources.</li>
<li>The first checkbox on the left (highlighted in green) allows to select all displayed items. Note: if the search returns multiple pages, only those currently displayed are selected and will be linked if <em>Link resources</em> is clicked.</li>
<li>There is no need to save the project when adding resources to a tag: linked resources are stored in the database as soon as they’re added with the <em>Link resources</em> button.</li>
</ul>
<p>Considering the amount of information required to properly set up tags in a project, it’s recommended to set them up directly in production, and use stage only for specific testing.</p>
<h3><a class="header" href="#resource-deadline" id="resource-deadline">Resource deadline</a></h3>
<p>Like for a project, it’s possible to set a deadline for a Resource.</p>
<p>Go to the <a href="https://pontoon.mozilla.org/a/base/resource/">resource section</a> of the admin panel, then type the name of your project (e.g. <code>engagement</code>) and hit <code>Enter</code>. All the resources for your project should appear. Click on the one you want to edit, set the deadline in the <code>Deadline</code> field, then click <code>SAVE</code>.</p>
<h2><a class="header" href="#create-the-project-in-pontoon-prod-instance" id="create-the-project-in-pontoon-prod-instance">Create the project in Pontoon PROD instance</a></h2>
<p>At this point you need to repeat the same steps on the <strong>production server</strong>.</p>
<p>Access Pontoon’s <a href="https://pontoon.mozilla.org/admin/">admin console</a>, add the same information you used on the staging server and make sure to select all supported locales for this project.</p>
<p>The new project will appear in the <a href="https://pontoon.mozilla.org/projects/">public list of Projects</a> only after the next sync cycle.</p>
<h1><a class="header" href="#adding-a-new-short-term-project-on-pontoon" id="adding-a-new-short-term-project-on-pontoon">Adding a new short-term project on Pontoon</a></h1>
<p>Short-term projects are things like newsletters, marketing campaigns, surveys… They do not have a repository, and data is instead stored only in Pontoon’s database.</p>
<p>The process to create a short-term project is very similar to that of a regular one.</p>
<h2><a class="header" href="#create-the-project-in-pontoon-stage-instance-1" id="create-the-project-in-pontoon-stage-instance-1">Create the project in Pontoon STAGE instance</a></h2>
<p>First you want to test that everything works using Pontoon staging server.</p>
<p>Access Pontoon’s <a href="https://mozilla-pontoon-staging.herokuapp.com/admin/">admin console</a> on the <strong>stage server</strong> and click <strong>ADD NEW PROJECT</strong>.</p>
<ul>
<li>Name: name of the project (it will be displayed in Pontoon’s project selector).</li>
<li>Slug: used in URLs, will be generated automatically based on the repository’s name.</li>
<li>Locales:
<ul>
<li>Select at least one locale. To make things faster it’s possible to copy supported locales from an existing project.</li>
<li>You can uncheck the <code>Locales can opt-in</code> checkbox to prevent localizers from requesting this specific project.</li>
</ul>
</li>
<li>Data Source: select <code>Database</code> in the list of options. This will hide the <em>Repositories</em> section and show a <em>Strings</em> section instead.</li>
<li>Strings: you can enter the initial set of strings here. Strings must be separated by new lines. If you leave this empty, you’ll be able to enter strings as a batch again after creating the project. Strings must be in <code>en-US</code>, and they will become the entities on that project. A resource named <code>database</code> will automatically be created.</li>
<li>For every other option, please refer to the <a href="tools/pontoon/adding_new_project.html">new project documentation</a>.</li>
</ul>
<p>Click <strong>SAVE PROJECT</strong> at the bottom of the page, and you’re done!</p>
<h2><a class="header" href="#create-the-project-in-pontoon-prod-instance-1" id="create-the-project-in-pontoon-prod-instance-1">Create the project in Pontoon PROD instance</a></h2>
<p>At this point you need to repeat the same steps on the <strong>production server</strong>.</p>
<p>Access Pontoon’s <a href="https://pontoon.mozilla.org/admin/">admin console</a>, add the same information you used on the staging server and make sure to select all supported locales for this project.</p>
<p>The new project will immediately appear in the <a href="https://pontoon.mozilla.org/projects/">public list of Projects</a>.</p>
<h2><a class="header" href="#managing-strings" id="managing-strings">Managing strings</a></h2>
<p>After you have created your project, you will be able to manage its source strings. On the admin project page (that you can find from the <a href="https://pontoon.mozilla.org/admin/">admin console</a>), under the <em>Strings</em> section, you will find two links. The one called <strong>MANAGE STRINGS</strong> will lead you to a page where all strings are listed. There you can edit the string content, edit the string comment, add new strings (use the <strong>NEW STRING</strong> button) or remove existing strings (use the trashbin icon under the comment input). Once you’re done editing, click the <strong>SAVE STRINGS</strong> button to save your changes.</p>
<h2><a class="header" href="#downloading-translations" id="downloading-translations">Downloading translations</a></h2>
<p>On the project’s admin page and on the Manage Strings page, you’ll find a <strong>DOWNLOAD STRINGS</strong> link. Clicking it will download a CSV file that contains all the translations in all enabled locales. The file format looks as follow:</p>
<pre><code class="language-CSV">Source, fr, de
Hello, Salut, Hallo
World, Monde, Welt
</code></pre>
<h1><a class="header" href="#adding-a-new-locale-on-pontoon" id="adding-a-new-locale-on-pontoon">Adding a new locale on Pontoon</a></h1>
<h2><a class="header" href="#verify-if-the-locale-is-already-available" id="verify-if-the-locale-is-already-available">Verify if the locale is already available</a></h2>
<p>Access Django’s admin interface at <code>https://pontoon.mozilla.org/a/</code> (note that this is not the usual admin interface), then click <code>Locales</code>. In the next page search for the locale you want to add (safer to search for the locale code).</p>
<p>Before moving forward:</p>
<ul>
<li>If the locale is going to work on mozilla.org, files need to be set up in <a href="tools/pontoon/../webdashboards/">tools</a> and GitHub before enabling the project in Pontoon.</li>
<li>If the locale is going to work on Firefox, it requires an <a href="https://hg.mozilla.org/l10n-central/">official Mercurial repository</a>.</li>
</ul>
<h2><a class="header" href="#add-the-new-locale" id="add-the-new-locale">Add the new locale</a></h2>
<p>If the locale you need is not available, click the <strong>ADD LOCALE+</strong> button in the top right corner. For this example, let’s consider that the task is to add Amharic (am).</p>
<p>You will need to complete the following fields in the next page.</p>
<h3><a class="header" href="#code" id="code">Code</a></h3>
<p>It’s the locale code, in this case <code>am</code>.</p>
<h3><a class="header" href="#google-translate-code" id="google-translate-code">Google Translate code</a></h3>
<p>Google Translate maintains a list of supported locales in its own format. Choose one that matches the locale from <a href="https://translate.google.com/intl/en/about/languages/">a list of supported locales</a> or leave it blank to disable support for Google Translate for this locale.</p>
<h3><a class="header" href="#ms-translator-code" id="ms-translator-code">MS translator code</a></h3>
<p>Microsoft Translator maintains a list of supported locales in its own format. Choose one that matches the locale from <a href="https://msdn.microsoft.com/en-us/library/hh456380.aspx">a list of supported locales</a> or leave it blank to disable support for Microsoft Translator for this locale.</p>
<h3><a class="header" href="#ms-terminology-code" id="ms-terminology-code">MS terminology code</a></h3>
<p>Microsoft Terminology maintains a list of supported locales in its own format. Choose one that matches the locale from a list provided below the field or leave it blank to disable support for Microsoft Terminology for this locale.</p>
<h3><a class="header" href="#name" id="name">Name</a></h3>
<p>It’s the language name, in this case <code>Amharic</code>.</p>
<h3><a class="header" href="#plural-rule" id="plural-rule">Plural rule</a></h3>
<p>It’s the GetText plural rule. This <a href="http://docs.translatehouse.org/projects/localization-guide/en/latest/l10n/pluralforms.html">document</a> has plural rules for several languages. For example, for Amharic it would be:</p>
<pre><code>nplurals=2; plural=(n &gt; 1);
</code></pre>
<p>As explained in the note below the field, you only need to put the last part in the field:</p>
<pre><code>(n &gt; 1)
</code></pre>
<h3><a class="header" href="#cldr-plurals" id="cldr-plurals">CLDR Plurals</a></h3>
<p>You need to find the locale on <a href="http://www.unicode.org/cldr/charts/dev/supplemental/language_plural_rules.html">CLDR</a>. For Amharic, there are only two <strong>cardinal</strong> plural forms listed: one, other.</p>
<p>The mapping is:</p>
<pre><code>0 -&gt; zero
1 -&gt; one
2 -&gt; two
3 -&gt; few
4 -&gt; many
5 -&gt; other
</code></pre>
<p>For Amharic you will need to set the field as <code>1,5</code>, separating the available forms with a comma (no spaces).</p>
<p>Irish (ga-IE), for example, has all of them except for 0, so it will be <code>1,2,3,4,5</code>.</p>
<h3><a class="header" href="#script" id="script">Script</a></h3>
<p>The script used by this locale. Find it in <a href="http://www.unicode.org/cldr/charts/latest/supplemental/languages_and_scripts.html">CLDR Languages and Scripts</a>.</p>
<h3><a class="header" href="#direction" id="direction">Direction</a></h3>
<p>Writing direction of the script. Set to <code>right-to-left</code> if <code>rtl</code> value for the locale script is set to <code>YES</code> in <a href="https://github.com/unicode-cldr/cldr-core/blob/master/scriptMetadata.json">CLDR scriptMetadata.json</a>.</p>
<h3><a class="header" href="#population" id="population">Population</a></h3>
<p>This represents the number of native speakers. There are two ways to get this information from CLDR.</p>
<h4><a class="header" href="#using-a-script" id="using-a-script">Using a script</a></h4>
<p>Python needs to be available on the method to use this system: save <a href="https://raw.githubusercontent.com/mozilla-l10n/documentation/master/scripts/cldr_population.py">this file</a> on your computer as <code>cldr_population.py</code> and run it as <code>python cldr_population.py LOCALE_CODE</code>.</p>
<p>For example, this is the output of the script when checking data for <code>sl</code>:</p>
<pre><code>$ python scripts/cldr_population.py sl

Adding HU: 4937 (0.05% of 9874780)
Adding IT: 105412 (0.17% of 62007500)
Adding SI: 1720886 (87% of 1978030)
Adding AT: 32233 (0.37% of 8711770)
--------
Territories: AT, HU, IT, SI
Population: 1863468
--------
</code></pre>
<h4><a class="header" href="#manual-process" id="manual-process">Manual process</a></h4>
<p>Find the locale code in <a href="https://github.com/unicode-cldr/cldr-core/blob/master/supplemental/territoryInfo.json">CLDR territoryInfo.json</a> and multiply its <code>_populationPercent</code> with the territory <code>_population</code>. Repeat if multiple occurrences of locale code exist and sum products.</p>
<p>At this point click <strong>SAVE</strong> in the bottom right corner to save and create the new locale. Then, from the <a href="https://pontoon.mozilla.org/admin/">standard admin interface</a>, enable at least one “non system project” (i.e. not <code>Tutorial</code> or <code>Pontoon Intro</code>) and wait until Pontoon syncs for the locale dashboard to work. You can then check if the locale’s page, as well as the new project, are available - in this case at https://pontoon.mozilla.org/am/</p>
<h1><a class="header" href="#sending-notifications-in-pontoon" id="sending-notifications-in-pontoon">Sending notifications in Pontoon</a></h1>
<p>Pontoon allows you to send in-app notifications to contributors of a specific project. To do so, go to your project dashboard and select the <a href="https://pontoon.mozilla.org/projects/pontoon-intro/notifications/">Notifications</a> tab.</p>
<h2><a class="header" href="#choose-recipient-teams" id="choose-recipient-teams">Choose recipient teams</a></h2>
<p>First you need to select project teams to send the notification to. You can select them manually or by using one of the available shortcuts:</p>
<ul>
<li><strong>All:</strong> all teams translating the project.</li>
<li><strong>Complete:</strong> teams with all strings translated in the project.</li>
<li><strong>Incomplete:</strong> teams that have untranslated strings in the project.</li>
</ul>
<p>All project contributors from selected teams will receive the notification.</p>
<p>You need to select at least one team.</p>
<h3><a class="header" href="#enter-notification-message" id="enter-notification-message">Enter notification message</a></h3>
<p>Next, enter the message you’d like to send. You can use HTML tags. Try to be concise and use HTML wisely.</p>
<h3><a class="header" href="#send" id="send">Send</a></h3>
<p>To send the notification, simply click the <strong>Send</strong> button and wait for the confirmation message to appear. It might take a moment. Once notifications are sent, you’ll be redirected to the Sent notifications panel.</p>
<h1><a class="header" href="#renaming-a-localization-file-in-a-project-without-losing-data" id="renaming-a-localization-file-in-a-project-without-losing-data">Renaming a localization file in a project without losing data</a></h1>
<p>In some cases, project owners will want to rename a file for clarity, or for technical reasons. If it’s only done in the VCS repository, the file will be imported again and you will lose attribution, pending suggestions and history. Since this is a special case, we can work around this and rename the file in Pontoon while keeping existing data (translations, suggestions, attribution, history). The process is not complicated, but it has to be highly coordinated.</p>
<h2><a class="header" href="#get-a-pull-request-ready" id="get-a-pull-request-ready">Get a Pull Request ready</a></h2>
<p>Either you or the project owners will get a Pull Request ready that renames the file for all locales. Using a script is recommended as you will need to generate the patch not too long before the next steps to avoid conflicts.</p>
<h2><a class="header" href="#rename-the-resource-in-pontoon-admin-panel" id="rename-the-resource-in-pontoon-admin-panel">Rename the resource in Pontoon admin panel</a></h2>
<p>Wait for the current Pontoon sync cycle to end, and make sure you are already logged into Pontoon admin, then merge the Pull Request.</p>
<p>As soon as the Pull Request is merged, go to the <a href="https://pontoon.mozilla.org/a/base/resource/">resource section</a> of the admin panel, then type the name of your project (e.g. <code>thimble</code>) and hit <code>Enter</code>. All the resources for your project should appear. Click on the one you want to rename, and in the <code>path</code> field, for instance rename <code>messages.properties</code> into <code>server.properties</code> then click <code>SAVE</code>.</p>
<p>It is crucial to do this step <strong>before</strong> the next sync cycle, otherwise the process won’t be effective.</p>
<p>After the next sync, open the file for one of the locales, you should be able to see all the existing data.</p>
<h1><a class="header" href="#deactivating-pontoon-users" id="deactivating-pontoon-users">Deactivating Pontoon users</a></h1>
<p>Access Django’s admin interface at <code>https://pontoon.mozilla.org/a/</code> (note that this is not the usual admin interface), then click <code>Users</code>. In the next page search for the user you want to deactivate (safer to search by email address):</p>
<ul>
<li>Click on the user among the results displayed under the search field.</li>
<li>In the <em>Permissions</em> section, deselect the <code>Active</code> checkbox and click <code>SAVE</code> at the bottom of the page.</li>
</ul>
<p>This will prevent them from logging into Pontoon, and will log them out of the system immediately.</p>
<p>At the moment, it’s not possible to safely remove users with all the associated data, and removal needs to be performed manually by developers.</p>
<h1><a class="header" href="#webdashboards" id="webdashboards">Webdashboards</a></h1>
<h2><a class="header" href="#langchecker" id="langchecker">Langchecker</a></h2>
<p><a href="tools/webdashboards/langchecker.html">Langchecker</a> is used to analyze all projects using .lang files as data sources. It also stores all configuration information needed to manage these repositories: which projects are supported, which files are in each project, which locales are supported for each project or file, metadata like critical status or deadlines.</p>
<p>Langchecker’s scripts are used to propagate changes to all .lang files, or add news ones, in l10n repositories. It also provides an API to retrieve translations, and information about coverage, i.e how many locales translated a specific string or a page, and what percentage of the l10n population that represents.</p>
<h2><a class="header" href="#installation" id="installation">Installation</a></h2>
<p>See the <em><a href="tools/webdashboards/index.html#useful-links">Useful Links</a></em> at the end of the document for links to the relevant GitHub code repositories. Follow the instructions provided in each README for system requirements and instructions.</p>
<p>Note that the instances on the l10n community server of all products use a GitHub’s webhook to update code automatically every time the repository is updated.</p>
<h2><a class="header" href="#tools" id="tools">Tools</a></h2>
<p>For detailed information check the specific pages for each project:</p>
<ul>
<li><a href="tools/webdashboards/langchecker.html">Langchecker</a>.</li>
</ul>
<p>These are detailed instructions for the most common tasks:</p>
<ul>
<li><a href="tools/webdashboards/add_locales.html">Add locales to an existing file</a>.</li>
<li><a href="tools/webdashboards/update_existing_file.html">Update an existing file</a>.</li>
<li><a href="tools/webdashboards/add_new_file.html">Add a new file to an existing project</a>.</li>
<li><a href="tools/webdashboards/bootstrap_new_locale.html">Bootstrap a new locale</a>.</li>
<li><a href="tools/webdashboards/remove_obsolete_files.html">Remove obsolete files</a>.</li>
</ul>
<p>For documentation specific to mozilla.org, see <a href="tools/webdashboards/../../products/mozilla_org/">this page</a>.</p>
<h2><a class="header" href="#contribution-guidelines" id="contribution-guidelines">Contribution Guidelines</a></h2>
<p>Always work on forks of the main repository and open pull requests if you’re going to update code. Automated tests are run with Travis on each pull request to check for syntax and functional errors.</p>
<h2><a class="header" href="#useful-links" id="useful-links">Useful Links</a></h2>
<h3><a class="header" href="#mozillaorg" id="mozillaorg">Mozilla.org</a></h3>
<ul>
<li>Code repository (codename bedrock): <a href="https://github.com/mozilla/bedrock">https://github.com/mozilla/bedrock</a></li>
<li>Trunk localization: <a href="https://github.com/mozilla-l10n/www.mozilla.org">https://github.com/mozilla-l10n/www.mozilla.org</a></li>
<li>Production localization: <a href="https://github.com/mozilla-l10n/bedrock-l10n">https://github.com/mozilla-l10n/bedrock-l10n</a></li>
</ul>
<h3><a class="header" href="#langchecker-1" id="langchecker-1">Langchecker</a></h3>
<ul>
<li>Production instance: <a href="https://l10n.mozilla-community.org/langchecker/">https://l10n.mozilla-community.org/langchecker/</a></li>
<li>Code: <a href="https://github.com/mozilla-l10n/langchecker/">https://github.com/mozilla-l10n/langchecker/</a></li>
</ul>
<h1><a class="header" href="#langchecker-2" id="langchecker-2">Langchecker</a></h1>
<p>Langchecker is the main repository to update when adding or updating files. There are four different configuration files:</p>
<ul>
<li><a href="https://github.com/mozilla-l10n/langchecker/blob/master/app/config/locales.inc.php">app/config/locales.inc.php</a>: it contains several lists of locales, like locales supported in mozilla.org, locales only working in Fennec, etc. These lists are then used in the main configuration file to determine which locales are supported for each file. Normally you would need to update this file only when bootstrapping new languages.</li>
<li><a href="https://github.com/mozilla-l10n/langchecker/blob/master/app/config/websites.inc.php">app/config/websites.inc.php</a>: it contains the configuration for websites (projects) supported in Langchecker.</li>
<li><a href="https://github.com/mozilla-l10n/langchecker/blob/master/app/config/sources.inc.php">app/config/sources.inc.php</a>: it contains the configuration for all files supported in Langchecker.</li>
</ul>
<p>Langchecker also includes several command line scripts to manage day-to-day operations on supported repositories. For example:</p>
<ul>
<li><a href="https://github.com/mozilla-l10n/langchecker/blob/master/app/scripts/lang_update">app/scripts/lang_update</a>: reads the original en-US file, adds missing strings to requested files, reformat localized .lang files. It can also be used to import existing translations from another .lang file.</li>
<li><a href="https://github.com/mozilla-l10n/langchecker/blob/master/app/scripts/mark_active">app/scripts/mark_active</a>: mark complete files (all strings translated, no errors) as active.</li>
<li><a href="https://github.com/mozilla-l10n/langchecker/blob/master/app/scripts/add_tags">app/scripts/add_tags</a>: add l10n tags to a file. Some strings in a file can be bound to a tag, allowing to display them in production for mozilla.org only when they’re localized. This script examines if all the strings associated to a specific tag are localized, and adds tags to localized files.</li>
</ul>
<p><a href="https://github.com/mozilla-l10n/langchecker/wiki">Langchecker's wiki</a> has a full list of the available views, API calls, and command line scripts.</p>
<h2><a class="header" href="#sources-structure" id="sources-structure">Sources Structure</a></h2>
<p>Each project is internally called website, and it’s identified by a numeric index. These are the projects currently supported.</p>
<table><thead><tr><th>ID</th><th>Codename</th><th>Description</th></tr></thead><tbody>
<tr><td>0</td><td>www.mozilla.org</td><td>Used to track all files for www.mozilla.org</td></tr>
<tr><td>6</td><td>engagement</td><td>Used for Engagement material, typically snippets.</td></tr>
</tbody></table>
<p>Let’s consider a simple project like Engagement. This is how its definition looks like in the main <code>$sites</code> variable.</p>
<pre><code class="language-PHP">6 =&gt; [
    'engagement',
    $repositories['engagement']['local_path'],
    '',
    $engagement_locales,
    $engagement_lang,
    'en-US', // source locale
    $repositories['engagement']['public_path'],
    1,
    'lang',
    'engagement',
    ['tags'],
],
</code></pre>
<p>The structure of each item is:</p>
<ol>
<li>Name (used when displaying the website).</li>
<li>Path to local repository.</li>
<li>Folder containing locale files.</li>
<li>Array of supported locale.</li>
<li>Array of supported files with all associated data.</li>
<li>Reference locale code.</li>
<li>URL to public repo (used to create links to files).</li>
<li>Default priority, used as fallback when files don't specify one.</li>
<li>Type of files (<code>lang</code>, <code>raw</code>).</li>
<li>Project name on Pontoon (used for edit links).</li>
<li>Array of excluded error checks (<code>tags</code>).</li>
</ol>
<p>For each website there is a list of supported locales, but each file might only use a subset of this list.</p>
<p>For this project, the list of supported files is stored in <code>$engagement_lang</code>.</p>
<pre><code class="language-PHP">$engagement_lang = [
    'ads/ios_android_apr2016.lang' =&gt; [
        'supported_locales' =&gt; ['de', 'es-ES', 'fr', 'pl'],
    ],
    'ads/ios_android_feb2017.lang' =&gt; [
        'deadline'          =&gt; '2017-02-02',
        'supported_locales' =&gt; ['zh-HK', 'zh-TW'],
    ],
    ...
</code></pre>
<p>Flags commonly used are:</p>
<ul>
<li><strong>obsolete</strong>: this field was used to hide specific elements from the Webdashboard, typically files that needed to remain in the repository and would be removed later.</li>
<li><strong>opt-in</strong>: the file was requested only for some locales, but others can decide to <em>opt-in</em> and request the page for translation through Bugzilla.</li>
</ul>
<p>For more details on the structure of this file, check the [add_new_file.md](documentation to track new files).</p>
<h1><a class="header" href="#bootstrap-a-new-locale" id="bootstrap-a-new-locale">Bootstrap a new locale</a></h1>
<h2><a class="header" href="#langchecker-3" id="langchecker-3">Langchecker</a></h2>
<p>The first thing you need to do is to add the new locale code to the <code>$mozilla</code> array in <a href="https://github.com/mozilla-l10n/langchecker/blob/master/app/config/locales.inc.php">app/config/locales.php</a>. Note that all lists of locales are in alphabetical order.</p>
<p>If this new locale is going to localize only Fennec, you need to add it also to the <code>$fennec_locales</code> array. If it’s only working on mozilla.org, add it to <code>$mozorg_locales</code>. In this way desktop specific pages won’t be exposed for this language.</p>
<p>Example: let’s say you need to add the <code>ab-CD</code> locale. This is how the <code>$mozilla</code> array begins:</p>
<pre><code class="language-PHP">$mozilla = [
    'ach', 'af', 'an', 'ar', 'as', 'ast', 'az', 'be', 'bg',
    'bm', 'bn-BD', 'bn-IN', 'br', 'brx', 'bs', 'ca', 'cak',
</code></pre>
<p>And how it becomes after adding the new locale:</p>
<pre><code class="language-PHP">$mozilla = [
    'ab-CD', 'ach', 'af', 'an', 'ar', 'as', 'ast', 'az', 'be', 'bg',
    'bm', 'bn-BD', 'bn-IN', 'br', 'brx', 'bs', 'ca', 'cak',
</code></pre>
<h2><a class="header" href="#add-files-to-l10n-repositories-mozillaorg" id="add-files-to-l10n-repositories-mozillaorg">Add files to l10n repositories (mozilla.org)</a></h2>
<p>At this point you need to add the files to <code>www.mozilla.org</code> by using the <code>lang_update</code> script.</p>
<p>Run the following commands:</p>
<pre><code class="language-BASH">$ lang_update all 0 ab-CD
</code></pre>
<p>This will add <strong>all</strong> missing files to mozilla.org (ID: 0) for the <strong>ab-CD</strong> locale (you could also run it with the <strong>all</strong> parameter, but it might introduce changes not relevant for this task).</p>
<p>Move to the l10n repository for mozilla.org, check the status and commit (don’t forget to add the new folder). <code>trunkst</code> is available as a shortcut to move in the folder and run <code>git status</code>.</p>
<pre><code class="language-BASH">$ trunkst
On branch master
Your branch is up-to-date with 'origin/master'.
Untracked files:
  (use &quot;git add &lt;file&gt;...&quot; to include in what will be committed)

	ab-CD/

nothing added to commit but untracked files present (use &quot;git add&quot; to track)

$ git add ab-CD

$ git commit -m &quot;Bootstrap locale ab-CD on mozilla.org&quot;

$ git push
</code></pre>
<h1><a class="header" href="#add-locales-to-an-existing-file" id="add-locales-to-an-existing-file">Add locales to an existing file</a></h1>
<p>Example task: add <code>sv-SE</code> to the list of supported locales for <code>foundation/index.lang</code>.</p>
<h2><a class="header" href="#updating-langchecker-sources" id="updating-langchecker-sources">Updating Langchecker sources</a></h2>
<p>First you need to search for the file that you want to update in <a href="https://github.com/mozilla-l10n/langchecker/blob/master/app/config/sources.inc.php">app/config/sources.inc.php</a>.</p>
<p>Always remember to <strong>work on a fork</strong> of the main repository, and <strong>create a branch</strong> in your local clone. Assuming the langchecker installation is in <code>~/mozilla/git/langchecker</code>, and that the branch name you want to create is <code>TESTBRANCH</code>, the commands to use would be:</p>
<pre><code class="language-BASH">$ cd ~/mozilla/git/langchecker
$ git branch TESTBRANCH
$ git checkout TESTBRANCH
</code></pre>
<p>At this point you’re ready to update the configuration file.</p>
<pre><code class="language-PHP">'foundation/index.lang' =&gt; [
    'flags' =&gt; [
        'opt-in' =&gt; ['all'],
    ],
    'supported_locales' =&gt; [
        'de', 'es-ES', 'fr', 'kab', 'pl', 'pt-BR', 'zh-TW',
    ],
],
</code></pre>
<p>Adding <code>sv-SE</code> would result in:</p>
<pre><code class="language-PHP">'foundation/index.lang' =&gt; [
    'flags' =&gt; [
        'opt-in' =&gt; ['all'],
    ],
    'supported_locales' =&gt; [
        'de', 'es-ES', 'fr', 'kab', 'pl', 'pt-BR', 'sv-SE', 'zh-TW',
    ],
],
</code></pre>
<p>Commit the changes and open a pull request on the <a href="https://github.com/mozilla-l10n/langchecker">main repository</a>.</p>
<pre><code class="language-BASH">$ cd ~/mozilla/git/langchecker
$ git add app/config/sources.inc.php
$ git commit -m &quot;Add sv-SE to foundation/index.lang&quot;
$ git push origin TESTBRANCH
</code></pre>
<h2><a class="header" href="#adding-the-file-to-the-repository" id="adding-the-file-to-the-repository">Adding the file to the repository</a></h2>
<p>At this point you need to run <code>lang_update</code> to actually add the file to the repository.</p>
<pre><code class="language-BASH">$ lang_update all 0 sv-SE
</code></pre>
<p>This line updates <strong>all</strong> files, for website 0 (mozilla.org), for <strong>sv-SE</strong>.</p>
<p>Move in the l10n repository, make sure to add the file and commit.</p>
<pre><code class="language-BASH">$ trunkst
On branch master
Your branch is up-to-date with 'origin/master'.
Untracked files:
  (use &quot;git add &lt;file&gt;...&quot; to include in what will be committed)

	sv-SE/foundation/index.lang

nothing added to commit but untracked files present (use &quot;git add&quot; to track)

$ git add sv-SE
$ git commit -m &quot;Add foundation/index.lang to sv-SE&quot;
$ git push
</code></pre>
<h1><a class="header" href="#update-an-existing-file" id="update-an-existing-file">Update an existing file</a></h1>
<p>This task can be split into smaller tasks:</p>
<ul>
<li>Add the new strings to the reference file (typically en-US).</li>
<li>Update the deadline (optional).</li>
<li>Update the file for all locales adding the new strings.</li>
</ul>
<h2><a class="header" href="#add-the-new-strings-to-the-reference-file" id="add-the-new-strings-to-the-reference-file">Add the new strings to the reference file</a></h2>
<p>Edit the reference file and add new strings as needed.</p>
<p>If you’re adding a string behind a tag, always remember to bind the new string to the tag and to add the tag itself to the beginning of the file. <a href="tools/webdashboards/../../products/mozilla_org/working_bedrock.html">Working with Bedrock</a> has more details about it.</p>
<p>Always check the diff after completing, to make sure you’re not introducing unwanted changes. If you’re using the l10n-drivers virtual machine, you can use <code>trunkst</code> to move to the mozilla.org trunk folder and check the status (<code>git status</code>) and diff (<code>git diff</code>).</p>
<p>Also double check the <a href="https://l10n.mozilla-community.org/langchecker/?action=errors">Errors View</a>, since it will warn if you’re introducing a duplicated string in the same file.</p>
<h2><a class="header" href="#update-the-deadline" id="update-the-deadline">Update the deadline</a></h2>
<p>If the file has a deadline set, you normally need to update it (e.g. plus 2 weeks from the the update).</p>
<p>Search for the filename in <a href="https://github.com/mozilla-l10n/langchecker/blob/master/app/config/sources.inc.php">app/config/sources.inc.php</a> and simply update the date associated to this file respecting the format <code>YEAR-MM-DD</code>.</p>
<h2><a class="header" href="#update-the-file-for-all-locales" id="update-the-file-for-all-locales">Update the file for all locales</a></h2>
<p>At this point you need to run <code>lang_update</code> to propagate the update to all locales. Assuming that the file is called <code>mozorg/contribute/signup.lang</code>, run:</p>
<pre><code class="language-BASH">$ lang_update mozorg/contribute/signup.lang 0 all
</code></pre>
<p>This line updates <code>mozorg/contribute/signup.lang</code>, for website <code>0</code> (mozilla.org), for <strong>all</strong> locales.</p>
<p>Move in the l10n repository (remember the <code>trunkst</code> shortcut) and spot check at least a couple of locales. For example, to check <code>fr</code>, run <code>git diff fr</code>. <strong>IMPORTANT</strong>: never run just <code>git diff</code>, otherwise you’ll get the diff for over a hundred locales.</p>
<p>After checking that everything looks correct, commit (notice the <code>-a</code>parameter to commit all changed files already tracked).</p>
<pre><code class="language-BASH">$ trunkst
On branch master
Your branch is up-to-date with 'origin/master'.
Untracked files:
  (use &quot;git add &lt;file&gt;...&quot; to include in what will be committed)

	(list of all locales and files added)

nothing added to commit but untracked files present (use &quot;git add&quot; to track)

$ git commit -a -m &quot;Add new strings to mozorg/contribute/signup.lang&quot;
$ git push
</code></pre>
<p>Make sure to check the commit on GitHub after pushing, especially to verify if the commit included any unwanted change.</p>
<h1><a class="header" href="#remove-obsolete-files-from-repositories" id="remove-obsolete-files-from-repositories">Remove obsolete files from repositories</a></h1>
<p>Once a file has been completely removed from <a href="tools/webdashboards/langchecker.html">Langchecker</a>, it’s possible to remove files from the repository using a script available within the tool. Note that files are initially marked as obsolete, and only removed after a few weeks or months.</p>
<p>This document assumes that you have set up the system as explained in <a href="tools/webdashboards/../../config/setup_l10ndrivers_vm.html">this document</a>, so aliases like <code>lang_update</code> are available, repositories are already cloned in <code>~/mozilla/repositories</code>, Atom is available and includes the syntax highlighter for LANG files.</p>
<p>Let’s assume that the file removed from Langchecker is called <code>firefox/australis/firefox_tour.lang</code> and belongs to the website <em>mozilla.org</em> (ID 0).</p>
<p>To check which locales still have this file, it’s enough to move into the local clone (since it’s <em>mozilla.org</em>, you can use the <code>trunkst</code> shortcut instead of <code>cd ~/mozilla/repositories/mozilla_org</code>) and run the script called <code>untracked_files</code> (full path to the script would be <code>~/mozilla/git/langchecker/app/scripts/untracked_files</code>).</p>
<pre><code>$ trunkst
On branch master
Your branch is up-to-date with 'origin/master'.
nothing to commit, working directory clean
$ untracked_files
$
</code></pre>
<p>If the output of the command is empty, like in this case, it means that there are no untracked files in the repository.</p>
<p>Without additional parameters, the script checks automatically <em>mozilla.org</em>. It’s possible to examine a different repository by passing the ID of the website within Langchecker, e.g. for engagement (ID 6):</p>
<pre><code>$ untracked_files 6
</code></pre>
<p>If there are untracked files, the output will look like this:</p>
<pre><code>$ untracked_files
ach/firefox/australis/firefox_tour.lang
af/firefox/australis/firefox_tour.lang
am/firefox/australis/firefox_tour.lang
an/firefox/australis/firefox_tour.lang
ar/firefox/australis/firefox_tour.lang
as/firefox/australis/firefox_tour.lang
...
</code></pre>
<p>The first step to remove these files is to <strong>create a new branch</strong>:</p>
<pre><code>$ git branch my_branch
$ git checkout my_branch
</code></pre>
<p>Then <em>pipe</em> the output of <code>untracked_files</code> to a command that actually removes the files from the repository (make sure to be in the repository’s folder before running the command):</p>
<pre><code>$ untracked_files | xargs git rm $1
rm 'ach/firefox/australis/firefox_tour.lang'
rm 'af/firefox/australis/firefox_tour.lang'
rm 'am/firefox/australis/firefox_tour.lang'
rm 'an/firefox/australis/firefox_tour.lang'
rm 'ar/firefox/australis/firefox_tour.lang'
rm 'as/firefox/australis/firefox_tour.lang'
...
</code></pre>
<p>Checking <code>git status</code> will show that files are staged to be removed. You only need to commit these changes and push them to your branch:</p>
<pre><code>$ git status
On branch test
Changes to be committed:
  (use &quot;git reset HEAD &lt;file&gt;...&quot; to unstage)

	deleted:    ach/firefox/australis/firefox_tour.lang
	deleted:    af/firefox/australis/firefox_tour.lang
	deleted:    am/firefox/australis/firefox_tour.lang
	deleted:    an/firefox/australis/firefox_tour.lang
	deleted:    ar/firefox/australis/firefox_tour.lang
	deleted:    as/firefox/australis/firefox_tour.lang
...

$ git commit -a -m &quot;Remove obsolete file firefox/australis/firefox_tour.lang&quot;
$ git push origin my_branch
</code></pre>
<p>At this point create a pull request from this branch, review it to make sure it doesn’t include unnecessary changes, squash and merge it. In case of <em>mozilla.org</em>, you’ll also need to cherry-pick the merge commit to production.</p>
<p>One important detail to keep in mind is that <strong>Japanese (ja) is automatically excluded from checks for mozilla.org</strong>, since they localize several pages that are not tracked by our systems. It’s possible to check the list of untracked files in Japanese alone by running:</p>
<pre><code>$ untracked_files 0 ja
ja/foundation/annualreport/2010/ahead.lang
ja/foundation/annualreport/2010/faq.lang
ja/foundation/annualreport/2010/index.lang
ja/foundation/annualreport/2010/opportunities.lang
ja/foundation/annualreport/2010/people.lang
ja/foundation/feed-icon-guidelines/faq.lang
ja/foundation/feed-icon-guidelines/index.lang
ja/foundation/trademarks/distribution-policy.lang
ja/foundation/trademarks/faq.lang
ja/foundation/trademarks/index.lang
ja/foundation/trademarks/l10n-website-policy.lang
ja/foundation/trademarks/list.lang
ja/foundation/trademarks/policy.lang
ja/mozorg/about/policy/lean-data.lang
</code></pre>
<p>If you want to remove a file for Japanese, you’ll need to do it manually with <code>git rm</code> before committing to the branch, i.e.</p>
<pre><code>$ git rm ja/firefox/australis/firefox_tour.lang
</code></pre>
<h1><a class="header" href="#add-a-new-file-to-an-existing-project" id="add-a-new-file-to-an-existing-project">Add a new file to an existing project</a></h1>
<p>This task can be split into smaller tasks:</p>
<ul>
<li>Add the file to the list of supported files specifying:
<ul>
<li>List of supported locales.</li>
<li>Priority (optional).</li>
<li>Flags (optional).</li>
<li>Deadline (optional).</li>
</ul>
</li>
<li>Add the files to all locales in the l10n repository.</li>
</ul>
<p>To analyze all steps, let’s consider a practical example: you need to add a file called <code>mozorg/contribute/signup.lang</code> to the project <code>www.mozilla.org</code>. The file is priority 1 only for French and German, <code>opt-in</code> for other locales, and deadline is May 30th, 2016. Note that most of the time a file will have the same priority for all locales, and won’t have any flags.</p>
<h2><a class="header" href="#add-the-file-to-the-list-of-supported-files" id="add-the-file-to-the-list-of-supported-files">Add the file to the list of supported files</a></h2>
<p>The file you need to update is <a href="https://github.com/mozilla-l10n/langchecker/blob/master/app/config/sources.inc.php">app/config/sources.inc.php</a>.</p>
<p>In <a href="https://github.com/mozilla-l10n/langchecker/blob/master/app/config/websites.inc.php">app/config/websites.inc.php</a> there is a global array <code>$sites</code> that defines all parameters for each project. For <code>www.mozilla.org</code> it looks like this:</p>
<pre><code class="language-PHP">0 =&gt; [
    'www.mozilla.org',
    $repositories['www.mozilla.org']['local_path'],
    '',
    $mozillaorg,
    $mozillaorg_lang,
    'en-US', // source locale
    $repositories['www.mozilla.org']['public_path'],
    3,
    'lang',
    [],
],
</code></pre>
<p>The array storing all supported files is the 5th element (<code>$mozillaorg_lang</code>). With time you won’t need to check the configuration array, it will be enough to search for a similar file in the same project.</p>
<h3><a class="header" href="#supported-locales" id="supported-locales">Supported locales</a></h3>
<p>Search for the definition of <code>$mozillaorg_lang</code> in <code>app/config/sources.inc.php</code> and add the new file, respecting the existing alphabetical order (snippets represent an exception to this rule). This is how the definition’s begin looks:</p>
<pre><code class="language-PHP">$mozillaorg_lang = [
    'download_button.lang' =&gt; [
        'deadline'          =&gt; '2016-04-29',
        'priority '         =&gt; 1,
        'supported_locales' =&gt; $mozillaorg,
    ],
</code></pre>
<p>Supported locales are defined in each file as an array associated to the key <code>supported_locales</code>. If this key is missing, file will fall back to the list of locales supported for the website (project) it belongs to. For clarity it’s highly suggested to always specify the list of supported locales.</p>
<p>For the list of locales you should check the definition for existing similar files. In this case, you can use the same settings as another <code>contribute</code> pages:</p>
<pre><code class="language-PHP">'mozorg/contribute/index.lang' =&gt; [
    'flags' =&gt; [
        'opt-in' =&gt; ['all'],
    ],
    'priority'          =&gt; 2,
    'supported_locales' =&gt; $getinvolved_locales,
],
'mozorg/contribute/signup.lang' =&gt; [
    'supported_locales' =&gt; $getinvolved_locales,
],
</code></pre>
<h3><a class="header" href="#priority" id="priority">Priority</a></h3>
<p>NOTE: The <em>priority</em> field was used only by the Webdashboard. It can still be used to store a reference to the expected priority.</p>
<p>Priority is optional and can defined for each file. If the priority is the same for all locales, you can assign the integer value (from 1 to 5) to a <code>priority</code> key.</p>
<pre><code class="language-PHP">'mozorg/contribute/index.lang' =&gt; [
    'priority'          =&gt; 2,
    'supported_locales' =&gt; $getinvolved_locales,
],
</code></pre>
<p>It’s also possible to define a more complex set of priorities using an associative array, where to each priority (a numeric key) is associated an array of locales. <code>all</code> is a special locale to represent all supported locales for this file. For example:</p>
<pre><code class="language-PHP">'priorities'          =&gt; [
    1 =&gt; ['de', 'fr'],
    2 =&gt; ['all'],
],
</code></pre>
<p>If you don’t specify a priority, the file will fall back to the default priority specified for the project (in <code>$sites</code>). In this case the request is to set the file with priority 1 for French and German, while the default for mozilla.org is 3.</p>
<p>In this case, the request is to assign priority 1 only to French and German</p>
<pre><code class="language-PHP">'mozorg/contribute/signup.lang' =&gt; [
    'priority'          =&gt; [
        1 =&gt; ['de', 'fr'],
    ],
    'supported_locales' =&gt; $getinvolved_locales,
],
</code></pre>
<h3><a class="header" href="#flags" id="flags">Flags</a></h3>
<p>Flag are defined for each file as an array associated to the key <code>flags</code>:</p>
<pre><code class="language-PHP">'mozorg/contribute/index.lang' =&gt; [
    'flags' =&gt; [
        'opt-in' =&gt; ['all'],
    ],
    'supported_locales' =&gt; $getinvolved_locales,
],
</code></pre>
<p>To each flag (key) is associated an array of locales. <code>all</code> is a special locale to represent all supported locales for this file. Flags currently in use are: obsolete, opt-in.</p>
<p>In this case, the request is to flag the file as opt-in for all locales.</p>
<pre><code class="language-PHP">'mozorg/contribute/signup.lang' =&gt; [
    'flags'    =&gt; [
        'opt-in' =&gt; ['all'],
    ],
    'priority'          =&gt; [
        1 =&gt; ['de', 'fr'],
    ],
    'supported_locales' =&gt; $getinvolved_locales,
],
</code></pre>
<h3><a class="header" href="#deadline" id="deadline">Deadline</a></h3>
<p>NOTE: The <em>deadline</em> field was used only by the Webdashboard. It can still be used to store a reference to the expected deadline.</p>
<p>If the deadline is the same for all locales, you can assign the date (as a string in ISO format YYYY-MM-DD) to a <code>deadline</code> key. In this case, deadline needs to be set to May 30th, 2016 (2016-05-30):</p>
<pre><code class="language-PHP">'mozorg/contribute/signup.lang' =&gt; [
    'deadline' =&gt; '2016-05-30',
    'flags'    =&gt; [
        'opt-in' =&gt; ['all'],
    ],
    'priority'          =&gt; [
        1 =&gt; ['de', 'fr'],
    ],
    'supported_locales' =&gt; $getinvolved_locales,
],
</code></pre>
<p>It’s also possible to define different deadlines for locales using an associative array, where to each deadline (date in ISO format YYYY-MM-DD) is associated an array of locales. <code>all</code> is a special locale to represent all supported locales for this file. For example, a deadline for German and French, and a later date for other languages:</p>
<pre><code class="language-PHP">'deadline' =&gt; [
    '2016-05-30' =&gt; ['de', 'fr'],
    '2016-06-15' =&gt; ['all'],
];
</code></pre>
<p>Or a deadline only for French:</p>
<pre><code class="language-PHP">'deadline' =&gt; [
    '2016-05-30' =&gt; ['fr'],
];
</code></pre>
<h2><a class="header" href="#add-the-files-to-all-locales-in-the-l10n-repository" id="add-the-files-to-all-locales-in-the-l10n-repository">Add the files to all locales in the l10n repository</a></h2>
<p>At this point you need to run <code>lang_update</code> to actually add the file to all locales.</p>
<pre><code class="language-BASH">lang_update mozorg/contribute/signup.lang 0 all
</code></pre>
<p>This line updates <code>mozorg/contribute/signup.lang</code>, for website 0 (mozilla.org), for <strong>all</strong> locales.</p>
<p>Move in the l10n repository, make sure to add the file and commit.</p>
<pre><code class="language-BASH">$ trunkst
On branch master
Your branch is up-to-date with 'origin/master'.
Untracked files:
  (use &quot;git add &lt;file&gt;...&quot; to include in what will be committed)

	(list of all locales and files added)

nothing added to commit but untracked files present (use &quot;git add&quot; to track)

$ git add .
$ git commit -m &quot;Add new page mozorg/contribute/signup.lang&quot;
$ git push
</code></pre>
<p>Note: <code>git add .</code> adds all the new files in the current repository. Make sure to check the list returner by <code>git status</code>, and to check the commit on GitHub after pushing.</p>
<h1><a class="header" href="#working-with-mercurial" id="working-with-mercurial">Working with Mercurial</a></h1>
<p>How to set up and work with Mercurial:</p>
<ul>
<li><a href="tools/mercurial/setting_mercurial_environment.html">Set up the environment</a>.</li>
<li><a href="tools/mercurial/creating_mercurial_patch.html">Create a patch</a>.</li>
<li><a href="tools/mercurial/useful_mercurial_commands.html">Useful Mercurial commands</a>.</li>
</ul>
<h1><a class="header" href="#set-up-the-environment-for-mercurial" id="set-up-the-environment-for-mercurial">Set up the environment for Mercurial</a></h1>
<p><strong>IMPORTANT:</strong> This configuration has to be done only once on the computer. After that you will simply need to keep Mercurial up to date (a new version is released every month).</p>
<h2><a class="header" href="#mercurial" id="mercurial">Mercurial</a></h2>
<p>Most of the work needs to be done in <a href="https://www.mercurial-scm.org/downloads">Mercurial</a>, so you need to install if first. An alternative way to install it on macOS is via <a href="https://brew.sh/">homebrew</a> with <code>brew install hg</code> (<code>brew upgrade hg</code> to update it later).</p>
<p>To check if Mercurial is available and up to date, run in the terminal <code>hg --version</code>, the output should look like this:</p>
<pre><code class="language-BASH">$ hg --version
Mercurial Distributed SCM (version 4.0.1)
(see https://mercurial-scm.org for more information)

Copyright (C) 2005-2016 Matt Mackall and others
This is free software; see the source for copying conditions. There is NO
warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
</code></pre>
<p>Unless you’re familiar with <code>vi</code>, you also want to setup <code>nano</code> as the default editor in the system.</p>
<pre><code class="language-BASH">$ export EDITOR=/usr/bin/nano
</code></pre>
<h2><a class="header" href="#mercurial-configuration" id="mercurial-configuration">Mercurial configuration</a></h2>
<p>Mercurial’s configuration is stored in a hidden file called <code>.hgrc</code> inside your user folder (<code>~/.hgrc</code>). You will need to create it if it’s not available on the system.</p>
<p>It’s divided into sections, with section names between square parentheses. For example:</p>
<pre><code class="language-INI">[ui]
username = something@example.com
</code></pre>
<h2><a class="header" href="#set-up-ssh-access-for-l10n-repositories" id="set-up-ssh-access-for-l10n-repositories">Set up SSH access for l10n repositories</a></h2>
<p>In order to be able to commit directly to l10n repositories, you need SSH access via your LDAP account (both obtained through a bug, where you also provide your SSH key).</p>
<p>Assuming your SSH key is stored in <code>~/.ssh/id_rsa</code>, your <code>.ssh/config</code> file should have a line that looks like this</p>
<pre><code>Host hg.mozilla.org
User YOUR_LDAP_EMAIL_ADDRESS
IdentityFile ~/.ssh/id_rsa
</code></pre>
<h2><a class="header" href="#set-up-arcanist-for-phabricator" id="set-up-arcanist-for-phabricator">Set up Arcanist for Phabricator</a></h2>
<p>Detailed instructions and explanations are available in <a href="https://phabricator.services.mozilla.com/book/phabricator/article/arcanist_quick_start/">the official documentation</a>.</p>
<p>On macOS, PHP is already shipping as part of the operating system, but you might need to install <a href="https://git-scm.com/">Git</a> if not available. The following commands clone two repositories inside <code>~/mozilla/mercurial/</code>. If you move them, you’ll need to update the <code>PATH</code> command accordingly.</p>
<pre><code class="language-BASH">$ git clone https://github.com/phacility/libphutil.git ~/mozilla/mercurial/libphutil
$ git clone https://github.com/phacility/arcanist.git ~/mozilla/mercurial/arcanist
$ echo -e '\n# Arcanist path for Phabricator\nPATH=&quot;$PATH:$HOME/mozilla/mercurial/arcanist/bin/&quot;' &gt;&gt; ~/.bash_profile
$ source ~/.bash_profile
</code></pre>
<p>Check that the <code>arc</code> command is available:</p>
<pre><code class="language-BASH">$ arc --version
arcanist 875d018360374cb4b1287309782fcb9a75d4bcbf (9 Jul 2018)
libphutil 1613e68f474030e2c8de2797080a6872c140b1ef (20 Jul 2018)
</code></pre>
<p>You also need to <a href="https://moz-conduit.readthedocs.io/en/latest/phabricator-user.html">create an account</a> on Phabricator and <a href="https://phabricator.services.mozilla.com/">log in</a>.</p>
<p>At this point you still have to install Arcanist credentials, but you need a clone of mozilla-unified first.</p>
<h2><a class="header" href="#cloning-and-updating-mozilla-unified" id="cloning-and-updating-mozilla-unified">Cloning and updating mozilla-unified</a></h2>
<p>Since searchplugins are stored in mozilla-central, you will also need a clone of it on your computer. Using the <a href="https://mozilla-version-control-tools.readthedocs.io/en/latest/hgmozilla/unifiedrepo.html">mozilla-unified repository</a> repository is a better solution, especially if you need to work on more than just mozilla-central.</p>
<pre><code class="language-BASH">$ cd ~/mozilla/mercurial/
$ hg clone https://hg.mozilla.org/mozilla-unified
</code></pre>
<p>To update the existing repository:</p>
<pre><code class="language-BASH">$ cd ~/mozilla/mercurial/mozilla-unified
$ hg pull -u
$ hg up central
</code></pre>
<p>The last command makes sure you’re working against central (to be more precise, it moves you to the <code>central</code> bookmark).</p>
<p>Now you can complete the setup for Arcanist. Follow the instructions on screen to complete, it will require you to connect to Phabricator and generate an API key to copy in the terminal:</p>
<pre><code class="language-BASH">$ cd ~/mozilla/mercurial/mozilla-unified
$ arc install-certificate
</code></pre>
<h2><a class="header" href="#mercurial-configuration-1" id="mercurial-configuration-1">Mercurial configuration</a></h2>
<p>Mercurial configuration is stored in the <code>.hgrc</code> file in the user’s home directory.</p>
<p>Useful extensions are <code>Mercurial Queues Extension</code> (queues), <code>color</code> (colorize output, for example diffs) and <code>purge</code> (to remove untracked files from the repository). If the <code>.hgrc</code> file doesn’t have an <code>[extensions]</code> section create one and add the following lines:</p>
<pre><code class="language-INI">[extensions]
mq =
color =
purge =
</code></pre>
<p>Some aliases are also useful to work with bookmarks:</p>
<pre><code class="language-INI">[alias]
shortlog = log --template &quot;{node|short} | {date|isodatesec} | {author|user}: {desc|strip|firstline}\n&quot;
wip = log --graph --rev=wip --template=wip

[templates]
wip = '{label(&quot;log.branch&quot;, branches)} {label(&quot;changeset.{phase}&quot;, rev)}{label(&quot;changeset.{phase}&quot;, &quot;:&quot;)}{label(&quot;changeset.{phase}&quot;, short(node))} {label(&quot;grep.user&quot;, author|user)}{label(&quot;log.tag&quot;, if(tags,&quot; {tags}&quot;))}{label(&quot;log.tag&quot;, if(fxheads,&quot; {fxheads}&quot;))} {label(&quot;log.bookmark&quot;, if(bookmarks,&quot; {bookmarks}&quot;))}\n{label(ifcontains(rev, revset(&quot;.&quot;), &quot;desc.here&quot;),desc|firstline)}'
</code></pre>
<h2><a class="header" href="#text-editor" id="text-editor">Text editor</a></h2>
<p>The suggestion is to use <a href="https://atom.io/">Atom</a> with the optional <a href="https://atom.io/packages/sort-lines">Sort Lines package</a> installed.</p>
<p>If you don’t like to use <code>nano</code> to edit commit messages, you can also use a graphical editor. A possible alternative on macOS is to use <a href="https://macromates.com/">TextMate</a>: after installing it, open Preferences and install the <em>Shell support</em> (<em>Terminal</em> tab), then add a <code>editor</code> preference to <code>.hgrc</code>.</p>
<pre><code class="language-INI">[ui]
username = YOUR NAME &lt;YOUR EMAIL&gt;
ignore.other = ~/.hgignore
editor = mate -w
</code></pre>
<p>You can also use Atom, but it’s definitely slower.</p>
<pre><code class="language-INI">[ui]
username = YOUR NAME &lt;YOUR EMAIL&gt;
ignore.other = ~/.hgignore
editor = atom --wait
</code></pre>
<p>In general, in order to be able to use it for commit messages, you’ll need a text editor available from the command line, and with a <code>wait</code> option.</p>
<h1><a class="header" href="#create-a-patch-in-mercurial" id="create-a-patch-in-mercurial">Create a patch in Mercurial</a></h1>
<ul>
<li><a href="tools/mercurial/creating_mercurial_patch.html#creating-a-patch-using-phabricator">Creating a patch using Phabricator</a>
<ul>
<li><a href="tools/mercurial/creating_mercurial_patch.html#creating-a-patch">Creating a patch</a></li>
<li><a href="tools/mercurial/creating_mercurial_patch.html#updating-an-existing-patch">Updating an existing patch</a>
<ul>
<li><a href="tools/mercurial/creating_mercurial_patch.html#amend-the-last-commit">Amend the last commit</a></li>
<li><a href="tools/mercurial/creating_mercurial_patch.html#create-a-new-commit-and-squash-history">Create a new commit and squash history</a></li>
</ul>
</li>
<li><a href="tools/mercurial/creating_mercurial_patch.html#landing-the-patch">Landing the patch</a></li>
</ul>
</li>
<li><a href="tools/mercurial/creating_mercurial_patch.html#creating-a-patch-using-queues">Creating a patch using Queues</a>
<ul>
<li><a href="tools/mercurial/creating_mercurial_patch.html#creating-a-patch">Creating a patch</a></li>
<li><a href="tools/mercurial/creating_mercurial_patch.html#updating-an-existing-patch">Updating an existing patch</a></li>
<li><a href="tools/mercurial/creating_mercurial_patch.html#landing-the-patch">Landing the patch</a></li>
</ul>
</li>
</ul>
<p>There are currently two different methods available to create a patch for Mercurial repositories:</p>
<ul>
<li><a href="tools/mercurial/creating_mercurial_patch.html#creating-a-patch-using-phabricator">Using <strong>Phabricator</strong></a>.</li>
<li><a href="tools/mercurial/creating_mercurial_patch.html#creating-a-patch-using-queues">Using <strong>Mercurial Queues</strong></a> (<code>mq</code> extension).</li>
</ul>
<p>Phabricator is the preferred method for patches to main code repositories, like <code>mozilla-central</code>. On the other hand, Queues is the only tool available for patches to l10n repositories.</p>
<p>As a general rule, before creating a patch, make sure that your environment is <a href="tools/mercurial/../../tools/mercurial/setting_mercurial_environment.html">correctly set up</a>, and update your local clones.</p>
<h2><a class="header" href="#creating-a-patch-using-phabricator" id="creating-a-patch-using-phabricator">Creating a patch using Phabricator</a></h2>
<h3><a class="header" href="#creating-a-patch" id="creating-a-patch">Creating a patch</a></h3>
<p>Consider the following example: setting up productization for Urdu (ur) on Firefox desktop. After you’ve created or edited all the files you need, check the status of the repository.</p>
<pre><code class="language-BASH">$ hg status
M browser/locales/search/list.json
? browser/locales/searchplugins/amazon-in.xml
? browser/locales/searchplugins/wikipedia-ur.xml
</code></pre>
<p>These are all status codes relevant for working with patches:</p>
<ul>
<li>M = modified. File was already tracked but has been modified.</li>
<li>A = added. File is new and was already added with <code>hg add</code>.</li>
<li>R = removed. File has been removed with <code>hg remove</code>.</li>
<li>! = missing. File has been removed from the filesystem but it’s still tracked. Use <code>hg remove</code> to stop tracking it.</li>
<li>? = not tracked. File is not tracked yet. You can start tracking it by using <code>hg add</code>.</li>
</ul>
<p>Note that the file status will change once you commit, <code>hg status</code> only shows information about pending changes.</p>
<p>Now you need to add the new files. You can add them using the full path, or a parent folder, just make sure you’re not adding unnecessary files.</p>
<pre><code class="language-BASH">$ hg add browser/locales/searchplugins
$ hg status
M browser/locales/search/list.json
A browser/locales/searchplugins/amazon-in.xml
A browser/locales/searchplugins/wikipedia-ur.xml
</code></pre>
<p>Let’s create a bookmark for this pending work, for example <code>bug1304757</code>.</p>
<pre><code class="language-BASH">$ hg bookmark bug1304757
</code></pre>
<p>Commit the changes:</p>
<pre><code class="language-BASH">$ hg commit -m &quot;Bug 1304757 - [ur] Search engine setup for Firefox for Urdu&quot;
</code></pre>
<p>At this point you can check the status of the tree:</p>
<pre><code class="language-BASH">$ hg wip
</code></pre>
<p>And you should be able to identify your work and bookmark (press <code>q</code> to leave this view):</p>
<pre><code>@   358728:c0b04112d4e6 flod tip  bug1304757
|  Bug 1304757 - [ur] Search engine setup for Firefox for Urdu, r?flod
| o   358726:f7834b7b4050 aosmond  inbound
|/:  Bug 1299498 - Keep a main thread only pointer to the underlying nsIURI for ImageURL. r=tnikkel
| : o   358715:6f79cece26e9 ffxbld  beta
| : |  No bug, Automated blocklist update from host bld-linux64-spot-245 - a=blocklist-update
| : ~
| : o   358714:f5f73390f439 ffxbld  release
| : |  No bug, Automated blocklist update from host bld-linux64-spot-246 - a=blocklist-update
| : ~
o :   358709:f8107cf96144 cbook  central
:/   merge mozilla-inbound to mozilla-central a=merge
</code></pre>
<p>Create a revision in Differential:</p>
<pre><code class="language-BASH">$ arc diff
</code></pre>
<p>An editor will open, asking for some information about the commit:</p>
<pre><code>Bug 1304757 - [ur] Search engine setup for Firefox for Urdu

Summary:

Test Plan:

Reviewers: flod

Subscribers:

Bug #: 1304757
</code></pre>
<p>You need to provide:</p>
<ul>
<li><strong>Reviewers</strong>: use the Phabricator nickname (usually matches the nickname on Bugzilla). In this example: <code>flod</code>.</li>
<li><strong>Bug #</strong>: provide the bug number. In this example: <code>1304757</code>.</li>
</ul>
<p>Once finished, save the editor and exit. At the end of the process, you should find a link to a Differential in Phrabricator:</p>
<pre><code class="language-BASH">Linting...
No lint engine configured for this project.
Running unit tests...
No unit test engine is configured for this project.
 SKIP STAGING  Phabricator does not support staging areas for this repository.
Updating commit message...
Created a new Differential revision:
        Revision URI: https://phabricator.services.mozilla.com/Dxxxx

Included changes:
  M       browser/locales/search/list.json
  A       browser/locales/searchplugins/amazon-in.xml
  A       browser/locales/searchplugins/wikipedia-ur.xml
</code></pre>
<p>Once published, the review request will be attached automatically to the bug, and the reviewer will be flagged. Note that you can also update information about the patch, like reviewer or bug, directly in Phrabricator after using <code>arc diff</code>.</p>
<h3><a class="header" href="#updating-an-existing-patch" id="updating-an-existing-patch">Updating an existing patch</a></h3>
<p>If you need to address review comments, you can restore your branch by switching to your bookmark, and start working on it again.</p>
<pre><code class="language-BASH">$ hg up bug1304757
</code></pre>
<p>You can check which bookmark is currently active with <code>hg bookmarks</code>:</p>
<pre><code class="language-BASH">$ hg bookmarks
   aurora                    359014:96503957841c
   beta                      359025:34c73c520f93
 * bug1304757                359034:bde380bc54ff
   central                   358999:a69583d2dbc6
</code></pre>
<p>After addressing the review comments and editing your local files, you have two choices to save your work:</p>
<ul>
<li>Amend the last commit.</li>
<li>Create a new commit and squash history.</li>
</ul>
<h4><a class="header" href="#amend-the-last-commit" id="amend-the-last-commit">Amend the last commit</a></h4>
<p>To amend the last commit, simply execute:</p>
<pre><code class="language-BASH">$ hg commit --amend
</code></pre>
<p>Then confirm (or edit) the commit message by saving with <code>CTRL+O</code> and exiting with <code>CTRL+X</code> (assuming the default editor is nano). Finally, update phabricator (you will need to provide a commit message):</p>
<pre><code class="language-BASH">$ arc diff
</code></pre>
<h4><a class="header" href="#create-a-new-commit-and-squash-history" id="create-a-new-commit-and-squash-history">Create a new commit and squash history</a></h4>
<p>If you prefer to have a separate commit, execute:</p>
<pre><code class="language-BASH">$ hg commit -m &quot;Address review comments&quot;
</code></pre>
<p>Then squash the commits together by editing history:</p>
<pre><code class="language-BASH">$ hg histedit
</code></pre>
<p>The following screen will look like this:</p>
<pre><code>pick f6f70f6de69c 358597 Bug 123456 - [ur] Search engine setup for Firefox fo...
pick 8088fd8658fd 358598 Fix searchplugin name

# Edit history between f6f70f6de69c and 8088fd8658fd
#
# Commits are listed from least to most recent
#
# You can reorder changesets by reordering the lines
#
# Commands:
#
#  e, edit = use commit, but stop for amending
#  m, mess = edit commit message without changing commit content
#  p, pick = use commit
#  d, drop = remove commit from history
#  f, fold = use commit, but combine it with the one above
#  r, roll = like fold, but discard this commit's description
#
</code></pre>
<p>In this case you want to <em>roll</em> the second commit into the first one, so replace <code>pick</code> with <code>roll</code> (or <code>r</code>), save with <code>CTRL+O</code> and exit with <code>CTRL+X</code> (assuming the default editor is nano).</p>
<pre><code>pick f6f70f6de69c 358597 Bug 123456 - [ur] Search engine setup for Firefox fo...
roll 8088fd8658fd 358598 Fix searchplugin name

...
</code></pre>
<p>Update Phabricator (you will need to provide a commit message):</p>
<pre><code class="language-BASH">$ arc diff
</code></pre>
<p>You can also use <code>hg histedit</code> to reword a commit message (set the commit line to <code>edit</code>). Just remember to complete the <code>histedit</code> after commit.</p>
<pre><code class="language-BASH">$ hg commit -m &quot;Some changes&quot;
$ hg histedit --continue
</code></pre>
<p>If necessary, you can rebase against another bookmark, like <code>central</code> or <code>inbound</code></p>
<pre><code class="language-BASH">$ hg rebase -d central
</code></pre>
<p>More information about this workflow are available in the following pages:</p>
<ul>
<li>https://mozilla-version-control-tools.readthedocs.io/en/latest/hgmozilla/firefoxworkflow.html</li>
<li>https://www.mercurial-scm.org/wiki/Bookmarks</li>
</ul>
<h3><a class="header" href="#landing-the-patch" id="landing-the-patch">Landing the patch</a></h3>
<p>Once the patch has been reviewed, you have two options:</p>
<ul>
<li>If you have L3 access to the repository, you can use <a href="https://moz-conduit.readthedocs.io/en/latest/lando-user.html">Lando</a> to land your commit directly. If your reviewer has it, you can ask them to land.</li>
<li>You can set the <code>checkin-needed</code> keyword in the bug, and sheriffs will land it from you.</li>
</ul>
<h2><a class="header" href="#creating-a-patch-using-queues" id="creating-a-patch-using-queues">Creating a patch using Queues</a></h2>
<h3><a class="header" href="#creating-a-patch-1" id="creating-a-patch-1">Creating a patch</a></h3>
<p>Consider the following example: setting up productization for Urdu (ur) on Firefox desktop (l10n repository). The first step is to create a <code>region.properties</code> file. Move into the repository folder and check its status:</p>
<pre><code class="language-BASH">$ cd ~/mozilla/mercurial/l10n/ur/l10n-central

$ hg status
? browser/chrome/browser-region/region.properties
</code></pre>
<p>File is brand new and needs to be added:</p>
<pre><code class="language-BASH">$ hg add browser

$ hg status
A browser/chrome/browser-region/region.properties
</code></pre>
<p>You need to assign a name to this patch, it’s easy to use a reference to the bug number: for example, if the bug number is 123456, the file could be called <code>bug123456.patch</code> (note the added extension <code>.patch</code>).</p>
<pre><code class="language-BASH">$ hg qnew bug123456.patch
</code></pre>
<p>At this point you will be asked to provide a commit message for your patch (in <code>nano</code> if you followed the instructions to set up the environment): write your commit message, then press <code>CTRL+O</code> to save the file, <code>enter</code> to confirm the proposed filename, and finally <code>CTRL+X</code> to exit the editor.</p>
<p>The commit message should be the same as the bug, for example <code>Bug 123456 - Set up searchplugins for &quot;ur&quot; and Firefox desktop</code>.</p>
<p>You are ready to <em>pop</em> the patch out of the queue. Since it’s likely that there are no other patches, you can pop them all with <code>-a</code>.</p>
<pre><code class="language-BASH">$ hg qpop -a
popping bug123456.patch
patch queue now empty
</code></pre>
<p>The patch is stored inside the <code>.hg/patches</code> folder in the root of the repository (in the suggested setup, the full path would be <code>~/mozilla/mercurial/l10n-central/.hg/patches</code>). You can copy the file through the command line or the file explorer. For example, on macOS you can open the folder in Finder by typing:</p>
<pre><code class="language-BASH">$ open ~/mozilla/mercurial/l10n/ur/l10n-central/.hg/patches
</code></pre>
<p>Or you can copy the file on the Desktop with</p>
<pre><code class="language-BASH">$ cp ~/mozilla/mercurial/l10n/ur/l10n-central/.hg/patches/bug123456.patch ~/Desktop
</code></pre>
<p>Now you need to attach the file to Bugzilla and set an appropriate reviewer for it.</p>
<h3><a class="header" href="#updating-an-existing-patch-1" id="updating-an-existing-patch-1">Updating an existing patch</a></h3>
<p>Let’s assume that the review found some issues with the patch and you need to update it. The fastest way is to import the .patch file without committing, update the files as needed, and create a new patch using the same process explained above.</p>
<p>Assuming the file is called <code>bug123456.patch</code> and it’s in your desktop, you can move in the repository folder and import the file like this:</p>
<pre><code class="language-BASH">$ cd ~/mozilla/mercurial/l10n/ur/l10n-central

$ hg import --no-commit ~/Desktop/bug123456.patch
</code></pre>
<p>Don’t forget the <code>--no-commit</code> part. If you do, the patch will be added to your repository and you’ll need to clone the original repository again.</p>
<!-- markdownlint-disable MD038 -->
<p><strong>Note:</strong> You can drag and drop the patch file on the terminal on macOS to get its full path instead of typing it. In other words, type <code>hg import --no-commit </code> (leave an empty space at the end), then drag the icon of the patch on the Terminal’s window: its full path will appear automatically.</p>
<!-- markdownlint-enable MD038 -->
<p>At this point you’re ready to modify the files, and create a new patch. The only difference is that you will need to use a different filename, for example <code>bug123456v1.patch</code>.</p>
<h3><a class="header" href="#landing-the-patch-1" id="landing-the-patch-1">Landing the patch</a></h3>
<p>Your patch got a <code>r+</code>, so you need to update the commit message to reference the review, import the patch and push it to the remote server.</p>
<p><strong>Note:</strong> If the patch is for a repository where you don’t have write access, you don’t need to follow these instructions, only to set the <code>checkin-needed</code> flag in Bugzilla.</p>
<p>Open the .patch file in your editor, find the line with the commit message, and add <code>r=NICKNAME</code> to the commit message. For example, the last line in</p>
<pre><code># HG changeset patch
# User SOMENAME &lt;SOME EMAIL&gt;
# Parent  b45d23bc53df9227aa262acb2a5c6b0ab903b76e
Bug 123456 - Set up searchplugins for &quot;ur&quot; and Firefox for Android
</code></pre>
<p>Should become like this, assuming flod is the reviewer.</p>
<pre><code>Bug 123456 - Set up searchplugins for &quot;ur&quot; and Firefox for Android, r=flod
</code></pre>
<p>Then you need to import the patch, this time without the <code>no-commit</code> parameter.</p>
<pre><code class="language-BASH">$ cd ~/mozilla/mercurial/l10n/ur/l10n-central

$ hg import ~/Desktop/bug123456.patch
</code></pre>
<p>The patch has been imported and committed. If you get an error while applying the patch, check if the editor you’re using hasn’t modified other lines of the patch, for example removing trailing whitespaces. In that case, using <code>nano</code> to edit the patch is probably your faster option.</p>
<p>Now you’re ready to push to the remote repository</p>
<pre><code class="language-BASH">$ hg push
</code></pre>
<p>The reply from the server will contain the URL to your changeset: copy and paste that URL in the bug. If the bug only contains a patch to region.properties, you can close the bug after landing; if it also contains a patch stored in MozReview, the bug will be automatically closed when the patch is merged to mozilla-central.</p>
<h1><a class="header" href="#useful-mercurial-commands" id="useful-mercurial-commands">Useful Mercurial commands</a></h1>
<h2><a class="header" href="#display-log" id="display-log">Display log</a></h2>
<p>To display the log you can use <code>hg log -l NUMBER</code>, where <em>NUMBER</em> is the number of commits. Note that Mercurial uses <code>l</code> instead of Git’s <code>n</code>. Use the space bar to move to the next page if the results don’t fit in the screen.</p>
<p>You can also browse the history by running <code>hg serve</code> within the repository folder, then opening http://localhost:8000</p>
<h2><a class="header" href="#display-content-of-the-last-commit" id="display-content-of-the-last-commit">Display content of the last commit</a></h2>
<p>To display the content of the last commit you can use:</p>
<pre><code class="language-BASH">$ hg log --patch --rev tip
</code></pre>
<p>Press the space bar to move to the next page, <code>q</code> to quit.</p>
<h2><a class="header" href="#revert-staged-changes" id="revert-staged-changes">Revert staged changes</a></h2>
<p>Let’s assume that you have staged (uncommitted) changes in your repositories but you want to go back to a clean state:</p>
<ul>
<li>If you only want to reset one file, you can use <code>hg revert FILENAME</code>. Note that this will leave a <code>FILENAME.orig</code> in the repository, in case you decide to change your mind. To avoid that, use the <code>-C</code> option: <code>hg revert -C FILENAME</code>. You can use this command also to restore a file marked as <code>!</code> (missing in the filesystem, but still tracked).</li>
<li><code>hg up -C</code> will reset all changed files to the last commit. Note that it won’t remove untracked files.</li>
<li>To remove all untracked files, you can use the <code>purge</code> extension and run <code>hg purge</code>. It won’t remove staged changes, like modified files still uncommitted.</li>
</ul>
<h2><a class="header" href="#revert-changes-already-committed" id="revert-changes-already-committed">Revert changes already committed</a></h2>
<p>If you want to revert changes already committed:</p>
<ul>
<li>To backout a specific changeset use <code>hg backout -r CHANGESET</code>. This will prompt you directly with a request for the commit message to use in the backout.</li>
<li>To revert a file to a specific changeset, use <code>hg revert -r CHANGESET FILENAME</code>. This will revert the file without committing it.</li>
</ul>
<h1><a class="header" href="#miscellaneous-documentation" id="miscellaneous-documentation">Miscellaneous documentation</a></h1>
<ul>
<li><a href="misc/creating_new_repository.html">How to create a new repository for localization projects</a>.</li>
<li><a href="misc/working_w_l10n_agency.html">How to work with a Localization Agency</a>.</li>
<li><a href="misc/documentation_styleguide.html">Documentation styleguide</a>.</li>
<li><a href="misc/stock_emails.html">Stock email for interaction with localizers and vendors</a>.</li>
</ul>
<h1><a class="header" href="#creating-a-new-repository-for-projects" id="creating-a-new-repository-for-projects">Creating a new repository for projects</a></h1>
<p>Creating a new repository in the <a href="https://github.com/mozilla-l10n">mozilla-l10n</a> organization provides the advantage of letting l10n-drivers manage this repository directly, reducing delays when dealing with permissions. It also allows localizers to work directly on GitHub with pull requests.</p>
<p>Note that you need to be a manager of the organization in order to create a new repository.</p>
<h2><a class="header" href="#create-the-new-repository" id="create-the-new-repository">Create the new repository</a></h2>
<p>A new repository can be created in <a href="https://github.com/organizations/mozilla-l10n/repositories/new">this page</a>, or using the <strong>New</strong> button in the organization’s landing page.</p>
<p><strong>Name</strong>: always include the <code>-l10n</code> suffix for localization repositories, to differentiate them from other repositories used for tools. Notable exception to this rule is <code>www.mozilla.org</code>.</p>
<p>For example, if the project is <em>Focus for Android</em>, a good repository name is <code>focus-android-l10n</code>.</p>
<p><strong>Description</strong>: add a short description, e.g. <code>Strings for the Focus (Android) project</code>.</p>
<p>Set the project as <strong>Public</strong> and don’t initialize it with a README.</p>
<p><img src="misc/../assets/images/new_repository/new_repo.png" alt="New repository" /></p>
<h2><a class="header" href="#add-collaborators" id="add-collaborators">Add collaborators</a></h2>
<p>Go into the project settings, panel <strong>Collaborators &amp; teams</strong>:</p>
<ul>
<li>Add the relevant l10n-drivers as Admin. You can either pick individuals or one of the pre-existing groups.</li>
<li>Only when the project is ready for localization, add the <strong>Localizers</strong> group with <strong>Write</strong> permissions. Note that Pontoon’s bot is included in the localizers group, so you will need to enable it for testing the sync process.</li>
<li>Add relevant developers as contributors if they need to make commits to the repository (that’s usually the case, in order to update strings).</li>
</ul>
<p><img src="misc/../assets/images/new_repository/settings.png" alt="New repository" /></p>
<h2><a class="header" href="#add-a-readmemd-to-the-project" id="add-a-readmemd-to-the-project">Add a README.md to the project</a></h2>
<p>Add a README with some useful information about the project. For example, for Focus for Android:</p>
<pre><code># Focus by Firefox localization
Localization for the Focus by Firefox project for Android.

The application code with build instructions can be found
at &lt;https://github.com/mozilla-mobile/focus-android&gt;.

# License
Translations in this repository are available under the
terms of the [Mozilla Public License v2.0](https://www.mozilla.org/MPL/2.0/).
</code></pre>
<h2><a class="header" href="#add-a-codeowners-file" id="add-a-codeowners-file">Add a CODEOWNERS file</a></h2>
<p>It’s possible to add a <em>CODEOWNERS</em> file to automatically ping the owner of the project in case of pull requests. File should be placed in the root of the repository, it’s called <code>CODEOWNERS</code> and uses the following format:</p>
<pre><code>path/to/files/to/monitor @nickname_of_owner
</code></pre>
<p>For example, this is the content of the <a href="https://github.com/mozilla-l10n/focus-android-l10n/blob/master/CODEOWNERS">CODEOWNERS</a> file for Focus for Android:</p>
<pre><code>locales/templates/*.pot @delphine
</code></pre>
<p>Pull requests to update strings always modify <code>locales/templates/app.pot</code>, while <code>delphine</code> is the nickname of the PM in charge of this product. Any pull request trying to modify files matching that path will automatically send a review request to the code owner.</p>
<h2><a class="header" href="#add-topics-to-the-repository-optional" id="add-topics-to-the-repository-optional">Add topics to the repository (optional)</a></h2>
<p>In the main repository page you can add <a href="https://github.com/blog/2309-introducing-topics">topics</a> to make the repository more discoverable by potential contributors. For example, all localization projects have the following topics: mozilla-l10n, localization, translation.</p>
<h1><a class="header" href="#working-with-a-localization-agency" id="working-with-a-localization-agency">Working with a Localization Agency</a></h1>
<p>This document is a guideline for project manager who interacts with a localization agency that already successfully went through our <a href="https://docs.google.com/document/d/1Y0xfGo-24ZJI_uYFLtJFcuxCi20FNIqaeEc7v_FlaY4/edit">vetting process</a>. Our vetting process helps us ensure the vendors we work with are able to deliver translations in a timely manner, with the required level of quality and following our localization processes. We are also assessing their flexibility to work efficiently with our communities and our tools when it’s required.</p>
<h2><a class="header" href="#initial-set-up-before-sending-localization-requests" id="initial-set-up-before-sending-localization-requests">Initial set up before sending localization requests</a></h2>
<h3><a class="header" href="#ask-for-a-rate-sheet" id="ask-for-a-rate-sheet">Ask for a rate sheet</a></h3>
<ul>
<li>Make sure you have received a rate sheet customized for Mozilla needs. This should have been sent as part of the vetting process, and it can be updated annually. An example of the official <a href="https://drive.google.com/a/mozilla.com/file/d/0B7u_NzvpgGcgTDhoVFBsN3dMc0E/view?usp=sharing">rate sheet</a> that includes the following but not limited to:
<ul>
<li>Word rate for each of the interested locales as in new words, 100% match, fuzzy match for translation, review, proofreading.</li>
<li>Hourly rate: engineering, QA and testing, PM rate.</li>
<li>Minimum charge for a project and the thresholds by number of words per locale.</li>
<li>Rush rate, and its threshold.</li>
</ul>
</li>
</ul>
<h3><a class="header" href="#do-the-initial-paperwork" id="do-the-initial-paperwork">Do the initial paperwork</a></h3>
<p>A series of activities need to happen before an l10n project can start. The first step is doing the paperwork to be able to receive quotes for projects and pay bills for requests.</p>
<p>Unless there are changes in the signed document, this step is done once, for the whole organization, and only at the beginning of relationship engagement.</p>
<ul>
<li>A master service agreement (or MSA) has to be signed between Mozilla and the vendor. The person signing on Mozilla side could be the PM or PM’s manager. This document shows the conditions that the contract is operated in between the service provider and Mozilla. Without this agreement, a service can’t start. Here is an example of <a href="https://drive.google.com/a/mozilla.com/file/d/0B7u_NzvpgGcgSW5Jend3TlpyRlE/view?usp=sharing">MSA</a>. Note that two separate MSA must be signed, one for Mozilla Corporation and another one for Mozilla Foundation.</li>
<li>An Account Payable (or AP) form has to be filled. It contains banking information, billing cycle (monthly, quarterly, or “as soon as”) and payment due terms (within 30 or 45 days), billing email address. Here is an example of <a href="https://drive.google.com/a/mozilla.com/file/d/0B7u_NzvpgGcgYmN6c0tJc2IwUzA/view?usp=sharing">AP form</a>.</li>
</ul>
<p>PO, or Purchase Order, may or may not be necessary in order to get vendor service. Some teams have ongoing need for l10n service and have a budget set aside annually. This is a good reason to have a PO established. For most projects that are one time need, or sporadic, it’s best to go without a PO, and bill to the serviced department as needed.</p>
<h3><a class="header" href="#set-up-accounts" id="set-up-accounts">Set up accounts</a></h3>
<p>Depending on the needs and where the source file can be accessed, it’s good to have an account set up for the vendor’s project manager in the following places:</p>
<ul>
<li>Pontoon: set up a “translator” account when there is no community; or a basic “contributor” account when a community exists so that the vendor provides suggestions and the community can review them.</li>
<li>Bugzilla: so that the vendor’s project manager can interact in bugs. Bugzilla will allow us to have a central place to post project details and updates. Communication is generally handled via email with the vendor, but it’s useful to have a bug number to reference to, and the vendor can use the bug to quickly access all the details.</li>
<li>Google Drive: create a shared folder for the vendor to view, review, and translate directly spreadsheets or Google Docs.</li>
<li>GitHub: give commit permission if they need to commit directly in a repository (e.g. <a href="https://github.com/mozilla/legal-docs/">Legal docs</a>).</li>
</ul>
<p>Note: additional account setup may be needed if the project does not support our localization process (e.g. WordPress).</p>
<p>Once accounts are set up, allow the agency to explore the tools, flows and the product features to familiarize itself before actual work starts. Make sure to provide links to documentation as needed on how to use Pontoon and explain how to perform queries on Transvision. Setting up a meeting to share your screen might be a good idea, and use this opportunity to answer their questions about the project or the tools.</p>
<h2><a class="header" href="#localizing-a-project" id="localizing-a-project">Localizing a project</a></h2>
<h3><a class="header" href="#planning-the-request" id="planning-the-request">Planning the request</a></h3>
<p>Once outsourcing is a necessity for a project, before reaching out to the l10n agency to make an official request, make sure to check the following:</p>
<ul>
<li>Required locales.</li>
<li>Scope of work: is the request asking for anything other than translation, review and testing?</li>
<li>Milestones and Deadlines: negotiate it so the agency has sufficient time to finish each of the required tasks, and the community has enough time to review and sign off.</li>
<li>Check with communities if they want to fully handle the request, handle only some parts (e.g. initial translation or QA), or can’t work on it at all and let the agency do the work.</li>
</ul>
<h3><a class="header" href="#quotation" id="quotation">Quotation</a></h3>
<p>Now that you have all the initial info you need, you are good to go ahead and reach out to the vendor and provide what they need to generate a quote. Get a quote from the agency by communicating volume, locales, deadline, level of service needed, and type of content.</p>
<h3><a class="header" href="#setting-everything-up-for-the-request" id="setting-everything-up-for-the-request">Setting everything up for the request</a></h3>
<p>Now that you got a quote, you need to get it approved, send content to the vendor, and check permission.</p>
<ul>
<li>Provide a quote/estimate to the project requestor for approval.</li>
<li>For all the target locales, make sure both agency and the community have the proper access to the l10n tool or platform where the localizable content is staged and roles properly assigned per agreement.</li>
<li>Information to share with both the vendor and the community:
<ul>
<li>Scope: volume, type of content being localized, list of locales and type of service.</li>
<li>Plan: schedule with milestones.</li>
<li>Expectations: how you want the translations to be delivered (as a single batch or as each locale is ready), the file format you want the translations to be delivered into, and any additional service you would need, like following a specific test plan.</li>
</ul>
</li>
<li>Communicate the plan and the finalized schedule with the project stakeholders.</li>
<li>File a bug to track project progress. It can be a good idea to remind project specifics (repositories, deadline(s), locales…).</li>
</ul>
<h3><a class="header" href="#executing-the-request" id="executing-the-request">Executing the request</a></h3>
<p>The initial quote has been approved, roles and permission are set accordingly to the request. You can now execute it, receive translations and deliver them to the project stakeholders.</p>
<ul>
<li>Share the content with the agency:
<ul>
<li>Strings (whether it’s text files, a link to Pontoon, a link to a repository, a spreadsheet, a Google Doc…).</li>
<li>Locale specific style guides and product specific term list.</li>
<li>Terminology: Ask them to always refer to <a href="https://transvision.mozfr.org/">Transvision</a> to check terminology.</li>
</ul>
</li>
<li>Confirm with the vendor the following: word count, schedule and cost of the service.</li>
<li>Run testing/QA once you’ve received the translations, either by the community or the vendor, depending on the project agreement.</li>
<li>Communicate with communities for a chance to review and sign off on the project before releasing to the internal customer.</li>
</ul>
<h3><a class="header" href="#post-mortem" id="post-mortem">Post mortem</a></h3>
<p>After the project is delivered, you need to handle payment with the vendor and feedback with the community.
At the end of a calendar year, you would review the vendor working model and quality of paid service. You then provide feedback and evaluate if the service should be continued.</p>
<h4><a class="header" href="#steps-to-go-through-with-the-agency" id="steps-to-go-through-with-the-agency">Steps to go through with the agency</a></h4>
<ul>
<li>Have the agency send an updated quote, in case there is a change of scope in the project.</li>
<li>PM reviews the quote and checks for discrepancies and then approves the quote.</li>
<li>The agency’s account payable contact sends invoice to mozilla@bill.com and accounting@mozilla.com.</li>
<li>In a few days, PM will be notified and asked to approve the invoice in bill.com system.</li>
<li>PM reviews the bill one more time, updates the Cost Center to the one corresponding the internal customer’s.</li>
</ul>
<h4><a class="header" href="#steps-to-go-through-with-the-community" id="steps-to-go-through-with-the-community">Steps to go through with the community</a></h4>
<ul>
<li>PM should check with community periodically to gather input on translation quality if needed but it’s not necessary to do it every time. A necessary case could be if the community wants to replace the translator for their language because there are quality concerns.</li>
<li>Gather feedback in a spreadsheet, with summary in category of the type of issues reported, and detailed examples to support the summary.</li>
<li>Mozilla localizers give an overall quality rating and suggest to keep using the same translator(s) or ask for a replacement. The PM then shares the feedback with the agency for rebuttal and further feedback if needed.</li>
</ul>
<h2><a class="header" href="#terminology" id="terminology">Terminology</a></h2>
<dl>
  <dt>Account Manager</dt>
  <dd>Relationship, escalation of issues; handles complaints about quality or deadlines.</dd>
<dt>Project Manager</dt>
  <dd>Handles day-to-day operations. Coordinates resources on the agency side; provides estimate of a project’s deadline and cost.</dd>
<dt>Account Payable Manager</dt>
  <dd>Sends the bill to Mozilla Account Payable.</dd>
</dl>
<h1><a class="header" href="#documentation-style-guide" id="documentation-style-guide">Documentation style guide</a></h1>
<h2><a class="header" href="#general-rules" id="general-rules">General rules</a></h2>
<p>These are some of the general rules to follow when writing and reviewing documentation for this repository:</p>
<ul>
<li>Address the reader as <strong>you</strong>, avoid using <strong>we</strong>.</li>
<li>Avoid using generic terms.</li>
<li>Avoid unnecessary empty lines in the document.</li>
</ul>
<h2><a class="header" href="#typography" id="typography">Typography</a></h2>
<ul>
<li>Lists: each list item should start with an uppercase letter, and end with a period (only exception when the item ends with a URL). Use the <code>*</code> markdown notation for each item.</li>
<li>Use lowercase after colons, only one space after a period.</li>
<li>Use proper quotes, like <code>“example”</code>, instead of straight double quotes.</li>
<li>Use typographical apostrophes <code>’</code> instead of straight single quotes <code>'</code> (code fragments are the only exception).</li>
<li>Use backticks `, <strong>bold</strong>, or <em>italic</em> to highlight text in a sentence, not quotes.</li>
<li>Use <code>*</code> instead of <code>_</code> for bold and italic.</li>
<li>Try to use links instead of putting URLs directly in the text. For example, <code>visit [this page](http://example.com)</code> should be preferred to <code>visit http://example.com</code>.</li>
<li>Leave an empty line before and after code fragments, specify the language where possible. For example:</li>
</ul>
<pre>
This is some text.

```PHP
$test = 'test';
```

This is some other text.
</pre>
<h2><a class="header" href="#titles" id="titles">Titles</a></h2>
<ul>
<li>Use the hash syntax, leave one space after the hash, e.g. <code># This is a title</code>.</li>
<li>Use sentence case, avoid title case.</li>
<li>Documents should always start with a 1st level title. There should be <strong>only one</strong> 1st level title across the document.</li>
<li>Leave an empty line before and after each title. The only exception is the 1st level title at the beginning of the page.</li>
<li>Make sure to follow a logic when using titles, e.g. a 3rd level title should be in a section starting with a 2nd level title of its own.</li>
</ul>
<p>This is an example of a good structure:</p>
<pre><code># This is the main title for this document

## This is a section

This is some text.

### This is a subsection

This is some text.

## This is another section

This is some more text.
</code></pre>
<h2><a class="header" href="#bullet-and-numbered-items" id="bullet-and-numbered-items">Bullet and numbered items</a></h2>
<p>The first level has no indentation, and it’s completely aligned to the left. Sub levels should be indented using 4 spaces. Use <code>*</code> instead of <code>-</code> to create items. Example:</p>
<pre><code>* The first level bullet point
    * A second level bullet point
        * A third level bullet point
</code></pre>
<h2><a class="header" href="#links" id="links">Links</a></h2>
<p>There are three kind of links when cross referencing a document: within a document, within a project group, and outside a project group. The <code>[displayed text]</code> should be to the point and within a pair of square brackets. The displayed text must be followed by <code>(the link)</code> enclosed in a pair of parenthesis. Follow these formats for each case:</p>
<ul>
<li>Reference within the same document: link directly to the anchor, e.g. <code>[General rules](#general-rules)</code>. Note that GitHub automatically creates anchors for titles: if the title is <em>Title Example</em>, the anchor will be lowercase, with spaces replaced by dashes, i.e. <code>#title-example</code>.</li>
<li>Reference within a project group: use relative links, instead of absolute links (starting with <code>/</code>) or full GitHub URLs. For example, to link to a document in the parent folder, use <code>[other document](../other.md)</code>.</li>
<li>Reference outside the current repository: use the full GitHub URL, e.g. <code>[OpenDesign GitHub repository](https://github.com/mozilla/OpenDesign/tree/master/2017)</code>.</li>
</ul>
<h2><a class="header" href="#images" id="images">Images</a></h2>
<p>When adding images to a repository, make sure that the size is not too big for the content displayed on GitHub. In case of PNG files, make also sure to optimize files through online services like <a href="https://tinypng.com/">TinyPNG</a>.</p>
<ul>
<li>Create a folder that maps to the main folder in which your documented is stored.</li>
<li>Naming convention: if only a couple of images are needed, make the file name easily identifiable, e.g.: product_feature_type.png.</li>
<li>File name must not contain spaces and uppercase, and must use underscore to separate words as needed.</li>
<li>Image size: keep it under 800px. If necessary, create two versions: a small one and a bigger one to open when clicked.</li>
<li>Image format: <code>![Encoding bug](../assets/images/l10n_testing/encoding_bug.png)</code>.</li>
<li>When images contain personal information, such as email addresses, try to blur it out.</li>
</ul>
<h2><a class="header" href="#tools-1" id="tools-1">Tools</a></h2>
<p><a href="https://atom.io/">Atom</a> is the best tool for editing Markdown files:</p>
<ul>
<li>You can preview the content with <code>CTRL+SHIFT+M</code>. If you forget the shortcut, you can always use <code>CMD+SHIFT+P</code> to display the list of available commands, and search for <code>Markdown Preview: Toggle</code>.</li>
<li>You can install a package called <a href="https://atom.io/packages/smart-quotes-plus">smart-quotes-plus</a>, which lets you swap straight quotes with curly ones. Once the package is installed, press <code>CTRL+ALT+'</code> to swap quotes on the entire document, or the text currently selected. Again, you can use <code>CMD+SHIFT+P</code> and search for <code>Smart Quote Plus: Smartreplace</code>. Only make sure to not swap <code>&quot;</code> or <code>'</code> in code fragments where these characters are wanted.</li>
</ul>
<p>To install packages in Atom, open the Preferences, select the <em>Install</em> panel on the left and search for the package you’re interested in.</p>
<p><a href="https://github.com/DavidAnson/markdownlint">markdownlint</a>, a Markdown linter, is run on automation (Travis) for each pull request. If you want to use this tool on your system, make sure to install <a href="https://nodejs.org/en/">Node.js</a>, then run the following commands from the root of your repository (only once):</p>
<pre><code class="language-BASH">$ git clone https://github.com/flodolo/l10ndocs-linter
$ npm --prefix ./l10ndocs-linter install ./l10ndocs-linter
</code></pre>
<p>At this point you can launch the linter with this command:</p>
<pre><code class="language-BASH">$ node l10ndocs-linter/linter/markdownlint.js
Using config file: /your_path/documentation/l10ndocs-linter/linter/markdownlint.json
Searching path: /your_path/documentation

There are no linter errors.
</code></pre>
<h1><a class="header" href="#inquiries-about-joining-mozilla-l10n" id="inquiries-about-joining-mozilla-l10n">Inquiries about joining Mozilla L10n</a></h1>
<p>Here you’ll find a stockpile of templated responses to inquiries we frequently receive about Mozilla L10n. They’ve been centralized here so that you can simply copy and paste them into emails. While there is value to having these stock responses for common inquiries, we strongly feel that there is equal value to making them as personalized as possible. Take time to adjust the template in your email to include personalized information.</p>
<h2><a class="header" href="#general-inquiry" id="general-inquiry">General inquiry</a></h2>
<p>Hi [inquiree],</p>
<p>Thank you for your email and welcome to the Mozilla Community! We’re excited that you’re interested in joining our localization (L10n) effort.</p>
<p>Joining our L10n effort is easy. Within five easy steps you can start contributing to the project! We have a wiki page specially designed to help you get started. Please visit https://wiki.mozilla.org/L10n:Contribute and follow the five steps to get involved.</p>
<p>Could you also please provide me with some additional information about yourself, such as languages you speak, country you live in, and technical background?</p>
<p>You can also visit the following wiki pages to learn the details of how we localize:</p>
<ul>
<li><a href="https://wiki.mozilla.org/L10n:Localization_Process">L10n:Localization Process:</a> A good description of the whole process.</li>
<li><a href="https://developer.mozilla.org/en/Localization_Quick_Start_Guide">The L10n Quick Start Guide:</a> A resource of technical tutorials you’ll need to know as you get more involved.
Looking forward to hearing from you,</li>
</ul>
<p>[name]</p>
<h2><a class="header" href="#follow-up-to-general-inquiry" id="follow-up-to-general-inquiry">Follow up to general inquiry</a></h2>
<p>We’re very excited to have you join the Mozilla localization (l10n) effort! Your skills and dedication will be very valuable to your l10n team.</p>
<p>Next step, follow the steps outlined on https://wiki.mozilla.org/L10n:Contribute. When you contact your l10n team, please CC me on that email so that I can help to make sure you receive a prompt response.</p>
<p>If you have any questions or difficulties, please let me know.</p>
<p>Welcome!</p>
<h2><a class="header" href="#starting-a-new-localization" id="starting-a-new-localization">Starting a new localization</a></h2>
<p>Thank you for your email and welcome to the Mozilla Community! We’re excited that you’re interested in joining our localization effort.</p>
<p>Since you have stated that you would like to start a new localization effort, will be your mentor and point of contact.</p>
<p>Here’s how you can get started:</p>
<ul>
<li>Check our list of existing <a href="https://pontoon.mozilla.org/teams">localization communities</a> to see if an effort for your language already exists. If an effort exists, contact the community to join the team and help drive the effort. If it doesn’t exist, introduce your new l10n community on the <a href="https://groups.google.com/group/mozilla.dev.l10n">Mozilla localization mailing list</a>.</li>
<li>Introduce yourself to the L10n community on the <a href="https://groups.google.com/group/mozilla.dev.l10n">Mozilla localization mailing list</a> by subscribing and posting an introduction. In your introduction, please add some brief information about yourself (e.g., professional background, interests, etc.) and what you hope to work on (e.g., &quot;I saw that there was a xx-XX community and I’d like to help them out.&quot;).</li>
<li>Visit [L10n process doc needed] to become familiar with how we localize.</li>
</ul>
<p>For general information on the Mozilla localization program, visit our [GitBook link]. You’re also welcome to read through and post to  <a href="https://groups.google.com/group/mozilla.dev.l10n/topics">the localization discussion newsgroup</a>.
Hope to see more from you soon!</p>
<h2><a class="header" href="#localizing-thunderbird" id="localizing-thunderbird">Localizing Thunderbird</a></h2>
<p>We’re glad to see you’re interested in localizing Thunderbird. Please get in touch with <a href="mailto:mozilla@kewis.ch">the Thunderbird community</a> to learn how to contribute to localization.</p>
<h2><a class="header" href="#having-problems-with-pontoon" id="having-problems-with-pontoon">Having problems with Pontoon</a></h2>
<p>Sorry to hear that you’re having problems with Pontoon. Please do the following to allow us to troubleshoot your problem(s):</p>
<ul>
<li>Search <a href="https://bugzilla.mozilla.org">Bugzilla</a> to see if a bug has already been filed for your problem(s).</li>
<li>Check the <a href="http://groups.google.com/group/mozilla.dev.l10n">l10n mailing list</a> to see if anyone else has had the same problem.</li>
<li>If you can’t find a discussion thread about your problem, begin a discussion topic in those newsgroups asking for help. Include as much detail as possible.</li>
<li>If no one in the discussion group can offer a solution and there are no bugs currently filed, <a href="https://mzl.la/2tp26Ag">file a new bug</a> providing as many details about the problem as possible.</li>
</ul>
<p>If the first three steps don’t solve your problem and you have to file a bug, rest assured that the l10n-drivers will respond promptly.</p>
<h2><a class="header" href="#having-problems-with-mercurial-hg" id="having-problems-with-mercurial-hg">Having problems with Mercurial (hg)</a></h2>
<p>Sorry to hear that you’re having problems with hg. Please do the following to allow us to troubleshoot your problem(s):</p>
<ul>
<li>Search <a href="https://bugzilla.mozilla.org">Bugzilla</a> to see if a bug has already been filed for your problem(s).</li>
<li>Check the <a href="http://groups.google.com/group/mozilla.dev.l10n">l10n mailing list</a> to see if anyone else has had the same problem.</li>
<li>If you can’t find a discussion thread about your problem, begin a discussion topic in those newsgroups asking for help. Include as much detail as possible.</li>
<li>If no one in the discussion group can offer a solution and there are no bugs currently filed, file a new bug providing as many details about the  problem as possible.</li>
</ul>
<p>If the first three steps don’t solve your problem and you have to file a bug, rest assured that the l10n-drivers will respond promptly.</p>
<h2><a class="header" href="#update-your-team-wiki-page" id="update-your-team-wiki-page">Update your team wiki page</a></h2>
<p>Subject: [locale code]Please update [locale name] wiki page</p>
<p>I’m writing you to verify that your L10n team’s information on your wiki page (https://wiki.mozilla.org/L10n:Teams:[your-locale-here]) is up-to-date and accurate. Please take a look at your page and update it as needed.</p>
<p>Please follow the format outlined in <a href="https://wiki.mozilla.org/Template:L10n:Teams">this wiki template</a>.</p>
<p>If you have any questions, please feel free to contact me.</p>
<p>Thank you for your help!</p>
<h2><a class="header" href="#translationl10n-vendor-sales-pitches" id="translationl10n-vendor-sales-pitches">Translation/l10n vendor sales pitches</a></h2>
<p>It is a pleasure to meet you.</p>
<p>Mozilla is a non-profit, open source project. As such, all of our work, from development to marketing to localization, is performed by a dedicated, global community of volunteers. Our community is so thorough that it is very rare that we use vendors for translation, but when we do, we have a set of qualified vendors we rely on.</p>
<p>Of course, if you are interested in discussing a form of collaboration that fits with our volunteer, open source framework, I would be happy to arrange a meeting.</p>
<p>Thank you for your interest.</p>
<h2><a class="header" href="#responses-to-add" id="responses-to-add">Responses to add</a></h2>
<ul>
<li>Cold Call Inquiry: Would you to contribute to XX localization?</li>
<li>Reactivation: Are you still interested in contributing to L10n? Here’s where we need your help.</li>
<li>Assigning first tasks based on user profiles/interests</li>
<li>Phasing out a locale</li>
</ul>
<h1><a class="header" href="#setting-up-a-linux-virtual-machine-for-webdashboards" id="setting-up-a-linux-virtual-machine-for-webdashboards">Setting up a Linux Virtual Machine for Webdashboards</a></h1>
<p>This document describes how to configure a virtual machine based on Linux Ubuntu 18.04 LTS to manage tools like Langchecker, Bedrock (mozilla.org). The assumption is that you’ve already installed a software to manage virtual machines, like VMWare Fusion on Mac, and installed Linux. The virtual machine should have at least 40 GB of disk, 2 cores and 4 GB or memory.</p>
<h2><a class="header" href="#update-the-system" id="update-the-system">Update the system</a></h2>
<p>First of all, make sure to update the installed packages. Search for the terminal and type:</p>
<pre><code class="language-BASH">sudo sh -c &quot;apt update;apt dist-upgrade -y;apt autoremove -y&quot;
</code></pre>
<p>The password for <code>sudo</code> is the same you use to login to the system with your user. Once finished, reboot the virtual machine to make sure that all packages are updated.</p>
<p>If you’re using VMWare, make also sure to install VMWare Tools:</p>
<pre><code class="language-BASH">sudo apt install open-vm-tools open-vm-tools-desktop -y
</code></pre>
<p>Restart the virtual machine at the end to make sure all packages are up to date.</p>
<h2><a class="header" href="#configure-git-and-repositories" id="configure-git-and-repositories">Configure Git and repositories</a></h2>
<p>Before starting the setup you need to make sure to setup Git to use SSH on this VM.</p>
<p>Install Git:</p>
<pre><code class="language-BASH">sudo apt install git -y
</code></pre>
<p>Generate a new SSH key for this VM (replace the email address placeholder), make sure to setup a passphrase when asked:</p>
<pre><code class="language-BASH">ssh-keygen -t rsa -b 4096 -f ~/.ssh/github_ssh -C &quot;YOUR_EMAIL_ADDRESS&quot;
</code></pre>
<p>File will be stored in <code>~/.ssh/github_ssh</code>. The next step is to <a href="https://help.github.com/articles/adding-a-new-ssh-key-to-your-github-account/#platform-linux">add this key</a> to your GitHub account.</p>
<pre><code class="language-BASH">cat ~/.ssh/github_ssh.pub
</code></pre>
<p>Add a new key in <a href="https://github.com/settings/keys">your profile</a> and copy and paste the test displayed by the previous command, starting with <code>ssh-rsa</code> and finishing with the email address you provided.</p>
<p>At this point you’re ready to test your connection to GitHub (you will need to accept the certificate by typing <code>yes</code>)</p>
<pre><code class="language-BASH">ssh -T git@github.com
The authenticity of host 'github.com (192.30.253.112)' can't be established.
RSA key fingerprint is SHA256:nThbg6kXUpJWGl7E1IGOCspRomTxdCARLviKw6E5SY8.
Are you sure you want to continue connecting (yes/no)? yes
Hi USERNAME! You've successfully authenticated, but GitHub does not provide shell access.
</code></pre>
<p>It will ask for your passphrase, you can set the system to unlock this key whenever you’re logged in by selecting the checkbox under the input field.</p>
<p>You should also tweak your Git configuration with these commands (replace placeholders with your email address and name, they will be used for commit messages):</p>
<pre><code class="language-BASH">git config --global user.email &quot;YOUR_EMAIL_ADDRESS&quot;
git config --global user.name &quot;YOUR_NAME&quot;
git config --global push.default simple
</code></pre>
<h2><a class="header" href="#run-the-setup-scripts" id="run-the-setup-scripts">Run the setup scripts</a></h2>
<p>At this point you can run this command to download and execute a setup script. Note that this script must be run with <code>sudo</code>, since it needs to install several packages on the system.</p>
<pre><code class="language-BASH">sudo sh -c &quot;wget -O - https://raw.githubusercontent.com/mozilla-l10n/vm_scripts/master/setup_vm/setup_vm.sh | bash&quot;
</code></pre>
<p>Then run this script as standard user to clone all requested repositories:</p>
<pre><code class="language-BASH">~/mozilla/git/scripts/setup_vm/setup_repositories.sh
</code></pre>
<p>The entire procedure will take several minutes, depending on the speed of your Internet connection. During the process you will be asked, possibly more than once, to <strong>create a token on GitHub for Composer</strong>: follow the link to generate one and copy and paste it in the terminal.</p>
<p>All projects are now cloned using https and the original repository as <code>origin</code> (e.g. mozilla-l10n for langchecker), so you won’t be able to commit any changes. <strong>If you plan to make updates and commit them</strong>, make sure to create forks of the following repositories in your account:</p>
<ul>
<li>langchecker: https://github.com/mozilla-l10n/langchecker</li>
<li>bedrock: https://github.com/mozilla/bedrock</li>
</ul>
<p>Then run the following script providing your GitHub username (e.g. <code>flodolo</code>): it will setup the original repository as a remote called <code>upstream</code>, and your fork as <code>origin</code>. It will also switch relevant l10n repositories, like mozilla_org, to ssh to allow you to make direct commits.</p>
<pre><code class="language-BASH">~/mozilla/git/scripts/setup_vm/setup_remotes.sh GITHUB_USERNAME
</code></pre>
<p>Make sure to restart the terminal to enable the new command aliases. It’s recommended to use <em>Terminator</em>, installed as part of the setup script: it’s an improved terminal with support for tabs and split windows.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        

                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                

                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        
        
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
        
        

    </body>
</html>
